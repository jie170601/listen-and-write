"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var async_1 = require("./async");
var rejections_1 = require("./rejections");
var Trace_1 = require("./Trace");
var util_1 = require("./util");
var trace;
var longTraces = false;
function internalResolver(fulfill, reject) {
}
internalResolver(undefined, undefined);
function noop() {
}
var getThenError = {
    error: undefined,
};
function wrapNonError(a) {
    return a;
}
var dummyDoneTrace = new Trace_1.default();
var unwrappingPromise;
var promiseIdCounter = 0;
var Promise = (function () {
    function Promise(resolver) {
        var _this = this;
        this._id = promiseIdCounter++;
        this._state = 0;
        this._result = undefined;
        this._handlers = undefined;
        this._flags = 0;
        this._trace = undefined;
        trace && trace(this, "construct");
        if (longTraces) {
            this._trace = new Trace_1.default(Promise);
            if (unwrappingPromise) {
                this._setSource(unwrappingPromise);
            }
        }
        if (resolver === internalResolver) {
            return;
        }
        if (typeof resolver !== "function") {
            throw new TypeError("Promise resolver is not a function");
        }
        var called = false;
        try {
            resolver(function (y) {
                if (called) {
                    return;
                }
                called = true;
                _this._resolve(y);
            }, function (r) {
                if (called) {
                    return;
                }
                called = true;
                _this._reject(wrapNonError(r));
            });
        }
        catch (e) {
            if (!called) {
                called = true;
                this._reject(wrapNonError(e));
            }
        }
    }
    Promise.prototype.then = function (onFulfilled, onRejected) {
        trace && trace(this, "then(" + typeof onFulfilled + ", " + typeof onRejected + ")");
        if (this._state === 1 && typeof onFulfilled !== "function" ||
            this._state === 2 && typeof onRejected !== "function") {
            return this;
        }
        var slave = new (Object.getPrototypeOf(this).constructor)(internalResolver);
        slave._setSource(this);
        this._enqueue(onFulfilled, onRejected, slave, undefined);
        return slave;
    };
    Promise.prototype.done = function (onFulfilled, onRejected) {
        trace && trace(this, "done(" + typeof onFulfilled + ", " + typeof onRejected + ")");
        if (this._state === 1 && typeof onFulfilled !== "function") {
            return;
        }
        var doneTrace = dummyDoneTrace;
        if (longTraces) {
            doneTrace = new Trace_1.default();
            if (this._trace) {
                doneTrace.setSource(this._trace);
            }
        }
        this._enqueue(onFulfilled, onRejected, undefined, doneTrace);
    };
    Promise.prototype.catch = function () {
        if (arguments.length === 1) {
            var onRejected = arguments[0];
            return this.then(undefined, onRejected);
        }
        else {
            var predicate_1 = arguments[0];
            var onRejected_1 = arguments[1];
            return this.then(undefined, function (reason) {
                var match = false;
                if (typeof predicate_1 === "function") {
                    if (predicate_1.prototype instanceof Error || predicate_1 === Error) {
                        match = reason instanceof predicate_1;
                    }
                    else {
                        match = predicate_1(reason);
                    }
                }
                else if (Array.isArray(predicate_1)) {
                    for (var _i = 0, predicate_2 = predicate_1; _i < predicate_2.length; _i++) {
                        var p = predicate_2[_i];
                        if (reason instanceof p) {
                            match = true;
                            break;
                        }
                    }
                }
                else {
                    throw new TypeError("invalid predicate to .catch(), got " + typeof predicate_1);
                }
                if (match) {
                    return onRejected_1(reason);
                }
                return Promise.reject(reason);
            });
        }
    };
    Promise.prototype.finally = function (handler) {
        var _this = this;
        var runner = function () { return handler(_this); };
        return this.then(runner, runner).return(this);
    };
    Promise.prototype.isFulfilled = function () {
        return this._state === 1;
    };
    Promise.prototype.isRejected = function () {
        return this._state === 2;
    };
    Promise.prototype.isPending = function () {
        return this._state === 0;
    };
    Promise.prototype.value = function () {
        if (!this.isFulfilled()) {
            throw new Error("Promise is not fulfilled");
        }
        return this._result;
    };
    Promise.prototype.reason = function () {
        if (!this.isRejected()) {
            throw new Error("Promise is not rejected");
        }
        return this._result;
    };
    Promise.prototype.suppressUnhandledRejections = function () {
        this._setRejectionHandled();
    };
    Promise.prototype.inspect = function () {
        return this.toString();
    };
    Promise.prototype.toString = function () {
        var state;
        switch (this._state) {
            case 0:
                state = "pending";
                break;
            case 1:
                state = "fulfilled";
                break;
            case 2:
                state = "rejected";
                break;
            default: state = "unknown";
        }
        return "[Promise " + this._id + ": " + state + "]";
    };
    Promise.prototype.delay = function (ms) {
        return this.then(function (value) {
            return new Promise(function (resolve) {
                setTimeout(function () { return resolve(value); }, ms);
            });
        });
    };
    Promise.prototype.return = function (value) {
        if (value === undefined) {
            return this.then(noop);
        }
        return this.then(function () { return value; });
    };
    Promise.prototype.throw = function (reason) {
        return this.then(function () { return Promise.reject(reason); });
    };
    Promise.prototype._setSource = function (source) {
        if (!this._trace || !source._trace) {
            return;
        }
        this._trace.setSource(source._trace);
    };
    Promise.prototype._resolve = function (x) {
        util_1.assert(this._state === 0);
        if (!x) {
            this._fulfill(x);
            return;
        }
        if (this === x) {
            this._reject(new TypeError("cannot resolve Promise to self"));
            return;
        }
        if (x instanceof Promise) {
            x._setSource(this);
            x._setRejectionHandled();
            if (x._state === 0) {
                this._followPromise(x);
            }
            else if (x._state === 1) {
                this._fulfill(x._result);
            }
            else {
                this._reject(x._result);
            }
            return;
        }
        if (typeof x === "object" || typeof x === "function") {
            var then = this._tryGetThen(x);
            if (then === getThenError) {
                this._reject(wrapNonError(getThenError.error));
                return;
            }
            if (typeof then === "function") {
                this._followThenable(x, then);
                return;
            }
        }
        this._fulfill(x);
    };
    Promise.prototype._tryGetThen = function (x) {
        try {
            var then = x.then;
            return then;
        }
        catch (e) {
            getThenError.error = e;
            return getThenError;
        }
    };
    Promise.prototype._fulfill = function (value) {
        util_1.assert(this._state === 0);
        trace && trace(this, "_fulfill(" + typeof value + ")");
        this._state = 1;
        this._result = value;
        this._flush();
    };
    Promise.prototype._reject = function (reason) {
        util_1.assert(this._state === 0);
        trace && trace(this, "_reject(" + reason + ")");
        this._state = 2;
        this._result = reason;
        if (this._trace && this._result instanceof Error && !this._result.trace) {
            var stackTrace_1 = this._trace;
            this._result.trace = stackTrace_1;
            var originalStack_1 = this._result.stack;
            if (originalStack_1) {
                Object.defineProperty(this._result, "stack", {
                    enumerable: false,
                    get: function () { return originalStack_1 + "\n  from Promise at:\n" + stackTrace_1.inspect(); },
                });
            }
        }
        if (!(this._flags & 1)) {
            async_1.default.enqueueIdle(Promise._unhandledRejectionChecker, this);
        }
        this._flush();
    };
    Promise.prototype._setRejectionHandled = function () {
        if (!(this._flags & 1) && (this._flags & 2)) {
            async_1.default.enqueue(Promise._onPossiblyUnhandledRejectionHandledHandler, this);
        }
        this._flags |= 1;
        trace && trace(this, "rejectionHandled");
    };
    Promise.prototype._doCheckUnhandledRejection = function () {
        if (!(this._flags & 1) && !(this._flags & 2)) {
            this._flags |= 2;
            async_1.default.enqueue(Promise._onPossiblyUnhandledRejectionHandler, this);
        }
    };
    Promise.prototype._followPromise = function (slave) {
        util_1.assert(this._state === 0);
        trace && trace(this, "_follow([Promise " + slave._id + "])");
        slave._enqueue(undefined, undefined, this, undefined);
    };
    Promise.prototype._followThenable = function (slave, then) {
        var _this = this;
        util_1.assert(this._state === 0);
        trace && trace(this, "_follow([Thenable])");
        var called = false;
        try {
            then.call(slave, function (y) {
                if (called) {
                    return;
                }
                called = true;
                _this._resolve(y);
            }, function (r) {
                if (called) {
                    return;
                }
                called = true;
                _this._reject(wrapNonError(r));
            });
        }
        catch (e) {
            if (!called) {
                called = true;
                this._reject(wrapNonError(e));
            }
        }
    };
    Promise.prototype._enqueue = function (onFulfilled, onRejected, slave, done) {
        var h = {
            promise: this,
            onFulfilled: onFulfilled,
            onRejected: onRejected,
            slave: slave,
            done: done,
        };
        if (this._state !== 0) {
            async_1.default.enqueue(Promise._unwrapper, h);
        }
        else {
            if (!this._handlers) {
                this._handlers = [h];
            }
            else {
                var i = this._handlers.length;
                this._handlers[i] = h;
            }
        }
        this._setRejectionHandled();
    };
    Promise.prototype._flush = function () {
        if (!this._handlers) {
            return;
        }
        var i = 0;
        var h = this._handlers;
        var l = h.length;
        this._handlers = undefined;
        while (i < l) {
            async_1.default.enqueue(Promise._unwrapper, h[i++]);
        }
    };
    Promise.prototype._unwrap = function (handler) {
        var callback = this._state === 1 ? handler.onFulfilled : handler.onRejected;
        if (handler.done) {
            trace && trace(this, "_unwrap()");
            if (typeof callback !== "function") {
                if (this._state === 2) {
                    Promise._onUnhandledRejectionHandler(this._result, handler.done);
                }
                return;
            }
            util_1.assert(!unwrappingPromise);
            unwrappingPromise = this;
            try {
                var result = callback(this._result);
                if (result) {
                    var p = (result instanceof Promise) ? result : Promise.resolve(result);
                    p.done();
                }
                unwrappingPromise = undefined;
            }
            catch (e) {
                unwrappingPromise = undefined;
                Promise._onUnhandledRejectionHandler(e, handler.done);
            }
            return;
        }
        var slave = handler.slave;
        trace && trace(this, "_unwrap(" + slave._id + ")");
        if (typeof callback === "function") {
            util_1.assert(!unwrappingPromise);
            unwrappingPromise = slave;
            try {
                slave._resolve(callback(this._result));
            }
            catch (e) {
                slave._reject(wrapNonError(e));
            }
            unwrappingPromise = undefined;
        }
        else {
            if (this._state === 1) {
                slave._fulfill(this._result);
            }
            else {
                slave._reject(this._result);
            }
        }
    };
    Promise.resolve = function (value) {
        var p = new Promise(internalResolver);
        p._resolve(value);
        return p;
    };
    Promise.reject = function (reason) {
        var p = new Promise(internalResolver);
        p._reject(reason);
        return p;
    };
    Promise.all = function (thenables) {
        return new Promise(function (resolve, reject) {
            util_1.assert(Array.isArray(thenables), "thenables must be an Array");
            if (thenables.length === 0) {
                resolve([]);
                return;
            }
            var result = new Array(thenables.length);
            var remaining = thenables.length;
            for (var i = 0; i < thenables.length; i++) {
                follow(thenables[i], i);
            }
            function follow(t, index) {
                var slave = t instanceof Promise ? t : Promise.resolve(t);
                slave.done(function (v) {
                    result[index] = v;
                    remaining--;
                    if (remaining === 0) {
                        resolve(result);
                    }
                }, function (reason) { return reject(reason); });
            }
        });
    };
    Promise.race = function (thenables) {
        return new Promise(function (resolve, reject) {
            util_1.assert(Array.isArray(thenables), "thenables must be an Array");
            for (var _i = 0, thenables_1 = thenables; _i < thenables_1.length; _i++) {
                var t = thenables_1[_i];
                var slave = t instanceof Promise ? t : Promise.resolve(t);
                Promise.resolve(slave).done(resolve, reject);
            }
        });
    };
    Promise.defer = function () {
        var resolve;
        var reject;
        var p = new Promise(function (res, rej) {
            resolve = res;
            reject = rej;
        });
        return {
            promise: p,
            reject: reject,
            resolve: resolve,
        };
    };
    Promise.delay = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (arguments[1] === undefined) {
            var ms_1 = arguments[0];
            return new Promise(function (resolve) {
                setTimeout(resolve, ms_1);
            });
        }
        return Promise.resolve(arguments[0]).delay(arguments[1]);
    };
    Promise.onUnhandledRejection = function (handler) {
        if (handler === true) {
            Promise._onUnhandledRejectionHandler = rejections_1.defaultUnhandledRejectionHandler;
        }
        else if (handler === false) {
            Promise._onUnhandledRejectionHandler = noop;
        }
        else if (typeof handler !== "function") {
            throw new TypeError("invalid handler: boolean or function expected");
        }
        else {
            Promise._onUnhandledRejectionHandler = handler;
        }
    };
    Promise.onPossiblyUnhandledRejection = function (handler) {
        if (handler === true) {
            Promise._onPossiblyUnhandledRejectionHandler = rejections_1.defaultPossiblyUnhandledRejectionHandler;
        }
        else if (handler === false) {
            Promise._onPossiblyUnhandledRejectionHandler = noop;
        }
        else if (typeof handler !== "function") {
            throw new TypeError("invalid handler: boolean or function expected");
        }
        else {
            Promise._onPossiblyUnhandledRejectionHandler = handler;
        }
    };
    Promise.onPossiblyUnhandledRejectionHandled = function (handler) {
        if (handler === true) {
            Promise._onPossiblyUnhandledRejectionHandledHandler = rejections_1.defaultPossiblyUnhandledRejectionHandledHandler;
        }
        else if (handler === false) {
            Promise._onPossiblyUnhandledRejectionHandledHandler = noop;
        }
        else if (typeof handler !== "function") {
            throw new TypeError("invalid handler: boolean or function expected");
        }
        else {
            Promise._onPossiblyUnhandledRejectionHandledHandler = handler;
        }
    };
    Promise.setLongTraces = function (enable) {
        longTraces = enable;
    };
    Promise.setTracer = function (tracer) {
        if (typeof tracer === "function") {
            trace = tracer;
        }
        else {
            trace = undefined;
        }
    };
    Promise.flush = function () {
        async_1.default.flush();
    };
    Promise._unwrapper = function (handler) {
        handler.promise._unwrap(handler);
    };
    Promise._unhandledRejectionChecker = function (promise) {
        promise._doCheckUnhandledRejection();
    };
    return Promise;
}());
exports.Promise = Promise;
Promise.onUnhandledRejection(true);
Promise.onPossiblyUnhandledRejection(true);
Promise.onPossiblyUnhandledRejectionHandled(true);
exports.default = Promise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvbWlzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlByb21pc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFVQSxpQ0FBNEI7QUFDNUIsMkNBSXNCO0FBQ3RCLGlDQUE0QjtBQUM1QiwrQkFBZ0M7QUErQ2hDLElBQUksS0FBaUUsQ0FBQztBQUV0RSxJQUFJLFVBQVUsR0FBWSxLQUFLLENBQUM7QUFnQmhDLFNBQVMsZ0JBQWdCLENBQUMsT0FBOEIsRUFBRSxNQUE4QjtBQUV4RixDQUFDO0FBRUQsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBRXZDLFNBQVMsSUFBSTtBQUViLENBQUM7QUFNRCxJQUFNLFlBQVksR0FBaUI7SUFDbEMsS0FBSyxFQUFFLFNBQVM7Q0FDaEIsQ0FBQztBQUVGLFNBQVMsWUFBWSxDQUFDLENBQU07SUFJM0IsT0FBTyxDQUFDLENBQUM7QUFDVixDQUFDO0FBaUNELElBQU0sY0FBYyxHQUFHLElBQUksZUFBSyxFQUFFLENBQUM7QUFvRW5DLElBQUksaUJBQTJDLENBQUM7QUFFaEQsSUFBSSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7QUFnQnpCO0lBb0JDLGlCQUNDLFFBR1M7UUFKVixpQkE4REM7UUFqRk8sUUFBRyxHQUFXLGdCQUFnQixFQUFFLENBQUM7UUFDakMsV0FBTSxLQUF3QjtRQUM5QixZQUFPLEdBQVEsU0FBUyxDQUFDO1FBQ3pCLGNBQVMsR0FBdUMsU0FBUyxDQUFDO1FBQzFELFdBQU0sR0FBVyxDQUFDLENBQUM7UUFDbkIsV0FBTSxHQUFzQixTQUFTLENBQUM7UUFvQjdDLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ2xDLElBQUksVUFBVSxFQUFFO1lBQ2YsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLGVBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxJQUFJLGlCQUFpQixFQUFFO2dCQUN0QixJQUFJLENBQUMsVUFBVSxDQUFD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ICpcbiAqIENvcHlyaWdodCAoQykgMjAxNSBNYXJ0aW4gUG9lbHN0cmFcbiAqIExpY2Vuc2U6IE1JVFxuICovXG5cbi8qIHRzbGludDpkaXNhYmxlOm5vLXVudXNlZC1leHByZXNzaW9uICovIC8vIHByZXZlbnQgZXJyb3JzIG9uIGB0cmFjZSAmJiB0cmFjZSguLi4uKWBcbi8qIHRzbGludDpkaXNhYmxlOm5vLWJpdHdpc2UgKi8gLy8gZm9yIGZsYWdzXG5cbmltcG9ydCBhc3luYyBmcm9tIFwiLi9hc3luY1wiO1xuaW1wb3J0IHtcblx0ZGVmYXVsdFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZEhhbmRsZXIsXG5cdGRlZmF1bHRQb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIsXG5cdGRlZmF1bHRVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyLFxufSBmcm9tIFwiLi9yZWplY3Rpb25zXCI7XG5pbXBvcnQgVHJhY2UgZnJvbSBcIi4vVHJhY2VcIjtcbmltcG9ydCB7IGFzc2VydCB9IGZyb20gXCIuL3V0aWxcIjtcblxuZXhwb3J0IGludGVyZmFjZSBUaGVuYWJsZTxUPiB7XG5cdHRoZW48UjEgPSBULCBSMiA9IG5ldmVyPihcblx0XHR0aGlzOiBUaGVuYWJsZTxUPixcblx0XHRvbmZ1bGZpbGxlZD86ICgodmFsdWU6IFQpID0+IFIxfFRoZW5hYmxlPFIxPikgfCBudWxsIHwgdW5kZWZpbmVkLFxuXHRcdG9ucmVqZWN0ZWQ/OiAoKHJlYXNvbjogYW55KSA9PiBSMnxUaGVuYWJsZTxSMj4pIHwgbnVsbCB8IHVuZGVmaW5lZFxuXHQpOiBUaGVuYWJsZTxSMSB8IFIyPjtcblx0dGhlbjxSMSA9IFQ+KFxuXHRcdHRoaXM6IFRoZW5hYmxlPFQ+LFxuXHRcdG9uZnVsZmlsbGVkPzogKCh2YWx1ZTogVCkgPT4gUjF8VGhlbmFibGU8UjE+KSB8IG51bGwgfCB1bmRlZmluZWQsXG5cdFx0b25yZWplY3RlZD86ICgocmVhc29uOiBhbnkpID0+IHZvaWQpIHwgbnVsbCB8IHVuZGVmaW5lZFxuXHQpOiBUaGVuYWJsZTxSMXx2b2lkPjtcbn1cblxuLyoqXG4gKiBBIHRzLXByb21pc2UgaW1wbGVtZW50cyB0aGUgJ3N5bmNocm9ub3VzIGluc3BlY3Rpb24nIGludGVyZmFjZSB3aGljaCBhbGxvd3NcbiAqIHRvIHN5bmNocm9ub3VzbHkgZGV0ZXJtaW5lIHRoZSBwcm9taXNlJ3MgY3VycmVudCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJbnNwZWN0aW9uPFQ+IHtcblx0LyoqXG5cdCAqIEByZXR1cm4gYHRydWVgIHdoZW4gcHJvbWlzZSBpcyBmdWxmaWxsZWQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi9cblx0aXNGdWxmaWxsZWQoKTogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQHJldHVybiBgdHJ1ZWAgd2hlbiBwcm9taXNlIGlzIHJlamVjdGVkLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovXG5cdGlzUmVqZWN0ZWQoKTogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQHJldHVybiBgdHJ1ZWAgd2hlbiBwcm9taXNlIGlzIHBlbmRpbmcgKG1heSBiZSByZXNvbHZlZCB0byBhbm90aGVyIHBlbmRpbmdcblx0ICogICAgICAgICBwcm9taXNlKSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqL1xuXHRpc1BlbmRpbmcoKTogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQHJldHVybiBGdWxmaWxsbWVudCB2YWx1ZSBpZiBmdWxmaWxsZWQsIG90aGVyd2lzZSB0aHJvd3MgYW4gZXJyb3IuXG5cdCAqL1xuXHR2YWx1ZSgpOiBUO1xuXG5cdC8qKlxuXHQgKiBAcmV0dXJuIFJlamVjdGlvbiByZWFzb24gaWYgcmVqZWN0ZWQsIG90aGVyd2lzZSB0aHJvd3MgYW4gZXJyb3IuXG5cdCAqL1xuXHRyZWFzb24oKTogYW55O1xufVxuXG5sZXQgdHJhY2U6ICgocHJvbWlzZTogUHJvbWlzZTxhbnk+LCBtc2c6IHN0cmluZykgPT4gdm9pZCkgfCB1bmRlZmluZWQ7XG5cbmxldCBsb25nVHJhY2VzOiBib29sZWFuID0gZmFsc2U7XG5cbmNvbnN0IGVudW0gU3RhdGUge1xuXHRQZW5kaW5nLFxuXHRGdWxmaWxsZWQsXG5cdFJlamVjdGVkLFxufVxuXG4vKipcbiAqIEJpdCBmbGFncyBhYm91dCBhIFByb21pc2UncyBpbnRlcm5hbCBzdGF0ZS5cbiAqL1xuY29uc3QgZW51bSBGbGFncyB7XG5cdFJlamVjdGlvbkhhbmRsZWQgPSAxLFxuXHRVbmhhbmRsZWRSZWplY3Rpb25Ob3RpZmllZCA9IDIsXG59XG5cbmZ1bmN0aW9uIGludGVybmFsUmVzb2x2ZXIoZnVsZmlsbD86ICh2YWx1ZTogYW55KSA9PiB2b2lkLCByZWplY3Q/OiAocmVhc29uOiBhbnkpID0+IHZvaWQpOiB2b2lkIHtcblx0Lyogbm8tb3AsIHNlbnRpbmVsIHZhbHVlICovXG59XG5cbmludGVybmFsUmVzb2x2ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQpOyAvLyBqdXN0IGZvciBjb2RlIGNvdmVyYWdlLi4uXG5cbmZ1bmN0aW9uIG5vb3AoKTogdm9pZCB7XG5cdC8qIG5vLW9wICovXG59XG5cbmludGVyZmFjZSBHZXRUaGVuRXJyb3Ige1xuXHRlcnJvcjogYW55O1xufVxuXG5jb25zdCBnZXRUaGVuRXJyb3I6IEdldFRoZW5FcnJvciA9IHtcblx0ZXJyb3I6IHVuZGVmaW5lZCxcbn07XG5cbmZ1bmN0aW9uIHdyYXBOb25FcnJvcihhOiBhbnkpOiBFcnJvciB7XG5cdC8vIFRoaXMgaXMgYmFzaWNhbGx5IGEgbWFya2VyIGZvciB0aGUgcGxhY2VzIHdoZXJlIHdlIG5lZWQgdG8gY2hlY2tcblx0Ly8gaGFuZGxpbmcgb2YgZXJyb3JzIGZvciAuZXJyb3IoKSBzdXBwb3J0LlxuXHQvLyBBIG5vLW9wIGZvciBub3cuXG5cdHJldHVybiBhO1xufVxuXG50eXBlIEZ1bGZpbGxtZW50SGFuZGxlcjxULCBSPiA9ICgodmFsdWU6IFQpID0+IFJ8VGhlbmFibGU8Uj4pIHwgbnVsbCB8IHVuZGVmaW5lZDtcbnR5cGUgUmVqZWN0aW9uSGFuZGxlcjxSPiA9ICgocmVhc29uOiBhbnkpID0+IFJ8VGhlbmFibGU8Uj4pIHwgbnVsbCB8IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBTdWJzY3JpcHRpb24gdG8gYmUgbm90aWZpZWQgd2hlbiBwcm9taXNlIHJlc29sdmVzLlxuICpcbiAqIFdoZW4gYSBIYW5kbGVyIGlzIGF0dGFjaGVkIHRvIGFuIHVucmVzb2x2ZWQgcHJvbWlzZSwgaXQncyBhZGRlZCB0byBpdHMgcXVldWUsXG4gKiB3aGljaCBpcyBmbHVzaGVkIGFzIHNvb24gYXMgdGhlIHByb21pc2UgcmVzb2x2ZXMuXG4gKiBXaGVuIGEgSGFuZGxlciBpcyBhdHRhY2hlZCB0byBhIHJlc29sdmVkIHByb21pc2UsIGl0J3Mgc2NoZWR1bGVkIGltbWVkaWF0ZWx5XG4gKiAoYnV0IHN0aWxsIGFzeW5jaHJvbm91c2x5KS5cbiAqXG4gKiBBIEhhbmRsZXIgaXMgdXNlZCBmb3IgMyBkaWZmZXJlbnQgY2FzZXM6XG4gKiAxLiBjYWxsaW5nIHRoZSBvbkZ1bGZpbGxlZC9vblJlamVjdGVkIGNhbGxiYWNrcyBvZiAudGhlbigpXG4gKiAyLiBjYWxsaW5nIHRoZSBvbkZ1bGZpbGxlZC9vblJlamVjdGVkIGNhbGxiYWNrcyBvZiAuZG9uZSgpXG4gKiAzLiB3YWl0aW5nIGZvciBhIHByb21pc2UgcmV0dXJuZWQgZnJvbSBhbiBvbkZ1bGZpbGxlZC9vblJlamVjdGVkIGNhbGxiYWNrIHRvXG4gKiAgICBiZSByZXNvbHZlZCAoaS5lLiB0aGF0IHByb21pc2UgaXMgJ2ZvbGxvd2luZycgdXMpXG4gKlxuICogYHByb21pc2VgIGlzIGFsd2F5cyB0aGUgcHJvbWlzZSB0aGF0IHdhcyByZXNvbHZlZCwgaS5lLiB0aGUgJ3NvdXJjZSdcbiAqIG9uRnVsZmlsbGVkL29uUmVqZWN0ZWQgYXJlIHRoZSBjYWxsYmFja3Mgb2YgdGhlIC50aGVuKCkvLmRvbmUoKSwgb3IgYm90aFxuICogYHVuZGVmaW5lZGAgaW4gY2FzZSBvZiBhIGZvbGxvd2VyIChjYXNlIDMpLlxuICogSW4gYWxsIGNhc2VzLCBgc2xhdmVgIGlzIHRoZSBwcm9taXNlIHRoYXQgZGVwZW5kcyBvbiBvdXIgcmVzdWx0LCBhbmQvb3IgdGhlXG4gKiBjYWxsYmFjaydzIHJlc3VsdC5cbiAqL1xuaW50ZXJmYWNlIEhhbmRsZXI8VCwgUj4ge1xuXHRwcm9taXNlOiBQcm9taXNlPFQ+O1xuXHRvbkZ1bGZpbGxlZDogRnVsZmlsbG1lbnRIYW5kbGVyPFQsIFI+O1xuXHRvblJlamVjdGVkOiBSZWplY3Rpb25IYW5kbGVyPFI+O1xuXHRzbGF2ZTogUHJvbWlzZTxSPiB8IHVuZGVmaW5lZDsgLy8gV2lsbCBiZSB1bmRlZmluZWQgaWYgZG9uZSBpcyB0cnV0aHlcblx0ZG9uZTogVHJhY2UgfCB1bmRlZmluZWQ7IC8vIFdpbGwgYmUgdW5kZWZpbmVkIGlmIHNsYXZlIGlzIHRydXRoeVxufVxuXG5jb25zdCBkdW1teURvbmVUcmFjZSA9IG5ldyBUcmFjZSgpO1xuXG4vKipcbiAqIENvbWJpbmF0aW9uIG9mIGEgcHJvbWlzZSBhbmQgaXRzIHJlc29sdmUvcmVqZWN0IGZ1bmN0aW9ucy5cbiAqIENyZWF0ZWQgdXNpbmcgUHJvbWlzZS5kZWZlcigpLlxuICpcbiAqIEl0IGlzIGdlbmVyYWxseSBiZXR0ZXIgKGFuZCBzbGlnaHRseSBmYXN0ZXIpIHRvIHVzZSB0aGUgUHJvbWlzZVxuICogY29uc3RydWN0b3IgdG8gY3JlYXRlIGEgcHJvbWlzZSwgYXMgdGhhdCB3aWxsIGFsc28gY2F0Y2ggYW55IGV4Y2VwdGlvblxuICogdGhyb3duIHdoaWxlIHJ1bm5pbmcgdGhlIHJlc29sdmVyLlxuICpcbiAqIEEgRGVmZXJyZWQgY2FuIGJlIHVzZWZ1bCBpbiBzb21lIHNjZW5hcmlvcyB0aG91Z2gsIGUuZy4gd2hlbiB3b3JraW5nIHdpdGhcbiAqIHRpbWVycywgcHJvdG9jb2wgcmVxdWVzdC9yZXNwb25zZSBwYWlycywgZXRjLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERlZmVycmVkPFQ+IHtcblx0LyoqXG5cdCAqIEluaXRpYWxseSB1bnJlc29sdmVkIHByb21pc2UsIHJlc29sdmVkIGJ5IHRoZSByZXNvbHZlIG9yIHJlamVjdFxuXHQgKiBmdW5jdGlvbiBvbiB0aGlzIG9iamVjdC5cblx0ICovXG5cdHByb21pc2U6IFByb21pc2U8VD47XG5cblx0LyoqXG5cdCAqIFJlamVjdCBjb3JyZXNwb25kaW5nIHByb21pc2UuXG5cdCAqIFRoZSBmaXJzdCBjYWxsIHRvIGVpdGhlciByZXNvbHZlIG9yIHJlamVjdCByZXNvbHZlcyB0aGUgcHJvbWlzZSwgYW55XG5cdCAqIG90aGVyIGNhbGxzIGFyZSBpZ25vcmVkLlxuXHQgKiBUaGlzIGZ1bmN0aW9uIGlzIGEgZnJlZSBmdW5jdGlvbiAoaS5lLiBub3QgYSAnbWV0aG9kJyBvbiB0aGlzIG9iamVjdCkuXG5cdCAqL1xuXHRyZWplY3Q6IChyZWFzb246IEVycm9yKSA9PiB2b2lkO1xuXG5cdC8qKlxuXHQgKiBSZXNvbHZlIGNvcnJlc3BvbmRpbmcgcHJvbWlzZS5cblx0ICogVGhlIGZpcnN0IGNhbGwgdG8gZWl0aGVyIHJlc29sdmUgb3IgcmVqZWN0IHJlc29sdmVzIHRoZSBwcm9taXNlLCBhbnlcblx0ICogb3RoZXIgY2FsbHMgYXJlIGlnbm9yZWQuXG5cdCAqIFRoaXMgZnVuY3Rpb24gaXMgYSBmcmVlIGZ1bmN0aW9uIChpLmUuIG5vdCBhICdtZXRob2QnIG9uIHRoaXMgb2JqZWN0KS5cblx0ICogTm90ZTogcmVzb2x2aW5nIHdpdGggYSByZWplY3RlZCBUaGVuYWJsZSBsZWFkcyB0byBhIHJlamVjdGVkIHByb21pc2UuXG5cdCAqL1xuXHRyZXNvbHZlOiAodmFsdWU6IFR8VGhlbmFibGU8VD4pID0+IHZvaWQ7XG59XG5cbi8qKlxuICogQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBEZWZlcnJlZCB0aGF0IGFsbG93cyBjYWxsaW5nIHJlc29sdmUoKSB3aXRob3V0IGFuXG4gKiBhcmd1bWVudC5cbiAqXG4gKiBEZWZlcnJlZCBpcyBhIGNvbWJpbmF0aW9uIG9mIGEgcHJvbWlzZSBhbmQgaXRzIHJlc29sdmUvcmVqZWN0IGZ1bmN0aW9ucy5cbiAqIENyZWF0ZWQgdXNpbmcgUHJvbWlzZS5kZWZlcigpLlxuICpcbiAqIEl0IGlzIGdlbmVyYWxseSBiZXR0ZXIgKGFuZCBzbGlnaHRseSBmYXN0ZXIpIHRvIHVzZSB0aGUgUHJvbWlzZVxuICogY29uc3RydWN0b3IgdG8gY3JlYXRlIGEgcHJvbWlzZSwgYXMgdGhhdCB3aWxsIGFsc28gY2F0Y2ggYW55IGV4Y2VwdGlvblxuICogdGhyb3duIHdoaWxlIHJ1bm5pbmcgdGhlIHJlc29sdmVyLlxuICpcbiAqIEEgRGVmZXJyZWQgY2FuIGJlIHVzZWZ1bCBpbiBzb21lIHNjZW5hcmlvcyB0aG91Z2gsIGUuZy4gd2hlbiB3b3JraW5nIHdpdGhcbiAqIHRpbWVycywgcHJvdG9jb2wgcmVxdWVzdC9yZXNwb25zZSBwYWlycywgZXRjLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZvaWREZWZlcnJlZCBleHRlbmRzIERlZmVycmVkPHZvaWQ+IHtcblx0LyoqXG5cdCAqIFJlc29sdmUgY29ycmVzcG9uZGluZyBwcm9taXNlLlxuXHQgKiBUaGUgZmlyc3QgY2FsbCB0byBlaXRoZXIgcmVzb2x2ZSBvciByZWplY3QgcmVzb2x2ZXMgdGhlIHByb21pc2UsIGFueVxuXHQgKiBvdGhlciBjYWxscyBhcmUgaWdub3JlZC5cblx0ICogVGhpcyBmdW5jdGlvbiBpcyBhIGZyZWUgZnVuY3Rpb24gKGkuZS4gbm90IGEgJ21ldGhvZCcgb24gdGhpcyBvYmplY3QpLlxuXHQgKiBOb3RlOiByZXNvbHZpbmcgd2l0aCBhIHJlamVjdGVkIFRoZW5hYmxlIGxlYWRzIHRvIGEgcmVqZWN0ZWQgcHJvbWlzZS5cblx0ICovXG5cdHJlc29sdmU6ICh2YWx1ZT86IHZvaWR8VGhlbmFibGU8dm9pZD4pID0+IHZvaWQ7XG59XG5cbi8qKlxuICogQ3VycmVudGx5IHVud3JhcHBpbmcgcHJvbWlzZSwgd2hpbGUgcnVubmluZyBvbmUgb2YgaXRzIHRoZW4tY2FsbGJhY2tzLlxuICogVXNlZCB0byBzZXQgdGhlIHNvdXJjZSBvZiBuZXdseSBjcmVhdGVkIHByb21pc2VzLlxuICogV2UgZ3VhcmFudGVlIHRoYXQgYXQgbW9zdCBvbmUgY2FsbGJhY2sgb2YgYSB0aGVuKCkgaXMgcnVubmluZyBhdCBhbnkgdGltZS5cbiAqL1xubGV0IHVud3JhcHBpbmdQcm9taXNlOiBQcm9taXNlPGFueT4gfCB1bmRlZmluZWQ7XG5cbmxldCBwcm9taXNlSWRDb3VudGVyID0gMDtcblxuLyoqXG4gKiBHZW5lcmljIEVycm9yIGNsYXNzIGRlc2NyaXB0b3IuXG4gKlxuICogQWxsb3dzIHRvIHBhc3MgY2xhc3NlcyB0byBlLmcuIGBQcm9taXNlLmNhdGNoKClgIHdoaWNoIGRlcml2ZSBmcm9tIEVycm9yLlxuICovXG5leHBvcnQgdHlwZSBFcnJvckNsYXNzID0gbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gRXJyb3I7XG5cbmV4cG9ydCB0eXBlIFVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIgPSAocmVhc29uOiBhbnksIGRvbmVUcmFjZTogVHJhY2UpID0+IHZvaWQ7XG5leHBvcnQgdHlwZSBQb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIgPSAocHJvbWlzZTogUHJvbWlzZTxhbnk+KSA9PiB2b2lkO1xuZXhwb3J0IHR5cGUgUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlciA9IChwcm9taXNlOiBQcm9taXNlPGFueT4pID0+IHZvaWQ7XG5cbi8qKlxuICogRmFzdCwgcm9idXN0LCB0eXBlLXNhZmUgcHJvbWlzZSBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuZXhwb3J0IGNsYXNzIFByb21pc2U8VD4gaW1wbGVtZW50cyBUaGVuYWJsZTxUPiwgSW5zcGVjdGlvbjxUPiB7XG5cdHByaXZhdGUgX2lkOiBudW1iZXIgPSBwcm9taXNlSWRDb3VudGVyKys7XG5cdHByaXZhdGUgX3N0YXRlOiBTdGF0ZSA9IFN0YXRlLlBlbmRpbmc7XG5cdHByaXZhdGUgX3Jlc3VsdDogYW55ID0gdW5kZWZpbmVkOyAvLyBDYW4gYmUgZnVsZmlsbG1lbnQgdmFsdWUgb3IgcmVqZWN0aW9uIHJlYXNvblxuXHRwcml2YXRlIF9oYW5kbGVyczogQXJyYXk8SGFuZGxlcjxULCBhbnk+PiB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblx0cHJpdmF0ZSBfZmxhZ3M6IG51bWJlciA9IDA7XG5cdHByaXZhdGUgX3RyYWNlOiBUcmFjZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuXHRwcml2YXRlIHN0YXRpYyBfb25VbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyOiBVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyO1xuXHRwcml2YXRlIHN0YXRpYyBfb25Qb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXI6IFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlcjtcblx0cHJpdmF0ZSBzdGF0aWMgX29uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlcjogUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlcjtcblxuXHQvKipcblx0ICogQ3JlYXRlIG5ldyBQcm9taXNlLlxuXHQgKlxuXHQgKiBQYXNzIGEgY2FsbGJhY2sgdGhhdCB3aWxsIHJlY2VpdmUgYSBgcmVzb2x2ZSgpYCBhbmQgYHJlamVjdCgpYCBmdW5jdGlvblxuXHQgKiB0byBzZWFsIHRoZSBwcm9taXNlJ3MgZmF0ZS5cblx0ICpcblx0ICogQHBhcmFtICByZXNvbHZlciBDYWxsZWQgd2l0aCByZXNvbHZlIGFuZCByZWplY3QgZnVuY3Rpb25zXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRyZXNvbHZlcjogKFxuXHRcdFx0cmVzb2x2ZTogKHZhbHVlOiBUfFRoZW5hYmxlPFQ+KSA9PiB2b2lkLFxuXHRcdFx0cmVqZWN0OiAocmVhc29uOiBFcnJvcikgPT4gdm9pZFxuXHRcdCkgPT4gdm9pZFxuXHQpIHtcblx0XHR0cmFjZSAmJiB0cmFjZSh0aGlzLCBcImNvbnN0cnVjdFwiKTtcblx0XHRpZiAobG9uZ1RyYWNlcykge1xuXHRcdFx0dGhpcy5fdHJhY2UgPSBuZXcgVHJhY2UoUHJvbWlzZSk7XG5cdFx0XHRpZiAodW53cmFwcGluZ1Byb21pc2UpIHtcblx0XHRcdFx0dGhpcy5fc2V0U291cmNlKHVud3JhcHBpbmdQcm9taXNlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAocmVzb2x2ZXIgPT09IGludGVybmFsUmVzb2x2ZXIpIHtcblx0XHRcdC8vIEludGVybmFsbHkgY3JlYXRlZCBwcm9taXNlcyBwYXNzICdpbnRlcm5hbFJlc29sdmVyJywgc2lnbmFsbGluZ1xuXHRcdFx0Ly8gdGhhdCByZXNvbHZpbmcgd2lsbCBiZSBkb25lIGJ5IGNhbGxpbmcgcHJpdmF0ZSBtZXRob2RzIG9uIHRoZVxuXHRcdFx0Ly8gUHJvbWlzZS4gVGhpcyBzYXZlcyBoYXZpbmcgdG8gY3JlYXRlIDIgY2xvc3VyZXMuXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiByZXNvbHZlciAhPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJvbWlzZSByZXNvbHZlciBpcyBub3QgYSBmdW5jdGlvblwiKTtcblx0XHR9XG5cblx0XHRsZXQgY2FsbGVkID0gZmFsc2U7XG5cdFx0dHJ5IHtcblx0XHRcdHJlc29sdmVyKFxuXHRcdFx0XHQoeTogVCB8IFRoZW5hYmxlPFQ+KTogdm9pZCA9PiB7XG5cdFx0XHRcdFx0aWYgKGNhbGxlZCkge1xuXHRcdFx0XHRcdFx0Ly8gMi4zLjMuMy4zOiBJZiBib3RoIGByZXNvbHZlUHJvbWlzZWAgYW5kIGByZWplY3RQcm9taXNlYCBhcmUgY2FsbGVkLFxuXHRcdFx0XHRcdFx0Ly8gb3IgbXVsdGlwbGUgY2FsbHMgdG8gdGhlIHNhbWUgYXJndW1lbnQgYXJlIG1hZGUsIHRoZSBmaXJzdCBjYWxsXG5cdFx0XHRcdFx0XHQvLyB0YWtlcyBwcmVjZWRlbmNlLCBhbmQgYW55IGZ1cnRoZXIgY2FsbHMgYXJlIGlnbm9yZWQuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vIDIuMy4zLjMuMTogSWYvd2hlbiBgcmVzb2x2ZVByb21pc2VgIGlzIGNhbGxlZCB3aXRoIHZhbHVlIGB5YCxcblx0XHRcdFx0XHQvLyBydW4gYFtbUmVzb2x2ZV1dKHByb21pc2UsIHkpYFxuXHRcdFx0XHRcdGNhbGxlZCA9IHRydWU7XG5cdFx0XHRcdFx0dGhpcy5fcmVzb2x2ZSh5KTtcblx0XHRcdFx0fSxcblx0XHRcdFx0KHI6IGFueSk6IHZvaWQgPT4ge1xuXHRcdFx0XHRcdGlmIChjYWxsZWQpIHtcblx0XHRcdFx0XHRcdC8vIDIuMy4zLjMuMzogSWYgYm90aCBgcmVzb2x2ZVByb21pc2VgIGFuZCBgcmVqZWN0UHJvbWlzZWAgYXJlIGNhbGxlZCxcblx0XHRcdFx0XHRcdC8vIG9yIG11bHRpcGxlIGNhbGxzIHRvIHRoZSBzYW1lIGFyZ3VtZW50IGFyZSBtYWRlLCB0aGUgZmlyc3QgY2FsbFxuXHRcdFx0XHRcdFx0Ly8gdGFrZXMgcHJlY2VkZW5jZSwgYW5kIGFueSBmdXJ0aGVyIGNhbGxzIGFyZSBpZ25vcmVkLlxuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQvLyAyLjMuMy4zLjI6IElmL3doZW4gYHJlamVjdFByb21pc2VgIGlzIGNhbGxlZCB3aXRoIHJlYXNvbiBgcmAsXG5cdFx0XHRcdFx0Ly8gcmVqZWN0IGBwcm9taXNlYCB3aXRoIGByYFxuXHRcdFx0XHRcdGNhbGxlZCA9IHRydWU7XG5cdFx0XHRcdFx0dGhpcy5fcmVqZWN0KHdyYXBOb25FcnJvcihyKSk7XG5cdFx0XHRcdH1cblx0XHRcdCk7XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0Ly8gMi4zLjMuMy40OiBJZiBjYWxsaW5nIGB0aGVuYCB0aHJvd3MgYW4gZXhjZXB0aW9uIGBlYCxcblx0XHRcdC8vIDIuMy4zLjMuNC4xOiBJZiBgcmVzb2x2ZVByb21pc2VgIG9yIGByZWplY3RQcm9taXNlYCBoYXZlIGJlZW4gY2FsbGVkLCBpZ25vcmUgaXQuXG5cdFx0XHRpZiAoIWNhbGxlZCkge1xuXHRcdFx0XHQvLyAyLjMuMy4zLjQuMjogT3RoZXJ3aXNlLCByZWplY3QgYHByb21pc2VgIHdpdGggYGVgIGFzIHRoZSByZWFzb24uXG5cdFx0XHRcdGNhbGxlZCA9IHRydWU7XG5cdFx0XHRcdHRoaXMuX3JlamVjdCh3cmFwTm9uRXJyb3IoZSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBSdW4gZWl0aGVyIGBvbkZ1bGZpbGxlZGAgb3IgYG9uUmVqZWN0ZWRgIGNhbGxiYWNrcyB3aGVuIHRoZSBwcm9taXNlIGlzXG5cdCAqIHJlc29sdmVkLiBSZXR1cm5zIGFub3RoZXIgcHJvbWlzZSBmb3IgdGhlIHJldHVybiB2YWx1ZSBvZiBzdWNoIGFcblx0ICogY2FsbGJhY2suXG5cdCAqXG5cdCAqIFRoZSBjYWxsYmFjayB3aWxsIGFsd2F5cyBiZSBjYWxsZWQgYXQgbW9zdCBvbmNlLCBhbmQgYWx3YXlzXG5cdCAqIGFzeW5jaHJvbm91c2x5IChpLmUuIHNvbWUgdGltZSBhZnRlciBlLmcuIHRoZSBgcmVzb2x2ZXJgIHBhc3NlZCB0byB0aGVcblx0ICogY29uc3RydWN0b3IgaGFzIHJlc29sdmVkIHRoZSBwcm9taXNlKS5cblx0ICpcblx0ICogQW55IGVycm9yIHRocm93biBvciByZWplY3RlZCBwcm9taXNlIHJldHVybmVkIGZyb20gYSBjYWxsYmFjayB3aWxsIGNhdXNlXG5cdCAqIHRoZSByZXR1cm5lZCBwcm9taXNlIHRvIGJlIHJlamVjdGVkIHdpdGggdGhhdCBlcnJvci5cblx0ICpcblx0ICogSWYgZWl0aGVyIG9yIGJvdGggY2FsbGJhY2tzIGFyZSBtaXNzaW5nLCB0aGUgZnVsZmlsbG1lbnQgb3IgcmVqZWN0aW9uIGlzXG5cdCAqIHBhc3NlZCBvbiB1bm1vZGlmaWVkLlxuXHQgKlxuXHQgKiBVc2UgYC5jYXRjaChvblJlamVjdGVkKWAgaW5zdGVhZCBvZiBgLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKWAgZm9yXG5cdCAqIHN0cm9uZ2VyIHR5cGluZywgYmV0dGVyIHJlYWRhYmlsaXR5LCBhbmQgbW9yZSBmdW5jdGlvbmFsaXR5IChwcmVkaWNhdGVzKS5cblx0ICpcblx0ICogQHBhcmFtIG9uRnVsZmlsbGVkIENhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyBmdWxmaWxsbWVudFxuXHQgKiAgICAgICAgICAgICAgICAgICAgdmFsdWUgaWZmIHByb21pc2UgaXMgZnVsZmlsbGVkLiBDYWxsYmFjayBjYW4gcmV0dXJuXG5cdCAqICAgICAgICAgICAgICAgICAgICBhbm90aGVyIHZhbHVlIG9yIHByb21pc2UgZm9yIGEgdmFsdWUuXG5cdCAqIEBwYXJhbSBvblJlamVjdGVkICBPcHRpb25hbCBjYWxsYmFjayBjYWxsZWQgd2l0aCBwcm9taXNlJ3MgcmVqZWN0aW9uXG5cdCAqICAgICAgICAgICAgICAgICAgICByZWFzb24gaWZmIHByb21pc2UgaXMgcmVqZWN0ZWQuIENhbGxiYWNrIGNhbiByZXR1cm5cblx0ICogICAgICAgICAgICAgICAgICAgIGFub3RoZXIgdmFsdWUgb3IgcHJvbWlzZSBmb3IgYSB2YWx1ZS5cblx0ICogQHJldHVybiBQcm9taXNlIGZvciB2YWx1ZSByZXR1cm5lZCBieSBlaXRoZXIgb2YgdGhlIGNhbGxiYWNrc1xuXHQgKi9cblx0cHVibGljIHRoZW48UjEgPSBULCBSMiA9IG5ldmVyPihcblx0XHRvbkZ1bGZpbGxlZDogKCh2YWx1ZTogVCkgPT4gUjF8VGhlbmFibGU8UjE+KSB8IG51bGwgfCB1bmRlZmluZWQsXG5cdFx0b25SZWplY3RlZD86ICgocmVhc29uOiBhbnkpID0+IFIyfFRoZW5hYmxlPFIyPikgfCBudWxsIHwgdW5kZWZpbmVkXG5cdCk6IFByb21pc2U8UjEgfCBSMj4ge1xuXHRcdHRyYWNlICYmIHRyYWNlKHRoaXMsIGB0aGVuKCR7dHlwZW9mIG9uRnVsZmlsbGVkfSwgJHt0eXBlb2Ygb25SZWplY3RlZH0pYCk7XG5cblx0XHRpZiAodGhpcy5fc3RhdGUgPT09IFN0YXRlLkZ1bGZpbGxlZCAmJiB0eXBlb2Ygb25GdWxmaWxsZWQgIT09IFwiZnVuY3Rpb25cIiB8fFxuXHRcdFx0dGhpcy5fc3RhdGUgPT09IFN0YXRlLlJlamVjdGVkICYmIHR5cGVvZiBvblJlamVjdGVkICE9PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdC8vIE9wdGltaXphdGlvbjogaGFuZGxlciBpcyBzaG9ydC1jaXJjdWl0ZWQsIHNvIHBhc3MgdGhlIHJlc3VsdCAodmFsdWUvcmVqZWN0aW9uKVxuXHRcdFx0Ly8gdGhyb3VnaCB1bm1vZGlmaWVkLlxuXHRcdFx0Ly8gVGhlIHR5cGVjYXN0IGlzIHNhZmUsIGJlY2F1c2Ugd2UgZWl0aGVyIGhhdmUgYSBmdWxmaWxsbWVudCB2YWx1ZVxuXHRcdFx0Ly8gYnV0IG5vIGhhbmRsZXIgdGhhdCBjb3VsZCBjaGFuZ2UgdGhlIHR5cGUsIG9yIGEgcmVqZWN0aW9uIHdpdGhvdXQgYVxuXHRcdFx0Ly8gaGFuZGxlciB0aGF0IGNvdWxkIGNoYW5nZSBpdCwgc28gUiA9PT0gVCBpbiB0aGlzIGNhc2UuXG5cdFx0XHQvLyBUT0RPOiB2ZXJpZnkgd2hldGhlciBsb25nVHJhY2VzIGV0YyBzdGlsbCB3b3JrIGFzIGV4cGVjdGVkXG5cdFx0XHRyZXR1cm4gPFByb21pc2U8YW55Pj50aGlzO1xuXHRcdH1cblxuXHRcdC8vIENvbnN0cnVjdCBuZXcgUHJvbWlzZSwgYnV0IHVzZSBzdWJjbGFzc2VkIGNvbnN0cnVjdG9yLCBpZiBhbnlcblx0XHRjb25zdCBzbGF2ZSA9IG5ldyAoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yKShpbnRlcm5hbFJlc29sdmVyKTtcblx0XHRzbGF2ZS5fc2V0U291cmNlKHRoaXMpO1xuXHRcdHRoaXMuX2VucXVldWUob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHNsYXZlLCB1bmRlZmluZWQpO1xuXHRcdHJldHVybiBzbGF2ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSdW4gZWl0aGVyIGBvbkZ1bGZpbGxlZGAgb3IgYG9uUmVqZWN0ZWRgIGNhbGxiYWNrcyB3aGVuIHRoZSBwcm9taXNlIGlzXG5cdCAqIHJlc29sdmVkLiBJZiB0aGUgY2FsbGJhY2sgdGhyb3dzIGFuIGVycm9yIG9yIHRoZSByZXR1cm5lZCB2YWx1ZSByZXNvbHZlc1xuXHQgKiB0byBhIHJlamVjdGlvbiwgdGhlIGxpYnJhcnkgd2lsbCAoYXN5bmNocm9ub3VzbHkpIHRocm93IGFuXG5cdCAqIGBVbmhhbmRsZWRSZWplY3Rpb25FcnJvcmAgd2l0aCB0aGF0IGVycm9yLlxuXHQgKlxuXHQgKiBUaGUgY2FsbGJhY2sgd2lsbCBhbHdheXMgYmUgY2FsbGVkIGF0IG1vc3Qgb25jZSwgYW5kIGFsd2F5c1xuXHQgKiBhc3luY2hyb25vdXNseSAoaS5lLiBzb21lIHRpbWUgYWZ0ZXIgZS5nLiB0aGUgYHJlc29sdmVyYCBwYXNzZWQgdG8gdGhlXG5cdCAqIGNvbnN0cnVjdG9yIGhhcyByZXNvbHZlZCB0aGUgcHJvbWlzZSkuXG5cdCAqXG5cdCAqIEBwYXJhbSBvbkZ1bGZpbGxlZCBPcHRpb25hbCBjYWxsYmFjayBjYWxsZWQgd2l0aCBwcm9taXNlJ3MgZnVsZmlsbG1lbnRcblx0ICogICAgICAgICAgICAgICAgICAgIHZhbHVlIGlmZiBwcm9taXNlIGlzIGZ1bGZpbGxlZC4gQW55IGVycm9yIHRocm93biBvclxuXHQgKiAgICAgICAgICAgICAgICAgICAgcmVqZWN0aW9uIHJldHVybmVkIHdpbGwgY2F1c2UgYW4gVW5oYW5kbGVkUmVqZWN0aW9uRXJyb3Jcblx0ICogICAgICAgICAgICAgICAgICAgIHRvIGJlIHRocm93bi5cblx0ICogQHBhcmFtIG9uUmVqZWN0ZWQgIE9wdGlvbmFsIGNhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyByZWplY3Rpb25cblx0ICogICAgICAgICAgICAgICAgICAgIHJlYXNvbiBpZmYgcHJvbWlzZSBpcyByZWplY3RlZC4gQW55IGVycm9yIHRocm93biBvclxuXHQgKiAgICAgICAgICAgICAgICAgICAgcmVqZWN0aW9uIHJldHVybmVkIHdpbGwgY2F1c2UgYW4gVW5oYW5kbGVkUmVqZWN0aW9uRXJyb3Jcblx0ICogICAgICAgICAgICAgICAgICAgIHRvIGJlIHRocm93bi5cblx0ICovXG5cdHB1YmxpYyBkb25lPFI+KFxuXHRcdG9uRnVsZmlsbGVkPzogKCh2YWx1ZTogVCkgPT4gdm9pZHxUaGVuYWJsZTx2b2lkPikgfCBudWxsIHwgdW5kZWZpbmVkLFxuXHRcdG9uUmVqZWN0ZWQ/OiAoKHJlYXNvbjogYW55KSA9PiB2b2lkfFRoZW5hYmxlPHZvaWQ+KSB8IG51bGwgfCB1bmRlZmluZWRcblx0KTogdm9pZCB7XG5cdFx0dHJhY2UgJiYgdHJhY2UodGhpcywgYGRvbmUoJHt0eXBlb2Ygb25GdWxmaWxsZWR9LCAke3R5cGVvZiBvblJlamVjdGVkfSlgKTtcblx0XHRpZiAodGhpcy5fc3RhdGUgPT09IFN0YXRlLkZ1bGZpbGxlZCAmJiB0eXBlb2Ygb25GdWxmaWxsZWQgIT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGxldCBkb25lVHJhY2UgPSBkdW1teURvbmVUcmFjZTtcblx0XHRpZiAobG9uZ1RyYWNlcykge1xuXHRcdFx0ZG9uZVRyYWNlID0gbmV3IFRyYWNlKCk7XG5cdFx0XHRpZiAodGhpcy5fdHJhY2UpIHtcblx0XHRcdFx0ZG9uZVRyYWNlLnNldFNvdXJjZSh0aGlzLl90cmFjZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5fZW5xdWV1ZShvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCwgdW5kZWZpbmVkLCBkb25lVHJhY2UpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhdGNoIGFsbCBlcnJvcnMgaW4gY2FzZSBwcm9taXNlIGlzIHJlamVjdGVkLlxuXHQgKlxuXHQgKiBUaGUgcmV0dXJuZWQgcHJvbWlzZSBpcyByZXNvbHZlZCB3aXRoIHRoZSBvdXRwdXQgb2YgdGhlIGNhbGxiYWNrLCBzbyBpdFxuXHQgKiBpcyBwb3NzaWJsZSB0byByZS10aHJvdyB0aGUgZXJyb3IsIGJ1dCBhbHNvIHRvIHJldHVybiBhICdyZXBsYWNlbWVudCdcblx0ICogdmFsdWUgdGhhdCBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBDb252ZW5pZW5jZSBoZWxwZXIgZm9yIGAudGhlbih1bmRlZmluZWQsIG9uUmVqZWN0ZWQpYC5cblx0ICpcblx0ICogQHBhcmFtIG9uUmVqZWN0ZWQgIENhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyByZWplY3Rpb24gcmVhc29uIGlmZlxuXHQgKiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSBpcyByZWplY3RlZC4gQ2FsbGJhY2sgY2FuIHJldHVybiBhbm90aGVyIHZhbHVlXG5cdCAqICAgICAgICAgICAgICAgICAgICBvciBwcm9taXNlIGZvciBhIHZhbHVlLlxuXHQgKiBAcmV0dXJuIFByb21pc2UgZm9yIG9yaWdpbmFsIHZhbHVlLCBvciAncmVwbGFjZWQnIHZhbHVlIGluIGNhc2Ugb2YgZXJyb3Jcblx0ICovXG5cdHB1YmxpYyBjYXRjaDxSPihvblJlamVjdGVkOiAocmVhc29uOiBhbnkpID0+IFJ8VGhlbmFibGU8Uj4pOiBQcm9taXNlPFR8Uj47XG5cdC8qKlxuXHQgKiBDYXRjaCBvbmx5IGVycm9ycyBvZiB0aGUgc3BlY2lmaWVkIGNsYXNzKGVzKSBpbiBjYXNlIHByb21pc2UgaXMgcmVqZWN0ZWQuXG5cdCAqXG5cdCAqIFRoZSByZXR1cm5lZCBwcm9taXNlIGlzIHJlc29sdmVkIHdpdGggdGhlIG91dHB1dCBvZiB0aGUgY2FsbGJhY2ssIHNvIGl0XG5cdCAqIGlzIHBvc3NpYmxlIHRvIHJlLXRocm93IHRoZSBlcnJvciwgYnV0IGFsc28gdG8gcmV0dXJuIGEgJ3JlcGxhY2VtZW50J1xuXHQgKiB2YWx1ZSB0aGF0IHNob3VsZCBiZSB1c2VkIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBwcmVkaWNhdGUgICBFcnJvciBjbGFzcyBvciBhcnJheSBvZiBjbGFzc2VzIHRvIG1hdGNoIChlLmcuXG5cdCAqICAgICAgICAgICAgICAgICAgICBSYW5nZUVycm9yIG9yIFtSYW5nZUVycm9yLCBUeXBlRXJyb3JdKS5cblx0ICogQHBhcmFtIG9uUmVqZWN0ZWQgIENhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyByZWplY3Rpb24gcmVhc29uIGlmZlxuXHQgKiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSBpcyByZWplY3RlZC4gQ2FsbGJhY2sgY2FuIHJldHVybiBhbm90aGVyIHZhbHVlXG5cdCAqICAgICAgICAgICAgICAgICAgICBvciBwcm9taXNlIGZvciBhIHZhbHVlLlxuXHQgKiBAcmV0dXJuIFByb21pc2UgZm9yIG9yaWdpbmFsIHZhbHVlLCBvciAncmVwbGFjZWQnIHZhbHVlIGluIGNhc2Ugb2YgZXJyb3Jcblx0ICovXG5cdHB1YmxpYyBjYXRjaDxSPihwcmVkaWNhdGU6IEVycm9yQ2xhc3N8RXJyb3JDbGFzc1tdLCBvblJlamVjdGVkOiAocmVhc29uOiBFcnJvcikgPT4gUnxUaGVuYWJsZTxSPik6IFByb21pc2U8VHxSPjtcblx0LyoqXG5cdCAqIENhdGNoIG9ubHkgZXJyb3JzIHRoYXQgbWF0Y2ggdGhlIHByZWRpY2F0ZSBmdW5jdGlvbiBpbiBjYXNlIHByb21pc2UgaXNcblx0ICogcmVqZWN0ZWQuXG5cdCAqIFRoZSBjYWxsYmFjayB3aWxsIGJlIGNhbGxlZCBpZiB0aGUgcHJlZGljYXRlIGZ1bmN0aW9uIHJldHVybnMgYSB0cnV0aHlcblx0ICogdmFsdWUgZm9yIHRoZSBnaXZlbiByZWplY3Rpb24gcmVhc29uLlxuXHQgKlxuXHQgKiBUaGUgcmV0dXJuZWQgcHJvbWlzZSBpcyByZXNvbHZlZCB3aXRoIHRoZSBvdXRwdXQgb2YgdGhlIGNhbGxiYWNrLCBzbyBpdFxuXHQgKiBpcyBwb3NzaWJsZSB0byByZS10aHJvdyB0aGUgZXJyb3IsIGJ1dCBhbHNvIHRvIHJldHVybiBhICdyZXBsYWNlbWVudCdcblx0ICogdmFsdWUgdGhhdCBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBAcGFyYW0gcHJlZGljYXRlICAgSWYgYHByZWRpY2F0ZShyZWFzb24pYCByZXR1cm5zIHRydWUgZm9yIGdpdmVuIGVycm9yLFxuXHQgKiAgICAgICAgICAgICAgICAgICAgb25SZWplY3RlZCBpcyBjYWxsZWRcblx0ICogQHBhcmFtIG9uUmVqZWN0ZWQgIENhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyByZWplY3Rpb24gcmVhc29uIGlmZlxuXHQgKiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSBpcyByZWplY3RlZC4gQ2FsbGJhY2sgY2FuIHJldHVybiBhbm90aGVyIHZhbHVlXG5cdCAqICAgICAgICAgICAgICAgICAgICBvciBwcm9taXNlIGZvciBhIHZhbHVlLlxuXHQgKiBAcmV0dXJuIFByb21pc2UgZm9yIG9yaWdpbmFsIHZhbHVlLCBvciAncmVwbGFjZWQnIHZhbHVlIGluIGNhc2Ugb2YgZXJyb3Jcblx0ICovXG5cdHB1YmxpYyBjYXRjaDxSPihwcmVkaWNhdGU6IChyZWFzb246IGFueSkgPT4gYm9vbGVhbiwgb25SZWplY3RlZDogKHJlYXNvbjogYW55KSA9PiBSfFRoZW5hYmxlPFI+KTogUHJvbWlzZTxUfFI+O1xuXHQvKipcblx0ICogQ2F0Y2ggb25seSBlcnJvcnMgdGhhdCBtYXRjaCBwcmVkaWNhdGUgaW4gY2FzZSBwcm9taXNlIGlzIHJlamVjdGVkLlxuXHQgKiBQcmVkaWNhdGUgY2FuIGJlIGFuIEVycm9yIChzdWItKWNsYXNzLCBhcnJheSBvZiBFcnJvciBjbGFzc2VzLCBvciBhXG5cdCAqIGZ1bmN0aW9uIHRoYXQgY2FuIHJldHVybiB0cnVlIHRvIGluZGljYXRlIGEgbWF0Y2guXG5cdCAqXG5cdCAqIFRoZSByZXR1cm5lZCBwcm9taXNlIGlzIHJlc29sdmVkIHdpdGggdGhlIG91dHB1dCBvZiB0aGUgY2FsbGJhY2ssIHNvIGl0XG5cdCAqIGlzIHBvc3NpYmxlIHRvIHJlLXRocm93IHRoZSBlcnJvciwgYnV0IGFsc28gdG8gcmV0dXJuIGEgJ3JlcGxhY2VtZW50J1xuXHQgKiB2YWx1ZSB0aGF0IHNob3VsZCBiZSB1c2VkIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBwcmVkaWNhdGUgICBPcHRpb25hbCBFcnJvciBjbGFzcywgYXJyYXkgb2YgRXJyb3IgY2xhc3NlcyBvciBtYXRjaFxuXHQgKiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25cblx0ICogQHBhcmFtIG9uUmVqZWN0ZWQgIENhbGxiYWNrIGNhbGxlZCB3aXRoIHByb21pc2UncyByZWplY3Rpb24gcmVhc29uIGlmZlxuXHQgKiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSBpcyByZWplY3RlZC4gQ2FsbGJhY2sgY2FuIHJldHVybiBhbm90aGVyIHZhbHVlXG5cdCAqICAgICAgICAgICAgICAgICAgICBvciBwcm9taXNlIGZvciBhIHZhbHVlLlxuXHQgKiBAcmV0dXJuIFByb21pc2UgZm9yIG9yaWdpbmFsIHZhbHVlLCBvciAncmVwbGFjZWQnIHZhbHVlIGluIGNhc2Ugb2YgZXJyb3Jcblx0ICovXG5cdHB1YmxpYyBjYXRjaDxSPigpOiBQcm9taXNlPFR8Uj4ge1xuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRjb25zdCBvblJlamVjdGVkOiAocmVhc29uOiBhbnkpID0+IFJ8VGhlbmFibGU8Uj4gPSBhcmd1bWVudHNbMF07XG5cdFx0XHRyZXR1cm4gdGhpcy50aGVuKHVuZGVmaW5lZCwgb25SZWplY3RlZCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHByZWRpY2F0ZTogYW55ID0gYXJndW1lbnRzWzBdO1xuXHRcdFx0Y29uc3Qgb25SZWplY3RlZDogKHJlYXNvbjogYW55KSA9PiBSfFRoZW5hYmxlPFI+ID0gYXJndW1lbnRzWzFdO1xuXHRcdFx0cmV0dXJuIHRoaXMudGhlbih1bmRlZmluZWQsIChyZWFzb246IGFueSkgPT4ge1xuXHRcdFx0XHRsZXQgbWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0aWYgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGlmIChwcmVkaWNhdGUucHJvdG90eXBlIGluc3RhbmNlb2YgRXJyb3IgfHwgcHJlZGljYXRlID09PSBFcnJvcikge1xuXHRcdFx0XHRcdFx0bWF0Y2ggPSByZWFzb24gaW5zdGFuY2VvZiBwcmVkaWNhdGU7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG1hdGNoID0gcHJlZGljYXRlKHJlYXNvbik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocHJlZGljYXRlKSkge1xuXHRcdFx0XHRcdGZvciAoY29uc3QgcCBvZiBwcmVkaWNhdGUpIHtcblx0XHRcdFx0XHRcdGlmIChyZWFzb24gaW5zdGFuY2VvZiBwKSB7XG5cdFx0XHRcdFx0XHRcdG1hdGNoID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJpbnZhbGlkIHByZWRpY2F0ZSB0byAuY2F0Y2goKSwgZ290IFwiICsgdHlwZW9mIHByZWRpY2F0ZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9uUmVqZWN0ZWQocmVhc29uKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3Q8VHxSPihyZWFzb24pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEFzeW5jaHJvbm91cyBlcXVpdmFsZW50IG9mIHRyeSB7IH0gZmluYWxseSB7IH0uXG5cdCAqXG5cdCAqIFJ1bnMgYGhhbmRsZXJgIHdoZW4gcHJvbWlzZSByZXNvbHZlcyAoZnVsZmlsbGVkIG9yIHJlamVjdGVkKS5cblx0ICogSGFuZGxlciBpcyBwYXNzZWQgdGhlIGN1cnJlbnQgcHJvbWlzZSAod2hpY2ggaXMgZ3VhcmFudGVlZCB0byBiZVxuXHQgKiByZXNvbHZlZCksIGFuZCBjYW4gYmUgaW50ZXJyb2dhdGVkIHdpdGggZS5nLiBgaXNGdWxmaWxsZWQoKWAsIGAudmFsdWUoKWAsXG5cdCAqIGV0Yy5cblx0ICpcblx0ICogV2hlbiBgaGFuZGxlcmAgcmV0dXJucyBgdW5kZWZpbmVkYCBvciBpdHMgcHJvbWlzZSBpcyBmdWxmaWxsZWQsIHRoZVxuXHQgKiBwcm9taXNlIGZyb20gYGZpbmFsbHkoKWAgaXMgcmVzb2x2ZWQgdG8gdGhlIG9yaWdpbmFsIHByb21pc2UncyByZXNvbHZlZFxuXHQgKiB2YWx1ZSBvciByZWplY3Rpb24gcmVhc29uLlxuXHQgKiBJZiBgaGFuZGxlcmAgdGhyb3dzIGFuIGVycm9yIG9yIHJldHVybnMgYSByZWplY3Rpb24sIHRoZSByZXN1bHQgb2Zcblx0ICogYGZpbmFsbHkoKWAgd2lsbCBiZSByZWplY3RlZCB3aXRoIHRoYXQgZXJyb3IuXG5cdCAqXG5cdCAqIEV4YW1wbGU6XG5cdCAqIHNvbWVMZW5naHR5T3BlcmF0aW9uKCkuZmluYWxseSgocmVzdWx0KSA9PiB7XG5cdCAqICAgaWYgKHJlc3VsdC5pc0Z1bGZpbGxlZCgpKSB7XG5cdCAqICAgICBjb25zb2xlLmxvZyhcInN1Y2NlZWRlZFwiKTtcblx0ICogICB9IGVsc2Uge1xuXHQgKiAgICAgY29uc29sZS5sb2coXCJmYWlsZWRcIiwgcmVzdWx0LnJlYXNvbigpKTtcblx0ICogICB9XG5cdCAqIH0pO1xuXHQgKlxuXHQgKiBAcGFyYW0gIGhhbmRsZXIgQ2FsbGJhY2sgY2FsbGVkIHdpdGggcHJvbWlzZSB3aGVuIGl0IGlzIHJlc29sdmVkLlxuXHQgKiBAcmV0dXJuIHByb21pc2Ugd2l0aCBzYW1lIHZhbHVlL3JlYXNvbiBhcyB0aGlzIG9uZSwgYWZ0ZXIgYGhhbmRsZXJgJ3Ncblx0ICogICAgICAgICByZXN1bHQgKGlmIGFueSkgaGFzIGJlZW4gZnVsZmlsbGVkLCBvciBhIHByb21pc2UgcmVqZWN0ZWQgd2l0aFxuXHQgKiAgICAgICAgIGBoYW5kbGVyYCdzIGVycm9yIGlmIGl0IHRocmV3IG9uZSBvciByZXR1cm5lZCBhIHJlamVjdGlvbi5cblx0ICovXG5cdHB1YmxpYyBmaW5hbGx5KGhhbmRsZXI6IChyZXN1bHQ6IFByb21pc2U8VD4pID0+IHZvaWR8VGhlbmFibGU8dm9pZD4pOiBQcm9taXNlPFQ+IHtcblx0XHRjb25zdCBydW5uZXIgPSAoKSA9PiBoYW5kbGVyKHRoaXMpO1xuXHRcdHJldHVybiB0aGlzLnRoZW4ocnVubmVyLCBydW5uZXIpLnJldHVybih0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm4gYHRydWVgIHdoZW4gcHJvbWlzZSBpcyBmdWxmaWxsZWQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKlxuXHQgKiBAcmV0dXJuIGB0cnVlYCB3aGVuIHByb21pc2UgaXMgZnVsZmlsbGVkLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovXG5cdHB1YmxpYyBpc0Z1bGZpbGxlZCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5fc3RhdGUgPT09IFN0YXRlLkZ1bGZpbGxlZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm4gYHRydWVgIHdoZW4gcHJvbWlzZSBpcyByZWplY3RlZCwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqXG5cdCAqIE5vdGU6IHRoaXMgZG9lcyBub3QgY29uc2lkZXIgdGhlIHJlamVjdGlvbiB0byBiZSAnaGFuZGxlZCcsIGlmXG5cdCAqIGl0IGlzIHJlamVjdGVkLlxuXHQgKlxuXHQgKiBAcmV0dXJuIGB0cnVlYCB3aGVuIHByb21pc2UgaXMgcmVqZWN0ZWQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi9cblx0cHVibGljIGlzUmVqZWN0ZWQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuX3N0YXRlID09PSBTdGF0ZS5SZWplY3RlZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm4gYHRydWVgIHdoZW4gcHJvbWlzZSBpcyBwZW5kaW5nIChtYXkgYmUgcmVzb2x2ZWQgdG8gYW5vdGhlciBwZW5kaW5nXG5cdCAqIHByb21pc2UpLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICpcblx0ICogQHJldHVybiBgdHJ1ZWAgd2hlbiBwcm9taXNlIGlzIHBlbmRpbmcgKG1heSBiZSByZXNvbHZlZCB0byBhbm90aGVyIHBlbmRpbmdcblx0ICogICAgICAgICBwcm9taXNlKSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqL1xuXHRwdWJsaWMgaXNQZW5kaW5nKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLl9zdGF0ZSA9PT0gU3RhdGUuUGVuZGluZztcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm4gZnVsZmlsbG1lbnQgdmFsdWUgaWYgZnVsZmlsbGVkLCBvdGhlcndpc2UgdGhyb3dzIGFuIGVycm9yLlxuXHQgKlxuXHQgKiBAcmV0dXJuIEZ1bGZpbGxtZW50IHZhbHVlIGlmIGZ1bGZpbGxlZCwgb3RoZXJ3aXNlIHRocm93cyBhbiBlcnJvci5cblx0ICovXG5cdHB1YmxpYyB2YWx1ZSgpOiBUIHtcblx0XHRpZiAoIXRoaXMuaXNGdWxmaWxsZWQoKSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiUHJvbWlzZSBpcyBub3QgZnVsZmlsbGVkXCIpO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fcmVzdWx0O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybiByZWplY3Rpb24gdmFsdWUgaWYgcmVqZWN0ZWQsIG90aGVyd2lzZSB0aHJvd3MgYW4gZXJyb3IuXG5cdCAqXG5cdCAqIE5vdGU6IHRoaXMgZG9lcyBub3QgY29uc2lkZXIgdGhlIHJlamVjdGlvbiB0byBiZSAnaGFuZGxlZCcsIGlmXG5cdCAqIGl0IGlzIHJlamVjdGVkLiBUbyBkbyBzbywgZXhwbGljaXRseSBjYWxsIGUuZy5cblx0ICogYC5zdXBwcmVzc1VuaGFuZGxlZFJlamVjdGlvbnMoKWAuXG5cdCAqXG5cdCAqIEByZXR1cm4gUmVqZWN0aW9uIHZhbHVlIGlmIHJlamVjdGVkLCBvdGhlcndpc2UgdGhyb3dzIGFuIGVycm9yLlxuXHQgKi9cblx0cHVibGljIHJlYXNvbigpOiBhbnkge1xuXHRcdGlmICghdGhpcy5pc1JlamVjdGVkKCkpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlByb21pc2UgaXMgbm90IHJlamVjdGVkXCIpO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5fcmVzdWx0O1xuXHR9XG5cblx0LyoqXG5cdCAqIFByZXZlbnQgdGhpcyBwcm9taXNlIGZyb20gdGhyb3dpbmcgYSBQb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbiBpblxuXHQgKiBjYXNlIGl0IGJlY29tZXMgcmVqZWN0ZWQuIFVzZWZ1bCB3aGVuIHRoZSByZWplY3Rpb24gd2lsbCBiZSBoYW5kbGVkIGxhdGVyXG5cdCAqIChpLmUuIGFmdGVyIHRoZSBjdXJyZW50ICd0aWNrJyksIG9yIHdoZW4gdGhlIHJlamVjdGlvbiBpcyB0byBiZSBpZ25vcmVkXG5cdCAqIGNvbXBsZXRlbHkuXG5cdCAqXG5cdCAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nIGAuY2F0Y2goKCkgPT4ge30pYCwgYnV0IG1vcmUgZWZmaWNpZW50LlxuXHQgKlxuXHQgKiBOb3RlOiBhbnkgZGVyaXZlZCBwcm9taXNlIChlLmcuIGJ5IGNhbGxpbmcgYC50aGVuKGNiKWApIGNhdXNlcyBhIG5ld1xuXHQgKiBwcm9taXNlIHRvIGJlIGNyZWF0ZWQsIHdoaWNoIGNhbiBzdGlsbCBjYXVzZSB0aGUgcmVqZWN0aW9uIHRvIGJlIHRocm93bi5cblx0ICpcblx0ICogTm90ZTogaWYgdGhlIHJlamVjdGlvbiB3YXMgYWxyZWFkeSBub3RpZmllZCwgdGhlIHJlamVjdGlvbi1oYW5kbGVkIGhhbmRsZXJcblx0ICogd2lsbCBiZSBjYWxsZWQuXG5cdCAqL1xuXHRwdWJsaWMgc3VwcHJlc3NVbmhhbmRsZWRSZWplY3Rpb25zKCk6IHZvaWQge1xuXHRcdHRoaXMuX3NldFJlamVjdGlvbkhhbmRsZWQoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcmV0dXJuIEEgaHVtYW4tcmVhZGFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIHByb21pc2UgYW5kIGl0cyBzdGF0dXMuXG5cdCAqL1xuXHRwdWJsaWMgaW5zcGVjdCgpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLnRvU3RyaW5nKCk7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybiBBIGh1bWFuLXJlYWRhYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwcm9taXNlIGFuZCBpdHMgc3RhdHVzLlxuXHQgKi9cblx0cHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XG5cdFx0bGV0IHN0YXRlOiBzdHJpbmc7XG5cdFx0c3dpdGNoICh0aGlzLl9zdGF0ZSkge1xuXHRcdFx0Y2FzZSBTdGF0ZS5QZW5kaW5nOiBzdGF0ZSA9IFwicGVuZGluZ1wiOyBicmVhaztcblx0XHRcdGNhc2UgU3RhdGUuRnVsZmlsbGVkOiBzdGF0ZSA9IFwiZnVsZmlsbGVkXCI7IGJyZWFrO1xuXHRcdFx0Y2FzZSBTdGF0ZS5SZWplY3RlZDogc3RhdGUgPSBcInJlamVjdGVkXCI7IGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDogc3RhdGUgPSBcInVua25vd25cIjtcblx0XHR9XG5cdFx0cmV0dXJuIGBbUHJvbWlzZSAke3RoaXMuX2lkfTogJHtzdGF0ZX1dYDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGUgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgc2FtZSB2YWx1ZSBvZiB0aGlzIHByb21pc2UsIGFmdGVyXG5cdCAqIGBtc2AgbWlsbGlzZWNvbmRzLiBUaGUgdGltZXIgd2lsbCBzdGFydCB3aGVuIHRoZSBjdXJyZW50IHByb21pc2UgaXNcblx0ICogcmVzb2x2ZWQuXG5cdCAqIElmIHRoZSBjdXJyZW50IHByb21pc2UgaXMgcmVqZWN0ZWQsIHRoZSByZXN1bHRpbmcgcHJvbWlzZSBpcyBhbHNvXG5cdCAqIHJlamVjdGVkLCB3aXRob3V0IHdhaXRpbmcgZm9yIHRoZSB0aW1lci5cblx0ICpcblx0ICogQHBhcmFtIG1zIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgcmVzb2x2aW5nXG5cdCAqIEByZXR1cm4gUHJvbWlzZSB0aGF0IGZ1bGZpbGxzIGBtc2AgbWlsbGlzZWNvbmRzIGFmdGVyIHRoaXMgcHJvbWlzZSBmdWxmaWxsc1xuXHQgKi9cblx0cHVibGljIGRlbGF5KG1zOiBudW1iZXIpOiBQcm9taXNlPFQ+IHtcblx0XHRyZXR1cm4gdGhpcy50aGVuKCh2YWx1ZTogVCkgPT4ge1xuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlPFQ+KChyZXNvbHZlKSA9PiB7XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZSh2YWx1ZSksIG1zKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBgdmFsdWVgIGFmdGVyIHRoaXMgcHJvbWlzZSBpc1xuXHQgKiBmdWxmaWxsZWQuXG5cdCAqIFJldHVybmVkIHByb21pc2UgaXMgcmVqZWN0ZWQgaWYgdGhpcyBwcm9taXNlIGlzIHJlamVjdGVkLlxuXHQgKlxuXHQgKiBFcXVpdmFsZW50IHRvIGAudGhlbigoKSA9PiB2YWx1ZSlgLlxuXHQgKlxuXHQgKiBAcGFyYW0gdmFsdWUgVmFsdWUgb3IgcHJvbWlzZSBmb3IgdmFsdWUgb2YgcmV0dXJuZWQgcHJvbWlzZVxuXHQgKiBAcmV0dXJuIFByb21pc2UgcmVzb2x2ZWQgdG8gdmFsdWUgYWZ0ZXIgdGhpcyBwcm9taXNlIGZ1bGZpbGxzXG5cdCAqL1xuXHRwdWJsaWMgcmV0dXJuPFI+KHZhbHVlOiBSfFRoZW5hYmxlPFI+KTogUHJvbWlzZTxSPjtcblx0LyoqXG5cdCAqIFJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBgdmFsdWVgIGFmdGVyIHRoaXMgcHJvbWlzZSBpc1xuXHQgKiBmdWxmaWxsZWQuXG5cdCAqIFJldHVybmVkIHByb21pc2UgaXMgcmVqZWN0ZWQgaWYgdGhpcyBwcm9taXNlIGlzIHJlamVjdGVkLlxuXHQgKlxuXHQgKiBFcXVpdmFsZW50IHRvIGAudGhlbigoKSA9PiB2YWx1ZSlgLlxuXHQgKlxuXHQgKiBAcmV0dXJuIFZvaWQgcHJvbWlzZSByZXNvbHZlZCB0byB2YWx1ZSBhZnRlciB0aGlzIHByb21pc2UgZnVsZmlsbHNcblx0ICovXG5cdHB1YmxpYyByZXR1cm4oKTogUHJvbWlzZTx2b2lkPjtcblx0LyoqXG5cdCAqIFJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBgdmFsdWVgIGFmdGVyIHRoaXMgcHJvbWlzZSBpc1xuXHQgKiBmdWxmaWxsZWQuXG5cdCAqIFJldHVybmVkIHByb21pc2UgaXMgcmVqZWN0ZWQgaWYgdGhpcyBwcm9taXNlIGlzIHJlamVjdGVkLlxuXHQgKlxuXHQgKiBFcXVpdmFsZW50IHRvIGAudGhlbigoKSA9PiB2YWx1ZSlgLlxuXHQgKlxuXHQgKiBAcGFyYW0gdmFsdWUgVmFsdWUgb3IgcHJvbWlzZSBmb3IgdmFsdWUgb2YgcmV0dXJuZWQgcHJvbWlzZVxuXHQgKiBAcmV0dXJuIFByb21pc2UgcmVzb2x2ZWQgdG8gdmFsdWUgYWZ0ZXIgdGhpcyBwcm9taXNlIGZ1bGZpbGxzXG5cdCAqL1xuXHRwdWJsaWMgcmV0dXJuPFI+KHZhbHVlPzogUnxUaGVuYWJsZTxSPik6IFByb21pc2U8Uj4ge1xuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHQvLyBJbiBUeXBlU2NyaXB0LCB3ZSBvZnRlbiBuZWVkIHRvICdmb3JjZScgYSBwcm9taXNlIHRvIGJlY29tZSBhXG5cdFx0XHQvLyB2b2lkIHByb21pc2UsIHNvIHRoaXMgaXMgYSBjb21tb24gY2FzZS4gUHJldmVudHMgdGhlIGNsb3N1cmUuXG5cdFx0XHQvLyAoTm90ZTogdGhlIGFueSBjYXN0IGlzIGp1c3QgYmVjYXVzZSBUUyBhc3N1bWVzIHdlcmUgZ29pbmcgdG9cblx0XHRcdC8vIHJldHVybiBhbiBSLCBidXQgd2UncmUgaW4gZmFjdCBnb2luZyB0byByZXR1cm4gYSB2b2lkLilcblx0XHRcdHJldHVybiB0aGlzLnRoZW48YW55Pihub29wKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMudGhlbigoKSA9PiB2YWx1ZSk7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJuIGEgcHJvbWlzZSB0aGF0IGlzIHJlamVjdGVkIHdpdGggYHJlYXNvbmAgYWZ0ZXIgdGhpcyBwcm9taXNlIGlzXG5cdCAqIGZ1bGZpbGxlZC5cblx0ICogSWYgdGhpcyBwcm9taXNlIGlzIHJlamVjdGVkLCByZXR1cm5lZCBwcm9taXNlIHdpbGwgcmVqZWN0ZWQgd2l0aCB0aGF0XG5cdCAqIGVycm9yIGluc3RlYWQuXG5cdCAqXG5cdCAqIEVxdWl2YWxlbnQgdG8gYC50aGVuKCgpID0+IHsgdGhyb3cgdmFsdWU7IH0pYC5cblx0ICpcblx0ICogQHBhcmFtIHJlYXNvbiBFcnJvciByZWFzb24gdG8gcmVqZWN0IHJldHVybmVkIHByb21pc2Ugd2l0aFxuXHQgKiBAcmV0dXJuIFByb21pc2UgcmVqZWN0ZWQgd2l0aCBgcmVhc29uYCBhZnRlciB0aGlzIHByb21pc2UgZnVsZmlsbHNcblx0ICovXG5cdHB1YmxpYyB0aHJvdyhyZWFzb246IEVycm9yKTogUHJvbWlzZTxUPiB7XG5cdFx0cmV0dXJuIHRoaXMudGhlbigoKSA9PiBQcm9taXNlLnJlamVjdDxUPihyZWFzb24pKTtcblx0fVxuXG5cdHByaXZhdGUgX3NldFNvdXJjZShzb3VyY2U6IFByb21pc2U8YW55Pik6IHZvaWQge1xuXHRcdGlmICghdGhpcy5fdHJhY2UgfHwgIXNvdXJjZS5fdHJhY2UpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dGhpcy5fdHJhY2Uuc2V0U291cmNlKHNvdXJjZS5fdHJhY2UpO1xuXHR9XG5cblx0cHJpdmF0ZSBfcmVzb2x2ZSh4OiBUfFRoZW5hYmxlPFQ+KTogdm9pZCB7XG5cdFx0Ly8gMi4xLjIuMSBXaGVuIGZ1bGZpbGxlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdC8vIDIuMS4zLjEgV2hlbiByZWplY3RlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdGFzc2VydCh0aGlzLl9zdGF0ZSA9PT0gU3RhdGUuUGVuZGluZyk7XG5cblx0XHRpZiAoIXgpIHtcblx0XHRcdC8vIFNob3J0Y3V0IGZvciBmYWxzeSB2YWx1ZXMsIG1vc3Qgbm90YWJseSB2b2lkLVByb21pc2VzXG5cdFx0XHQvLyAyLjMuNDogSWYgYHhgIGlzIG5vdCBhbiBvYmplY3Qgb3IgZnVuY3Rpb24sIGZ1bGZpbGwgYHByb21pc2VgIHdpdGggYHhgXG5cdFx0XHR0aGlzLl9mdWxmaWxsKDxUPngpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHQvLyAyLjMuMTogSWYgcHJvbWlzZSBhbmQgeCByZWZlciB0byB0aGUgc2FtZSBvYmplY3QsIHJlamVjdCBwcm9taXNlIHdpdGggYSBUeXBlRXJyb3IgYXMgdGhlIHJlYXNvbi5cblx0XHRpZiAodGhpcyA9PT0geCkge1xuXHRcdFx0dGhpcy5fcmVqZWN0KG5ldyBUeXBlRXJyb3IoXCJjYW5ub3QgcmVzb2x2ZSBQcm9taXNlIHRvIHNlbGZcIikpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHQvLyAyLjMuMjogSWYgYHhgIGlzIGEgcHJvbWlzZSwgYWRvcHQgaXRzIHN0YXRlXG5cdFx0aWYgKHggaW5zdGFuY2VvZiBQcm9taXNlKSB7XG5cdFx0XHR4Ll9zZXRTb3VyY2UodGhpcyk7XG5cdFx0XHR4Ll9zZXRSZWplY3Rpb25IYW5kbGVkKCk7IC8vIHdlIHRha2Ugb3ZlciByZXNwb25zaWJpbGl0eSBub3dcblx0XHRcdGlmICh4Ll9zdGF0ZSA9PT0gU3RhdGUuUGVuZGluZykge1xuXHRcdFx0XHQvLyAyLjMuMi4xOiBJZiBgeGAgaXMgcGVuZGluZywgYHByb21pc2VgIG11c3QgcmVtYWluIHBlbmRpbmcgdW50aWwgYHhgIGlzIGZ1bGZpbGxlZCBvciByZWplY3RlZC5cblx0XHRcdFx0dGhpcy5fZm9sbG93UHJvbWlzZSh4KTtcblx0XHRcdH0gZWxzZSBpZiAoeC5fc3RhdGUgPT09IFN0YXRlLkZ1bGZpbGxlZCkge1xuXHRcdFx0XHQvLyAyLjMuMi4yOiBJZi93aGVuIGB4YCBpcyBmdWxmaWxsZWQsIGZ1bGZpbGwgYHByb21pc2VgIHdpdGggdGhlIHNhbWUgdmFsdWUuXG5cdFx0XHRcdHRoaXMuX2Z1bGZpbGwoeC5fcmVzdWx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIDIuMy4yLjM6IElmL3doZW4gYHhgIGlzIHJlamVjdGVkLCByZWplY3QgYHByb21pc2VgIHdpdGggdGhlIHNhbWUgcmVhc29uLlxuXHRcdFx0XHR0aGlzLl9yZWplY3QoeC5fcmVzdWx0KTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly8gMi4zLjM6IE90aGVyd2lzZSwgaWYgYHhgIGlzIGFuIG9iamVjdCBvciBmdW5jdGlvbixcblx0XHRpZiAodHlwZW9mIHggPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHggPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0Ly8gMi4zLjMuMTogTGV0IGB0aGVuYCBiZSBgeC50aGVuYFxuXHRcdFx0Y29uc3QgdGhlbjogR2V0VGhlbkVycm9yfFRoZW5hYmxlPFQ+W1widGhlblwiXSA9IHRoaXMuX3RyeUdldFRoZW4oeCk7XG5cdFx0XHQvLyAyLjMuMy4yOiBJZiByZXRyaWV2aW5nIHRoZSBwcm9wZXJ0eSBgeC50aGVuYCByZXN1bHRzIGluIGEgdGhyb3duXG5cdFx0XHQvLyBleGNlcHRpb24gYGVgLCByZWplY3QgYHByb21pc2VgIHdpdGggYGVgIGFzIHRoZSByZWFzb24uXG5cdFx0XHRpZiAodGhlbiA9PT0gZ2V0VGhlbkVycm9yKSB7XG5cdFx0XHRcdHRoaXMuX3JlamVjdCh3cmFwTm9uRXJyb3IoZ2V0VGhlbkVycm9yLmVycm9yKSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIDIuMy4zLjM6IElmIGB0aGVuYCBpcyBhIGZ1bmN0aW9uLCBjYWxsIGl0IHdpdGggYHhgIGFzIGB0aGlzYCxcblx0XHRcdC8vICAgICAgICAgIGZpcnN0IGFyZ3VtZW50IGByZXNvbHZlUHJvbWlzZWAsIGFuZCBzZWNvbmQgYXJndW1lbnQgYHJlamVjdFByb21pc2VgXG5cdFx0XHRpZiAodHlwZW9mIHRoZW4gPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHR0aGlzLl9mb2xsb3dUaGVuYWJsZSg8VGhlbmFibGU8VD4+eCwgdGhlbik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIDIuMy4zLjQ6IElmIGB0aGVuYCBpcyBub3QgYSBmdW5jdGlvbiwgZnVsZmlsbCBwcm9taXNlIHdpdGggYHhgXG5cdFx0fVxuXHRcdC8vIDIuMy40OiBJZiBgeGAgaXMgbm90IGFuIG9iamVjdCBvciBmdW5jdGlvbiwgZnVsZmlsbCBgcHJvbWlzZWAgd2l0aCBgeGBcblx0XHR0aGlzLl9mdWxmaWxsKDxUPngpO1xuXHR9XG5cblx0cHJpdmF0ZSBfdHJ5R2V0VGhlbih4OiBUfFRoZW5hYmxlPFQ+KTogR2V0VGhlbkVycm9yfFRoZW5hYmxlPFQ+W1widGhlblwiXSB7XG5cdFx0dHJ5IHtcblx0XHRcdC8vIDIuMy4zLjE6IExldCBgdGhlbmAgYmUgYHgudGhlbmBcblx0XHRcdGNvbnN0IHRoZW4gPSAoPGFueT54KS50aGVuO1xuXHRcdFx0cmV0dXJuIHRoZW47XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0Ly8gMi4zLjMuMjogSWYgcmV0cmlldmluZyB0aGUgcHJvcGVydHkgYHgudGhlbmAgcmVzdWx0cyBpbiBhIHRocm93blxuXHRcdFx0Ly8gZXhjZXB0aW9uIGBlYCwgcmVqZWN0IGBwcm9taXNlYCB3aXRoIGBlYCBhcyB0aGUgcmVhc29uLlxuXHRcdFx0Z2V0VGhlbkVycm9yLmVycm9yID0gZTtcblx0XHRcdHJldHVybiBnZXRUaGVuRXJyb3I7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBfZnVsZmlsbCh2YWx1ZTogVCk6IHZvaWQge1xuXHRcdC8vIDIuMS4yLjEgV2hlbiBmdWxmaWxsZWQsIGEgcHJvbWlzZSBtdXN0IG5vdCB0cmFuc2l0aW9uIHRvIGFueSBvdGhlciBzdGF0ZS5cblx0XHQvLyAyLjEuMy4xIFdoZW4gcmVqZWN0ZWQsIGEgcHJvbWlzZSBtdXN0IG5vdCB0cmFuc2l0aW9uIHRvIGFueSBvdGhlciBzdGF0ZS5cblx0XHRhc3NlcnQodGhpcy5fc3RhdGUgPT09IFN0YXRlLlBlbmRpbmcpO1xuXG5cdFx0dHJhY2UgJiYgdHJhY2UodGhpcywgYF9mdWxmaWxsKCR7dHlwZW9mIHZhbHVlfSlgKTtcblx0XHQvLyAyLjEuMi4yIFdoZW4gZnVsZmlsbGVkLCBhIHByb21pc2UgbXVzdCBoYXZlIGEgdmFsdWUsIHdoaWNoIG11c3Qgbm90IGNoYW5nZS5cblx0XHR0aGlzLl9zdGF0ZSA9IFN0YXRlLkZ1bGZpbGxlZDtcblx0XHR0aGlzLl9yZXN1bHQgPSB2YWx1ZTtcblx0XHR0aGlzLl9mbHVzaCgpO1xuXHR9XG5cblx0cHJpdmF0ZSBfcmVqZWN0KHJlYXNvbjogYW55KTogdm9pZCB7XG5cdFx0Ly8gMi4xLjIuMSBXaGVuIGZ1bGZpbGxlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdC8vIDIuMS4zLjEgV2hlbiByZWplY3RlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdGFzc2VydCh0aGlzLl9zdGF0ZSA9PT0gU3RhdGUuUGVuZGluZyk7XG5cblx0XHR0cmFjZSAmJiB0cmFjZSh0aGlzLCBgX3JlamVjdCgke3JlYXNvbn0pYCk7XG5cdFx0Ly8gMi4xLjMuMiBXaGVuIHJlamVjdGVkLCBhIHByb21pc2UgbXVzdCBoYXZlIGEgcmVhc29uLCB3aGljaCBtdXN0IG5vdCBjaGFuZ2UuXG5cdFx0dGhpcy5fc3RhdGUgPSBTdGF0ZS5SZWplY3RlZDtcblx0XHR0aGlzLl9yZXN1bHQgPSByZWFzb247XG5cdFx0aWYgKHRoaXMuX3RyYWNlICYmIHRoaXMuX3Jlc3VsdCBpbnN0YW5jZW9mIEVycm9yICYmICEoPGFueT50aGlzLl9yZXN1bHQpLnRyYWNlKSB7XG5cdFx0XHRjb25zdCBzdGFja1RyYWNlID0gdGhpcy5fdHJhY2U7XG5cdFx0XHQoPGFueT50aGlzLl9yZXN1bHQpLnRyYWNlID0gc3RhY2tUcmFjZTtcblx0XHRcdC8vIFRPRE86IE1laCwgdGhpcyBhbHdheXMgYWNjZXNzZXMgJy5zdGFjaycsIHdoaWNoIGlzIHN1cHBvc2VkIHRvIGJlIGV4cGVuc2l2ZVxuXHRcdFx0Y29uc3Qgb3JpZ2luYWxTdGFjayA9IHRoaXMuX3Jlc3VsdC5zdGFjaztcblx0XHRcdC8vIFN0YWNrIG1heSBiZSB1bmRlZmluZWQgaWYgZS5nLiBhIFN0YWNrIE92ZXJmbG93IG9jY3VycmVkXG5cdFx0XHRpZiAob3JpZ2luYWxTdGFjaykge1xuXHRcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5fcmVzdWx0LCBcInN0YWNrXCIsIHtcblx0XHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdFx0XHRnZXQ6ICgpOiBzdHJpbmcgPT4gb3JpZ2luYWxTdGFjayArIFwiXFxuICBmcm9tIFByb21pc2UgYXQ6XFxuXCIgKyBzdGFja1RyYWNlLmluc3BlY3QoKSxcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdC8vIFNjaGVkdWxlIGNoZWNrIGZvciBwb3NzaWJseSB1bmhhbmRsZWQgcmVqZWN0aW9ucywgaWYgbm90IGFscmVhZHkgaGFuZGxlZFxuXHRcdGlmICghKHRoaXMuX2ZsYWdzICYgRmxhZ3MuUmVqZWN0aW9uSGFuZGxlZCkpIHtcblx0XHRcdGFzeW5jLmVucXVldWVJZGxlKFByb21pc2UuX3VuaGFuZGxlZFJlamVjdGlvbkNoZWNrZXIsIHRoaXMpO1xuXHRcdH1cblx0XHR0aGlzLl9mbHVzaCgpO1xuXHR9XG5cblx0cHJpdmF0ZSBfc2V0UmVqZWN0aW9uSGFuZGxlZCgpOiB2b2lkIHtcblx0XHRpZiAoISh0aGlzLl9mbGFncyAmIEZsYWdzLlJlamVjdGlvbkhhbmRsZWQpICYmICh0aGlzLl9mbGFncyAmIEZsYWdzLlVuaGFuZGxlZFJlamVjdGlvbk5vdGlmaWVkKSkge1xuXHRcdFx0Ly8gVGhlIHJlamVjdGlvbiBoYXMgYmVlbiBkZWNsYXJlZCBhcyBQb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvblxuXHRcdFx0Ly8gYmVmb3JlLCBzbyBkZWNsYXJlIGl0IGhhbmRsZWQgYWdhaW4uXG5cdFx0XHRhc3luYy5lbnF1ZXVlKFByb21pc2UuX29uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlciwgdGhpcyk7XG5cdFx0fVxuXHRcdHRoaXMuX2ZsYWdzIHw9IEZsYWdzLlJlamVjdGlvbkhhbmRsZWQ7XG5cdFx0dHJhY2UgJiYgdHJhY2UodGhpcywgXCJyZWplY3Rpb25IYW5kbGVkXCIpO1xuXHR9XG5cblx0cHJpdmF0ZSBfZG9DaGVja1VuaGFuZGxlZFJlamVjdGlvbigpOiB2b2lkIHtcblx0XHQvLyBXZSBnZXQgaGVyZSBpZiB0aGlzIHByb21pc2UgaXMgcmVqZWN0ZWQsIGFuZCB3YXNuJ3QgaGFuZGxlZCBhdCB0aGVcblx0XHQvLyB0aW1lIGl0IHdhcyByZWplY3RlZC4gRW1pdCBhIFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uIGluIGNhc2Vcblx0XHQvLyBpdCBzdGlsbCBpc24ndCBoYW5kbGVkIHlldC5cblx0XHRpZiAoISh0aGlzLl9mbGFncyAmIEZsYWdzLlJlamVjdGlvbkhhbmRsZWQpICYmICEodGhpcy5fZmxhZ3MgJiBGbGFncy5VbmhhbmRsZWRSZWplY3Rpb25Ob3RpZmllZCkpIHtcblx0XHRcdHRoaXMuX2ZsYWdzIHw9IEZsYWdzLlVuaGFuZGxlZFJlamVjdGlvbk5vdGlmaWVkO1xuXHRcdFx0YXN5bmMuZW5xdWV1ZShQcm9taXNlLl9vblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlciwgdGhpcyk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBfZm9sbG93UHJvbWlzZShzbGF2ZTogUHJvbWlzZTxhbnk+KTogdm9pZCB7XG5cdFx0Ly8gMi4xLjIuMSBXaGVuIGZ1bGZpbGxlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdC8vIDIuMS4zLjEgV2hlbiByZWplY3RlZCwgYSBwcm9taXNlIG11c3Qgbm90IHRyYW5zaXRpb24gdG8gYW55IG90aGVyIHN0YXRlLlxuXHRcdGFzc2VydCh0aGlzLl9zdGF0ZSA9PT0gU3RhdGUuUGVuZGluZyk7XG5cblx0XHR0cmFjZSAmJiB0cmFjZSh0aGlzLCBgX2ZvbGxvdyhbUHJvbWlzZSAke3NsYXZlLl9pZH1dKWApO1xuXHRcdHNsYXZlLl9lbnF1ZXVlKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0aGlzLCB1bmRlZmluZWQpO1xuXHR9XG5cblx0cHJpdmF0ZSBfZm9sbG93VGhlbmFibGUoc2xhdmU6IFRoZW5hYmxlPFQ+LCB0aGVuOiBUaGVuYWJsZTxUPltcInRoZW5cIl0pOiB2b2lkIHtcblx0XHQvLyAyLjEuMi4xIFdoZW4gZnVsZmlsbGVkLCBhIHByb21pc2UgbXVzdCBub3QgdHJhbnNpdGlvbiB0byBhbnkgb3RoZXIgc3RhdGUuXG5cdFx0Ly8gMi4xLjMuMSBXaGVuIHJlamVjdGVkLCBhIHByb21pc2UgbXVzdCBub3QgdHJhbnNpdGlvbiB0byBhbnkgb3RoZXIgc3RhdGUuXG5cdFx0YXNzZXJ0KHRoaXMuX3N0YXRlID09PSBTdGF0ZS5QZW5kaW5nKTtcblxuXHRcdHRyYWNlICYmIHRyYWNlKHRoaXMsIFwiX2ZvbGxvdyhbVGhlbmFibGVdKVwiKTtcblx0XHRsZXQgY2FsbGVkID0gZmFsc2U7XG5cdFx0dHJ5IHtcblx0XHRcdC8vIDIuMy4zLjM6IElmIGB0aGVuYCBpcyBhIGZ1bmN0aW9uLCBjYWxsIGl0IHdpdGggYHhgIGFzIGB0aGlzYCxcblx0XHRcdC8vICAgICAgICAgIGZpcnN0IGFyZ3VtZW50IGByZXNvbHZlUHJvbWlzZWAsIGFuZCBzZWNvbmQgYXJndW1lbnQgYHJlamVjdFByb21pc2VgXG5cdFx0XHR0aGVuLmNhbGwoXG5cdFx0XHRcdHNsYXZlLFxuXHRcdFx0XHQoeTogVCk6IHZvaWQgPT4ge1xuXHRcdFx0XHRcdGlmIChjYWxsZWQpIHtcblx0XHRcdFx0XHRcdC8vIDIuMy4zLjMuMzogSWYgYm90aCBgcmVzb2x2ZVByb21pc2VgIGFuZCBgcmVqZWN0UHJvbWlzZWAgYXJlIGNhbGxlZCxcblx0XHRcdFx0XHRcdC8vIG9yIG11bHRpcGxlIGNhbGxzIHRvIHRoZSBzYW1lIGFyZ3VtZW50IGFyZSBtYWRlLCB0aGUgZmlyc3QgY2FsbFxuXHRcdFx0XHRcdFx0Ly8gdGFrZXMgcHJlY2VkZW5jZSwgYW5kIGFueSBmdXJ0aGVyIGNhbGxzIGFyZSBpZ25vcmVkLlxuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQvLyAyLjMuMy4zLjE6IElmL3doZW4gYHJlc29sdmVQcm9taXNlYCBpcyBjYWxsZWQgd2l0aCB2YWx1ZSBgeWAsXG5cdFx0XHRcdFx0Ly8gcnVuIGBbW1Jlc29sdmVdXShwcm9taXNlLCB5KWBcblx0XHRcdFx0XHRjYWxsZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHRoaXMuX3Jlc29sdmUoeSk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdChyOiBhbnkpOiB2b2lkID0+IHtcblx0XHRcdFx0XHRpZiAoY2FsbGVkKSB7XG5cdFx0XHRcdFx0XHQvLyAyLjMuMy4zLjM6IElmIGJvdGggYHJlc29sdmVQcm9taXNlYCBhbmQgYHJlamVjdFByb21pc2VgIGFyZSBjYWxsZWQsXG5cdFx0XHRcdFx0XHQvLyBvciBtdWx0aXBsZSBjYWxscyB0byB0aGUgc2FtZSBhcmd1bWVudCBhcmUgbWFkZSwgdGhlIGZpcnN0IGNhbGxcblx0XHRcdFx0XHRcdC8vIHRha2VzIHByZWNlZGVuY2UsIGFuZCBhbnkgZnVydGhlciBjYWxscyBhcmUgaWdub3JlZC5cblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gMi4zLjMuMy4yOiBJZi93aGVuIGByZWplY3RQcm9taXNlYCBpcyBjYWxsZWQgd2l0aCByZWFzb24gYHJgLFxuXHRcdFx0XHRcdC8vIHJlamVjdCBgcHJvbWlzZWAgd2l0aCBgcmBcblx0XHRcdFx0XHRjYWxsZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHRoaXMuX3JlamVjdCh3cmFwTm9uRXJyb3IocikpO1xuXHRcdFx0XHR9XG5cdFx0XHQpO1xuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdC8vIDIuMy4zLjMuNDogSWYgY2FsbGluZyBgdGhlbmAgdGhyb3dzIGFuIGV4Y2VwdGlvbiBgZWAsXG5cdFx0XHQvLyAyLjMuMy4zLjQuMTogSWYgYHJlc29sdmVQcm9taXNlYCBvciBgcmVqZWN0UHJvbWlzZWAgaGF2ZSBiZWVuIGNhbGxlZCwgaWdub3JlIGl0LlxuXHRcdFx0aWYgKCFjYWxsZWQpIHtcblx0XHRcdFx0Ly8gMi4zLjMuMy40LjI6IE90aGVyd2lzZSwgcmVqZWN0IGBwcm9taXNlYCB3aXRoIGBlYCBhcyB0aGUgcmVhc29uLlxuXHRcdFx0XHRjYWxsZWQgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLl9yZWplY3Qod3JhcE5vbkVycm9yKGUpKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIF9lbnF1ZXVlKFxuXHRcdG9uRnVsZmlsbGVkOiBGdWxmaWxsbWVudEhhbmRsZXI8VCwgYW55Pixcblx0XHRvblJlamVjdGVkOiBSZWplY3Rpb25IYW5kbGVyPGFueT4sXG5cdFx0c2xhdmU6IFByb21pc2U8YW55PiB8IHVuZGVmaW5lZCxcblx0XHRkb25lOiBUcmFjZSB8IHVuZGVmaW5lZFxuXHQpOiB2b2lkIHtcblx0XHRjb25zdCBoOiBIYW5kbGVyPFQsIGFueT4gPSB7XG5cdFx0XHRwcm9taXNlOiB0aGlzLFxuXHRcdFx0b25GdWxmaWxsZWQsIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6b2JqZWN0LWxpdGVyYWwtc29ydC1rZXlzXG5cdFx0XHRvblJlamVjdGVkLFxuXHRcdFx0c2xhdmUsXG5cdFx0XHRkb25lLFxuXHRcdH07XG5cdFx0aWYgKHRoaXMuX3N0YXRlICE9PSBTdGF0ZS5QZW5kaW5nKSB7XG5cdFx0XHRhc3luYy5lbnF1ZXVlKFByb21pc2UuX3Vud3JhcHBlciwgaCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICghdGhpcy5faGFuZGxlcnMpIHtcblx0XHRcdFx0dGhpcy5faGFuZGxlcnMgPSBbaF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zdCBpID0gdGhpcy5faGFuZGxlcnMubGVuZ3RoO1xuXHRcdFx0XHR0aGlzLl9oYW5kbGVyc1tpXSA9IGg7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHRoaXMuX3NldFJlamVjdGlvbkhhbmRsZWQoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTY2hlZHVsZSBhbnkgcGVuZGluZyAudGhlbigpLy5kb25lKCkgY2FsbGJhY2tzIGFuZCBmb2xsb3dlci1wcm9taXNlcyB0b1xuXHQgKiBiZSBjYWxsZWQvcmVzb2x2ZWQuXG5cdCAqIENsZWFycyBvdXIgcXVldWUsIGFueSBjYWxsYmFja3MvZm9sbG93ZXJzIGF0dGFjaGVkIGFmdGVyIHRoaXMgd2lsbCBiZVxuXHQgKiBzY2hlZHVsZWQgd2l0aG91dCBnb2luZyB0aHJvdWdoIG91ciBoYW5kbGVycyBxdWV1ZS5cblx0ICovXG5cdHByaXZhdGUgX2ZsdXNoKCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5faGFuZGxlcnMpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0bGV0IGkgPSAwO1xuXHRcdGNvbnN0IGggPSB0aGlzLl9oYW5kbGVycztcblx0XHRjb25zdCBsID0gaC5sZW5ndGg7XG5cdFx0dGhpcy5faGFuZGxlcnMgPSB1bmRlZmluZWQ7XG5cdFx0d2hpbGUgKGkgPCBsKSB7XG5cdFx0XHQvLyBOb3RlOiB3ZSBlbnF1ZXVlIGV2ZXJ5IHNpbmdsZSBjYWxsYmFjay9mb2xsb3dlciBzZXBhcmF0ZWx5LFxuXHRcdFx0Ly8gYmVjYXVzZSBlLmcuIC5kb25lKCkgbWlnaHQgdGhyb3cgYW5kIHdlIG5lZWQgdG8gZW5zdXJlIHdlIGNhblxuXHRcdFx0Ly8gY29udGludWUgYWZ0ZXIgdGhhdC4gYXN5bmMgaGFuZGxlcyB0aGF0IGZvciB1cy5cblx0XHRcdC8vIEFuZCBiZWNhdXNlIHRoZSBxdWV1ZSBuZWVkcyB0byBiZSBwcm9jZXNzZWQgaW4tb3JkZXIsIHdlIGNhbid0XG5cdFx0XHQvLyAnZmlsdGVyJyB0aGUgbm9uLWNhbGxiYWNrIG9wZXJhdGlvbnMgb3V0IGVpdGhlci5cblx0XHRcdGFzeW5jLmVucXVldWUoUHJvbWlzZS5fdW53cmFwcGVyLCBoW2krK10pO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiAnVW53cmFwJyBhIHByb21pc2UgaGFuZGxlciwgaS5lLiBjYWxsIGEgLnRoZW4oKS8uZG9uZSgpIGNhbGxiYWNrLCBvclxuXHQgKiByZXNvbHZlIGEgcHJvbWlzZSB0aGF0J3MgZm9sbG93aW5nIHVzLlxuXHQgKiBAcGFyYW0gaGFuZGxlciBUaGUgaGFuZGxlciBiZWluZyBwcm9jZXNzZWRcblx0ICovXG5cdHByaXZhdGUgX3Vud3JhcChoYW5kbGVyOiBIYW5kbGVyPFQsIGFueT4pOiB2b2lkIHtcblx0XHRjb25zdCBjYWxsYmFjayA9IHRoaXMuX3N0YXRlID09PSBTdGF0ZS5GdWxmaWxsZWQgPyBoYW5kbGVyLm9uRnVsZmlsbGVkIDogaGFuZGxlci5vblJlamVjdGVkO1xuXHRcdGlmIChoYW5kbGVyLmRvbmUpIHtcblx0XHRcdC8vIFVud3JhcCAuZG9uZSgpIGNhbGxiYWNrc1xuXHRcdFx0dHJhY2UgJiYgdHJhY2UodGhpcywgYF91bndyYXAoKWApO1xuXHRcdFx0aWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdC8vIE5vIGNhbGxiYWNrOiBpZiB3ZSBlbmRlZCBpbiBhIHJlamVjdGlvbiwgdGhyb3cgaXQsIG90aGVyd2lzZVxuXHRcdFx0XHQvLyBhbGwgd2FzIGdvb2QuXG5cdFx0XHRcdGlmICh0aGlzLl9zdGF0ZSA9PT0gU3RhdGUuUmVqZWN0ZWQpIHtcblx0XHRcdFx0XHRQcm9taXNlLl9vblVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIodGhpcy5fcmVzdWx0LCBoYW5kbGVyLmRvbmUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGFzc2VydCghdW53cmFwcGluZ1Byb21pc2UpO1xuXHRcdFx0dW53cmFwcGluZ1Byb21pc2UgPSB0aGlzO1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Y29uc3QgcmVzdWx0ID0gY2FsbGJhY2sodGhpcy5fcmVzdWx0KTtcblx0XHRcdFx0aWYgKHJlc3VsdCkgeyAvLyBza2lwcyB0aGUgY29tbW9uIGNhc2VzIGxpa2UgYHVuZGVmaW5lZGBcblx0XHRcdFx0XHQvLyBNYXkgYmUgYSB0aGVuYWJsZSwgbmVlZCB0byBzdGFydCBmb2xsb3dpbmcgaXQuLi5cblx0XHRcdFx0XHRjb25zdCBwID0gKHJlc3VsdCBpbnN0YW5jZW9mIFByb21pc2UpID8gcmVzdWx0IDogUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG5cdFx0XHRcdFx0cC5kb25lKCk7IC8vIEVuc3VyZSBpdCB0aHJvd3MgYXMgc29vbiBhcyBpdCdzIHJlamVjdGVkXG5cdFx0XHRcdH1cblx0XHRcdFx0dW53cmFwcGluZ1Byb21pc2UgPSB1bmRlZmluZWQ7XG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdHVud3JhcHBpbmdQcm9taXNlID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRQcm9taXNlLl9vblVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIoZSwgaGFuZGxlci5kb25lKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly8gVW53cmFwIC50aGVuKCkgY2FsbGJhY2tzLCBvciByZXNvbHZlICdwYXJlbnQnIHByb21pc2Vcblx0XHQvL1xuXHRcdC8vIFRocmVlIHNjZW5hcmlvcyBhcmUgaGFuZGxlZCBoZXJlOlxuXHRcdC8vIDEuIEFuIG9uRnVsZmlsbGVkIGNhbGxiYWNrIHdhcyByZWdpc3RlcmVkIGFuZCBwcm9taXNlIGlzIGZ1bGZpbGxlZCxcblx0XHQvLyAgICBvciBvblJlamVjdGVkIGNhbGxiYWNrIHdhcyByZWdpc3RlcmVkIGFuZCBwcm9taXNlIGlzIHJlamVjdGVkXG5cdFx0Ly8gICAgLT4gY2FsbGJhY2sgaXMgYSBmdW5jdGlvbiwgc2xhdmUgaXMgdGhlIHByb21pc2UgdGhhdCB3YXMgcmV0dXJuZWRcblx0XHQvLyAgICAgICBmcm9tIHRoZSAudGhlbigpIGNhbGwsIHNvIHJlc29sdmUgc2xhdmUgd2l0aCBvdXRjb21lIG9mIGNhbGxiYWNrXG5cdFx0Ly8gMi4gQW4gb25GdWxmaWxsZWQgY2FsbGJhY2sgd2FzIHJlZ2lzdGVyZWQgYnV0IHByb21pc2UgaXMgcmVqZWN0ZWQsXG5cdFx0Ly8gICAgb3Igb25SZWplY3RlZCBjYWxsYmFjayB3YXMgcmVnaXN0ZXJlZCBidXQgcHJvbWlzZSBpcyBmdWxmaWxsZWRcblx0XHQvLyAgICAtPiBjYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiAodHlwaWNhbGx5IGB1bmRlZmluZWRgKSwgc2xhdmUgaXNcblx0XHQvLyAgICAgICBwcm9taXNlIHRoYXQgd2FzIHJldHVybmVkIGZyb20gdGhlIC50aGVuKCkgY2FsbCwgc28gcmVzb2x2ZSBpdFxuXHRcdC8vICAgICAgIHdpdGggb3VyIG93biByZXN1bHQgKHRoZXJlYnkgJ3NraXBwaW5nJyB0aGUgLnRoZW4oKSlcblx0XHQvLyAzLiBBbm90aGVyIHByb21pc2UgYXR0YWNoZWQgaXRzZWxmIG9uIG91ciAnY2FsbGJhY2sgcXVldWUnIHRvIGJlXG5cdFx0Ly8gICAgcmVzb2x2ZWQgd2hlbiB3ZSBkbyAoaS5lLiBpdHMgZmF0ZSBpcyBkZXRlcm1pbmVkIGJ5IHVzKVxuXHRcdC8vICAgIC0+IGNhbGxiYWNrcyB3aWxsIGJvdGggYmUgdW5kZWZpbmVkLCBzbGF2ZSBpcyB0aGF0IG90aGVyIHByb21pc2Vcblx0XHQvLyAgICAgICB0aGF0IHdhbnRzIHRvIGJlIHJlc29sdmVkIHdpdGggb3VyIHJlc3VsdFxuXHRcdGNvbnN0IHNsYXZlOiBQcm9taXNlPGFueT4gPSBoYW5kbGVyLnNsYXZlITtcblx0XHR0cmFjZSAmJiB0cmFjZSh0aGlzLCBgX3Vud3JhcCgke3NsYXZlLl9pZH0pYCk7XG5cdFx0aWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHQvLyBDYXNlIDFcblx0XHRcdGFzc2VydCghdW53cmFwcGluZ1Byb21pc2UpO1xuXHRcdFx0dW53cmFwcGluZ1Byb21pc2UgPSBzbGF2ZTtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdC8vIDIuMi41IGhhbmRsZXJzIG11c3QgYmUgY2FsbGVkIGFzIGZ1bmN0aW9uc1xuXHRcdFx0XHRzbGF2ZS5fcmVzb2x2ZShjYWxsYmFjayh0aGlzLl9yZXN1bHQpKTtcblx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0c2xhdmUuX3JlamVjdCh3cmFwTm9uRXJyb3IoZSkpO1xuXHRcdFx0fVxuXHRcdFx0dW53cmFwcGluZ1Byb21pc2UgPSB1bmRlZmluZWQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIENhc2UgMiBhbmQgM1xuXHRcdFx0aWYgKHRoaXMuX3N0YXRlID09PSBTdGF0ZS5GdWxmaWxsZWQpIHtcblx0XHRcdFx0c2xhdmUuX2Z1bGZpbGwodGhpcy5fcmVzdWx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNsYXZlLl9yZWplY3QodGhpcy5fcmVzdWx0KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlIGFuIGltbWVkaWF0ZWx5IHJlc29sdmVkIHByb21pc2UgKGluIGNhc2Ugb2YgYSAnbm9ybWFsJyB2YWx1ZSksIG9yXG5cdCAqIGEgcHJvbWlzZSB0aGF0ICdmb2xsb3dzJyBhbm90aGVyIGBUaGVuYWJsZWAgKGUuZy4gYSBQcm9taXNlIGZyb20gYW5vdGhlclxuXHQgKiBsaWJyYXJ5KS5cblx0ICpcblx0ICogQHBhcmFtIHZhbHVlIFZhbHVlIChvciBUaGVuYWJsZSBmb3IgdmFsdWUpIGZvciByZXR1cm5lZCBwcm9taXNlXG5cdCAqIEByZXR1cm4gUHJvbWlzZSByZXNvbHZlZCB0byBgdmFsdWVgXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHJlc29sdmU8Uj4odmFsdWU6IFIgfCBUaGVuYWJsZTxSPik6IFByb21pc2U8Uj47XG5cdC8qKlxuXHQgKiBDcmVhdGUgYW4gaW1tZWRpYXRlbHkgcmVzb2x2ZWQgdm9pZC1wcm9taXNlLlxuXHQgKlxuXHQgKiBAcmV0dXJuIFByb21pc2UgcmVzb2x2ZWQgdG8gdm9pZCAoaS5lLiBgdW5kZWZpbmVkYClcblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgcmVzb2x2ZSgpOiBQcm9taXNlPHZvaWQ+O1xuXHQvKipcblx0ICogQ3JlYXRlIGFuIGltbWVkaWF0ZWx5IHJlc29sdmVkIHByb21pc2UgKGluIGNhc2Ugb2YgYSAnbm9ybWFsJyB2YWx1ZSksIG9yXG5cdCAqIGEgcHJvbWlzZSB0aGF0ICdmb2xsb3dzJyBhbm90aGVyIGBUaGVuYWJsZWAgKGUuZy4gYSBQcm9taXNlIGZyb20gYW5vdGhlclxuXHQgKiBsaWJyYXJ5KS5cblx0ICpcblx0ICogQHBhcmFtIHZhbHVlIFZhbHVlIChvciBUaGVuYWJsZSBmb3IgdmFsdWUpIGZvciByZXR1cm5lZCBwcm9taXNlXG5cdCAqIEByZXR1cm4gUHJvbWlzZSByZXNvbHZlZCB0byBgdmFsdWVgXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHJlc29sdmU8Uj4odmFsdWU/OiBSIHwgVGhlbmFibGU8Uj4pOiBQcm9taXNlPHZvaWQgfCBSPiB7XG5cdFx0Y29uc3QgcCA9IG5ldyBQcm9taXNlKGludGVybmFsUmVzb2x2ZXIpO1xuXHRcdHAuX3Jlc29sdmUodmFsdWUpO1xuXHRcdHJldHVybiBwO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZSBhbiBpbW1lZGlhdGVseSByZWplY3RlZCB2b2lkLXByb21pc2UuXG5cdCAqXG5cdCAqIE5vdGU6IHRvIGNyZWF0ZSBhIHJlamVjdGVkIHByb21pc2Ugb2YgYW5vdGhlciB0eXBlLCB1c2UgZS5nLlxuXHQgKiBgUHJvbWlzZS5yZWplY3Q8bnVtYmVyPihteUVycm9yKWBcblx0ICpcblx0ICogQHBhcmFtIHJlYXNvbiBFcnJvciBvYmplY3QgdG8gc2V0IHJlamVjdGlvbiByZWFzb25cblx0ICogQHJldHVybiBWb2lkIHByb21pc2UgcmVzb2x2ZWQgdG8gcmVqZWN0aW9uIGByZWFzb25gXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHJlamVjdChyZWFzb246IEVycm9yKTogUHJvbWlzZTx2b2lkPjtcblx0LyoqXG5cdCAqIENyZWF0ZSBhbiBpbW1lZGlhdGVseSByZWplY3RlZCBwcm9taXNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVhc29uIEVycm9yIG9iamVjdCB0byBzZXQgcmVqZWN0aW9uIHJlYXNvblxuXHQgKiBAcmV0dXJuIFByb21pc2UgcmVzb2x2ZWQgdG8gcmVqZWN0aW9uIGByZWFzb25gXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHJlamVjdDxUPihyZWFzb246IEVycm9yKTogUHJvbWlzZTxUPjtcblx0LyoqXG5cdCAqIENyZWF0ZSBhbiBpbW1lZGlhdGVseSByZWplY3RlZCBwcm9taXNlLlxuXHQgKlxuXHQgKiBOb3RlOiB0byBjcmVhdGUgYSByZWplY3RlZCBwcm9taXNlIG9mIGEgY2VydGFpbiB0eXBlLCB1c2UgZS5nLlxuXHQgKiBgUHJvbWlzZS5yZWplY3Q8bnVtYmVyPihteUVycm9yKWBcblx0ICpcblx0ICogQHBhcmFtIHJlYXNvbiBFcnJvciBvYmplY3QgdG8gc2V0IHJlamVjdGlvbiByZWFzb25cblx0ICogQHJldHVybiBQcm9taXNlIHJlc29sdmVkIHRvIHJlamVjdGlvbiBgcmVhc29uYFxuXHQgKi9cblx0cHVibGljIHN0YXRpYyByZWplY3Q8VD4ocmVhc29uOiBFcnJvcik6IFByb21pc2U8VD4ge1xuXHRcdGNvbnN0IHAgPSBuZXcgUHJvbWlzZShpbnRlcm5hbFJlc29sdmVyKTtcblx0XHRwLl9yZWplY3QocmVhc29uKTtcblx0XHRyZXR1cm4gcDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm4gYSBwcm9taXNlIGZvciBhbiBhcnJheSBvZiBhbGwgcmVzb2x2ZWQgaW5wdXQgcHJvbWlzZXMgKG9yIHZhbHVlcykuXG5cdCAqIElmIGFueSBvZiB0aGUgaW5wdXQgcHJvbWlzZXMgaXMgcmVqZWN0ZWQsIHRoZSByZXR1cm5lZCBwcm9taXNlIGlzXG5cdCAqIHJlamVjdGVkIHdpdGggdGhhdCByZWFzb24uXG5cdCAqIFdoZW4gcGFzc2luZyBhbiBlbXB0eSBhcnJheSwgdGhlIHByb21pc2VzIGlzIGltbWVkaWF0ZWx5IHJlc29sdmVkIHRvIGFuXG5cdCAqIGVtcHR5IGFycmF5LlxuXHQgKlxuXHQgKiBAcGFyYW0gdGhlbmFibGVzIEFycmF5IG9mIHZhbHVlcyBvciBwcm9taXNlcyBmb3IgdGhlbVxuXHQgKiBAcmV0dXJuIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIGFycmF5IG9mIGFsbCByZXNvbHZlZCB2YWx1ZXNcblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgYWxsPFg+KHRoZW5hYmxlczogQXJyYXk8WCB8IFRoZW5hYmxlPFg+Pik6IFByb21pc2U8WFtdPiB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlPFhbXT4oKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuXHRcdFx0YXNzZXJ0KEFycmF5LmlzQXJyYXkodGhlbmFibGVzKSwgXCJ0aGVuYWJsZXMgbXVzdCBiZSBhbiBBcnJheVwiKTtcblx0XHRcdGlmICh0aGVuYWJsZXMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHJlc29sdmUoW10pO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRjb25zdCByZXN1bHQgPSBuZXcgQXJyYXkodGhlbmFibGVzLmxlbmd0aCk7XG5cdFx0XHRsZXQgcmVtYWluaW5nID0gdGhlbmFibGVzLmxlbmd0aDtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhlbmFibGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGZvbGxvdyh0aGVuYWJsZXNbaV0sIGkpO1xuXHRcdFx0fVxuXHRcdFx0ZnVuY3Rpb24gZm9sbG93KHQ6IFggfCBUaGVuYWJsZTxYPiwgaW5kZXg6IG51bWJlcik6IHZvaWQge1xuXHRcdFx0XHRjb25zdCBzbGF2ZTogUHJvbWlzZTxYPiA9IHQgaW5zdGFuY2VvZiBQcm9taXNlID8gdCA6IFByb21pc2UucmVzb2x2ZSh0KTtcblx0XHRcdFx0c2xhdmUuZG9uZShcblx0XHRcdFx0XHQodjogWCk6IHZvaWQgPT4ge1xuXHRcdFx0XHRcdFx0cmVzdWx0W2luZGV4XSA9IHY7XG5cdFx0XHRcdFx0XHRyZW1haW5pbmctLTtcblx0XHRcdFx0XHRcdGlmIChyZW1haW5pbmcgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyZXN1bHQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0KHJlYXNvbjogYW55KTogdm9pZCA9PiByZWplY3QocmVhc29uKVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byB0aGUgZnVsZmlsbG1lbnQgb3IgcmVqZWN0aW9uIG9mIHRoZVxuXHQgKiBmaXJzdCBpbnB1dCBwcm9taXNlIHRoYXQgcmVzb2x2ZXMuXG5cdCAqIFdoZW4gcGFzc2luZyBhbiBlbXB0eSBhcnJheSwgdGhlIHByb21pc2Ugd2lsbCBuZXZlciByZXNvbHZlLlxuXHQgKlxuXHQgKiBAcGFyYW0gdGhlbmFibGVzIEFycmF5IG9mIHZhbHVlcyBvciBwcm9taXNlcyBmb3IgdGhlbVxuXHQgKiBAcmV0dXJuIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBmaXJzdCByZXNvbHZlZCBpbnB1dCBwcm9taXNlXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIHJhY2U8WD4odGhlbmFibGVzOiBBcnJheTxYIHwgVGhlbmFibGU8WD4+KTogUHJvbWlzZTxYPiB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlPFg+KChyZXNvbHZlLCByZWplY3QpOiB2b2lkID0+IHtcblx0XHRcdGFzc2VydChBcnJheS5pc0FycmF5KHRoZW5hYmxlcyksIFwidGhlbmFibGVzIG11c3QgYmUgYW4gQXJyYXlcIik7XG5cdFx0XHRmb3IgKGNvbnN0IHQgb2YgdGhlbmFibGVzKSB7XG5cdFx0XHRcdGNvbnN0IHNsYXZlOiBQcm9taXNlPFg+ID0gdCBpbnN0YW5jZW9mIFByb21pc2UgPyB0IDogUHJvbWlzZS5yZXNvbHZlKHQpO1xuXHRcdFx0XHRQcm9taXNlLnJlc29sdmUoc2xhdmUpLmRvbmUocmVzb2x2ZSwgcmVqZWN0KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGUgdHVwbGUgb2YgYSBwcm9taXNlIGFuZCBpdHMgcmVzb2x2ZSBhbmQgcmVqZWN0IGZ1bmN0aW9ucy5cblx0ICpcblx0ICogSXQgaXMgZ2VuZXJhbGx5IGJldHRlciAoYW5kIHNsaWdodGx5IGZhc3RlcikgdG8gdXNlIHRoZSBQcm9taXNlXG5cdCAqIGNvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIHByb21pc2UsIGFzIHRoYXQgd2lsbCBhbHNvIGNhdGNoIGFueSBleGNlcHRpb25cblx0ICogdGhyb3duIHdoaWxlIHJ1bm5pbmcgdGhlIHJlc29sdmVyLlxuXHQgKlxuXHQgKiBBIERlZmVycmVkIGNhbiBiZSB1c2VmdWwgaW4gc29tZSBzY2VuYXJpb3MgdGhvdWdoLCBlLmcuIHdoZW4gd29ya2luZyB3aXRoXG5cdCAqIHRpbWVycywgcHJvdG9jb2wgcmVxdWVzdC9yZXNwb25zZSBwYWlycywgZXRjLlxuXHQgKlxuXHQgKiBAcmV0dXJuIERlZmVycmVkIG9iamVjdCwgY29udGFpbmluZyB1bnJlc29sdmVkIHByb21pc2UgYW5kIGl0c1xuXHQgKiAgICAgICAgIHJlc29sdmUvcmVqZWN0IGZ1bmN0aW9uc1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBkZWZlcigpOiBWb2lkRGVmZXJyZWQ7XG5cdC8qKlxuXHQgKiBDcmVhdGUgdHVwbGUgb2YgYSBwcm9taXNlIGFuZCBpdHMgcmVzb2x2ZSBhbmQgcmVqZWN0IGZ1bmN0aW9ucy5cblx0ICpcblx0ICogSXQgaXMgZ2VuZXJhbGx5IGJldHRlciAoYW5kIHNsaWdodGx5IGZhc3RlcikgdG8gdXNlIHRoZSBQcm9taXNlXG5cdCAqIGNvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIHByb21pc2UsIGFzIHRoYXQgd2lsbCBhbHNvIGNhdGNoIGFueSBleGNlcHRpb25cblx0ICogdGhyb3duIHdoaWxlIHJ1bm5pbmcgdGhlIHJlc29sdmVyLlxuXHQgKlxuXHQgKiBBIERlZmVycmVkIGNhbiBiZSB1c2VmdWwgaW4gc29tZSBzY2VuYXJpb3MgdGhvdWdoLCBlLmcuIHdoZW4gd29ya2luZyB3aXRoXG5cdCAqIHRpbWVycywgcHJvdG9jb2wgcmVxdWVzdC9yZXNwb25zZSBwYWlycywgZXRjLlxuXHQgKlxuXHQgKiBAcmV0dXJuIERlZmVycmVkIG9iamVjdCwgY29udGFpbmluZyB1bnJlc29sdmVkIHByb21pc2UgYW5kIGl0c1xuXHQgKiAgICAgICAgIHJlc29sdmUvcmVqZWN0IGZ1bmN0aW9uc1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBkZWZlcjxYPigpOiBEZWZlcnJlZDxYPjtcblx0LyoqXG5cdCAqIENyZWF0ZSB0dXBsZSBvZiBhIHByb21pc2UgYW5kIGl0cyByZXNvbHZlIGFuZCByZWplY3QgZnVuY3Rpb25zLlxuXHQgKlxuXHQgKiBJdCBpcyBnZW5lcmFsbHkgYmV0dGVyIChhbmQgc2xpZ2h0bHkgZmFzdGVyKSB0byB1c2UgdGhlIFByb21pc2Vcblx0ICogY29uc3RydWN0b3IgdG8gY3JlYXRlIGEgcHJvbWlzZSwgYXMgdGhhdCB3aWxsIGFsc28gY2F0Y2ggYW55IGV4Y2VwdGlvblxuXHQgKiB0aHJvd24gd2hpbGUgcnVubmluZyB0aGUgcmVzb2x2ZXIuXG5cdCAqXG5cdCAqIEEgRGVmZXJyZWQgY2FuIGJlIHVzZWZ1bCBpbiBzb21lIHNjZW5hcmlvcyB0aG91Z2gsIGUuZy4gd2hlbiB3b3JraW5nIHdpdGhcblx0ICogdGltZXJzLCBwcm90b2NvbCByZXF1ZXN0L3Jlc3BvbnNlIHBhaXJzLCBldGMuXG5cdCAqXG5cdCAqIEByZXR1cm4gRGVmZXJyZWQgb2JqZWN0LCBjb250YWluaW5nIHVucmVzb2x2ZWQgcHJvbWlzZSBhbmQgaXRzXG5cdCAqICAgICAgICAgcmVzb2x2ZS9yZWplY3QgZnVuY3Rpb25zXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGRlZmVyPFg+KCk6IERlZmVycmVkPGFueT4ge1xuXHRcdGxldCByZXNvbHZlOiAodjogYW55KSA9PiB2b2lkO1xuXHRcdGxldCByZWplY3Q6IChyOiBFcnJvcikgPT4gdm9pZDtcblx0XHRjb25zdCBwID0gbmV3IFByb21pc2U8YW55PigocmVzLCByZWopOiB2b2lkID0+IHtcblx0XHRcdHJlc29sdmUgPSByZXM7XG5cdFx0XHRyZWplY3QgPSByZWo7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHByb21pc2U6IHAsXG5cdFx0XHRyZWplY3Q6IHJlamVjdCEsXG5cdFx0XHRyZXNvbHZlOiByZXNvbHZlISxcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZSBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhIHZvaWQgdmFsdWUgKGB1bmRlZmluZWRgKSBhZnRlciBgbXNgXG5cdCAqIG1pbGxpc2Vjb25kcy5cblx0ICpcblx0ICogQHBhcmFtIG1zIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgcmVzb2x2aW5nXG5cdCAqIEByZXR1cm4gUHJvbWlzZSB0aGF0IGZ1bGZpbGxzIHdpdGggYSB2b2lkIHZhbHVlIGFmdGVyIGBtc2AgbWlsbGlzZWNvbmRzXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGRlbGF5KG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+O1xuXHQvKipcblx0ICogQ3JlYXRlIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBnaXZlbiB2YWx1ZSAob3IgcHJvbWlzZSBmb3IgYVxuXHQgKiB2YWx1ZSkgYWZ0ZXIgYG1zYCBtaWxsaXNlY29uZHMuIFRoZSB0aW1lciB3aWxsIHN0YXJ0IHdoZW4gdGhlIGdpdmVuIHZhbHVlXG5cdCAqIGlzIHJlc29sdmVkLlxuXHQgKiBJZiB0aGUgaW5wdXQgdmFsdWUgaXMgYSByZWplY3RlZCBwcm9taXNlLCB0aGUgcmVzdWx0aW5nIHByb21pc2UgaXMgYWxzb1xuXHQgKiByZWplY3RlZCwgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgdGltZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSBvciBwcm9taXNlIGZvciB2YWx1ZSB0byBiZSBkZWxheWVkXG5cdCAqIEBwYXJhbSBtcyBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHJlc29sdmluZ1xuXHQgKiBAcmV0dXJuIFByb21pc2UgdGhhdCBmdWxmaWxscyBgbXNgIG1pbGxpc2Vjb25kcyBhZnRlciBnaXZlbiAocHJvbWlzZSBmb3IpXG5cdCAqICAgICAgICAgdmFsdWUgaXMgZnVsZmlsbGVkXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGRlbGF5PFI+KHZhbHVlOiBSIHwgVGhlbmFibGU8Uj4sIG1zOiBudW1iZXIpOiBQcm9taXNlPFI+O1xuXHQvKipcblx0ICogQ3JlYXRlIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBnaXZlbiB2YWx1ZSAob3IgcHJvbWlzZSBmb3IgYVxuXHQgKiB2YWx1ZSkgYWZ0ZXIgYG1zYCBtaWxsaXNlY29uZHMuIFRoZSB0aW1lciB3aWxsIHN0YXJ0IHdoZW4gdGhlIGdpdmVuIHZhbHVlXG5cdCAqIGlzIHJlc29sdmVkLlxuXHQgKiBJZiB0aGUgaW5wdXQgdmFsdWUgaXMgYSByZWplY3RlZCBwcm9taXNlLCB0aGUgcmVzdWx0aW5nIHByb21pc2UgaXMgYWxzb1xuXHQgKiByZWplY3RlZCwgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgdGltZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSBvciBwcm9taXNlIGZvciB2YWx1ZSB0byBiZSBkZWxheWVkXG5cdCAqIEBwYXJhbSBtcyBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHJlc29sdmluZ1xuXHQgKiBAcmV0dXJuIFByb21pc2UgdGhhdCBmdWxmaWxscyBgbXNgIG1pbGxpc2Vjb25kcyBhZnRlciBnaXZlbiAocHJvbWlzZSBmb3IpXG5cdCAqICAgICAgICAgdmFsdWUgaXMgZnVsZmlsbGVkXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGRlbGF5PFI+KC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkIHwgUj4ge1xuXHRcdGlmIChhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Ly8gZGVsYXkobXMpXG5cdFx0XHRjb25zdCBtcyA9IGFyZ3VtZW50c1swXTtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZTx2b2lkfFI+KChyZXNvbHZlKSA9PiB7XG5cdFx0XHRcdHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdC8vIGRlbGF5KHZhbHVlLCBtcylcblx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGFyZ3VtZW50c1swXSkuZGVsYXkoYXJndW1lbnRzWzFdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBhIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aGVuZXZlciBhIHJlamVjdGVkIFByb21pc2UgcmVhY2hlcyBhIGAuZG9uZSgpYCBjYWxsXG5cdCAqIHdpdGhvdXQgYHJlamVjdEhhbmRsZXJgIGFyZ3VtZW50LCBvciBlaXRoZXIgb2YgdGhlIGAuZG9uZSgpYCBjYWxsYmFja3MgaXRzZWxmXG5cdCAqIHRocm93cy9yZWplY3RzLlxuXHQgKlxuXHQgKiBUaGlzIGlzIHNpbWlsYXIgdG8gTm9kZSdzIGB1bmhhbmRsZWRFeGNlcHRpb25gIGV2ZW50LCBpbiB0aGF0IGl0IGlzIGd1YXJhbnRlZWQgdG8gYmVcblx0ICogYW4gZXJyb3IsIGJlY2F1c2UgdGhlIHByb2dyYW1tZXIgZXhwbGljaXRseSBtYXJrZWQgdGhlIGNoYWluIHdpdGggYC5kb25lKClgLlxuXHQgKlxuXHQgKiBOb2RlIGFsc28gaGFzIGFuIGB1bmhhbmRsZWRSZWplY3Rpb25gIGV2ZW50LCB3aGljaCBpcyBhY3R1YWxseSBjbG9zZXIgdG8gdHMtcHJvbWlzZSdzXG5cdCAqIGBvblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uYCBoYW5kbGVyLlxuXHQgKlxuXHQgKiBUaGUgZGVmYXVsdCBoYW5kbGVyIHdpbGwgdGhyb3cgYW4gYFVuaGFuZGxlZFJlamVjdGlvbmAgZXJyb3IsIHdoaWNoIGNvbnRhaW5zIHRoZVxuXHQgKiBvcmlnaW5hbCByZWFzb24gb2YgdGhlIHJlamVjdGlvbi5cblx0ICogSW4gTm9kZSwgaWYgeW91IGRvbid0IGhhdmUgYW4gYHVuaGFuZGxlZEV4Y2VwdGlvbmAgZXZlbnQgaGFuZGxlciwgdGhhdCB3aWxsIGNhdXNlIHlvdXJcblx0ICogcHJvZ3JhbSB0byB0ZXJtaW5hdGUgYWZ0ZXIgcHJpbnRpbmcgdGhlIGVycm9yLlxuXHQgKiBXaGVuIG92ZXJyaWRpbmcgdGhlIGRlZmF1bHQgaGFuZGxlciwgaXQgaXMgcmVjb21tZW5kZWQgdG8ga2VlcCBhIHNpbWlsYXIgYmVoYXZpb3IsXG5cdCAqIGFzIHlvdXIgcHJvZ3JhbSBpcyBsaWtlbHkgaW4gYW4gdW5rbm93biBzdGF0ZS5cblx0ICpcblx0ICogQHNlZSBvblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uXG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyIENhbGxiYWNrIGNhbGxlZCB3aXRoIHRoZSByZWplY3Rpb24gcmVhc29uICh0eXBpY2FsbHkgYW4gYEVycm9yYCksIGFuZCBhXG5cdCAqICAgICAgICAgICAgICAgIGBUcmFjZWAgdG8gdGhlIGAuZG9uZSgpYCBjYWxsIHRoYXQgdGVybWluYXRlZCB0aGUgY2hhaW4uIENhbGwgZS5nLlxuXHQgKiAgICAgICAgICAgICAgICBgdHJhY2UuaW5zcGVjdCgpYCB0byBnZXQgdGhlIGZ1bGwgdHJhY2UuXG5cdCAqICAgICAgICAgICAgICAgIElmIGB0cnVlYCBpcyBnaXZlbiwgdGhlIGRlZmF1bHQgaGFuZGxlciBpcyBpbnN0YWxsZWQuXG5cdCAqICAgICAgICAgICAgICAgIElmIGBmYWxzZWAgaXMgZ2l2ZW4sIGEgbm8tb3AgaGFuZGxlciBpcyBpbnN0YWxsZWQuXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIG9uVW5oYW5kbGVkUmVqZWN0aW9uKGhhbmRsZXI6IGJvb2xlYW4gfCBVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyKTogdm9pZCB7XG5cdFx0aWYgKGhhbmRsZXIgPT09IHRydWUpIHtcblx0XHRcdFByb21pc2UuX29uVW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlciA9IGRlZmF1bHRVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyO1xuXHRcdH0gZWxzZSBpZiAoaGFuZGxlciA9PT0gZmFsc2UpIHtcblx0XHRcdFByb21pc2UuX29uVW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlciA9IG5vb3A7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YgaGFuZGxlciAhPT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFwiaW52YWxpZCBoYW5kbGVyOiBib29sZWFuIG9yIGZ1bmN0aW9uIGV4cGVjdGVkXCIpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRQcm9taXNlLl9vblVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIgPSBoYW5kbGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBhIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aGVuZXZlciBhIHJlamVjdGVkIFByb21pc2UgaXMgbm90IGhhbmRsZWRcblx0ICogYnkgYW55IGAuY2F0Y2goKWAgKG9yIHNlY29uZCBhcmd1bWVudCB0byBgLnRoZW4oKWApIGF0IHRoZSBlbmQgb2Ygb25lIHR1cm4gb2YgdGhlXG5cdCAqIGV2ZW50IGxvb3AuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBzdWNoIGEgcmVqZWN0ZWQgcHJvbWlzZSBtYXkgYmUgaGFuZGxlZCBsYXRlciAoYnkgZS5nLiBjYWxsaW5nIGAuY2F0Y2goKCkgPT4ge30pYFxuXHQgKiBvbiBpdCkuIEluIHRoYXQgY2FzZSwgYSBzdWJzZXF1ZW50IGNhbGwgdG8gYW4gYG9uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkYCBjYWxsYmFja1xuXHQgKiB3aWxsIGJlIG1hZGUuXG5cdCAqXG5cdCAqIFRoaXMgbWVjaGFuaXNtIGlzIGVxdWl2YWxlbnQgdG8gTm9kZSdzIGB1bmhhbmRsZWRSZWplY3Rpb25gIGV2ZW50LlxuXHQgKlxuXHQgKiBUaGUgZGVmYXVsdCBoYW5kbGVyIHdpbGw6XG5cdCAqIC0gZW1pdCBOb2RlJ3MgYHVuaGFuZGxlZFJlamVjdGlvbmAgZXZlbnQgaWYgcHJlc2VudCwgb3Jcblx0ICogLSBlbWl0IGFuIGB1bmhhbmRsZWRyZWplY3Rpb25gIChub3RlIHNtYWxsIFIpIGBQcm9taXNlUmVqZWN0aW9uRXZlbnRgIG9uIGB3aW5kb3dgIG9yIGBzZWxmYCBpZiBwcmVzZW50LCBvclxuXHQgKiAtIGxvZyB0aGUgcmVqZWN0aW9uIHVzaW5nIGBjb25zb2xlLndhcm4oKWAuXG5cdCAqXG5cdCAqIE5vdGU6IHdoZW4gYXR0YWNoaW5nIGFuIGB1bmhhbmRsZWRyZWplY3Rpb25gIGhhbmRsZXIgaW4gdGhlIGJyb3dzZXIsIG1ha2Ugc3VyZSB0b1xuXHQgKiBjYWxsIGBldmVudC5wcmV2ZW50RGVmYXVsdCgpYCB0byBwcmV2ZW50IHRzLXByb21pc2UncyBkZWZhdWx0IGZhbGxiYWNrIGxvZ2dpbmcuXG5cdCAqXG5cdCAqIEBzZWUgb25VbmhhbmRsZWRSZWplY3Rpb25cblx0ICogQHNlZSBvblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlciBDYWxsYmFjayBjYWxsZWQgd2l0aCB0aGUgKHNvLWZhcikgdW5oYW5kbGVkIHJlamVjdGVkIHByb21pc2UuXG5cdCAqICAgICAgICAgICAgICAgIElmIGB0cnVlYCBpcyBnaXZlbiwgdGhlIGRlZmF1bHQgaGFuZGxlciBpcyBpbnN0YWxsZWQuXG5cdCAqICAgICAgICAgICAgICAgIElmIGBmYWxzZWAgaXMgZ2l2ZW4sIGEgbm8tb3AgaGFuZGxlciBpcyBpbnN0YWxsZWQuXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIG9uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb24oaGFuZGxlcjogYm9vbGVhbiB8IFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlcik6IHZvaWQge1xuXHRcdGlmIChoYW5kbGVyID09PSB0cnVlKSB7XG5cdFx0XHRQcm9taXNlLl9vblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlciA9IGRlZmF1bHRQb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXI7XG5cdFx0fSBlbHNlIGlmIChoYW5kbGVyID09PSBmYWxzZSkge1xuXHRcdFx0UHJvbWlzZS5fb25Qb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIgPSBub29wO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIGhhbmRsZXIgIT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcImludmFsaWQgaGFuZGxlcjogYm9vbGVhbiBvciBmdW5jdGlvbiBleHBlY3RlZFwiKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0UHJvbWlzZS5fb25Qb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZXIgPSBoYW5kbGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBhIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aGVuZXZlciBhIHJlamVjdGVkIHByb21pc2UgcHJldmlvdXNseSByZXBvcnRlZCBhc1xuXHQgKiAncG9zc2libHkgdW5oYW5kbGVkJywgbm93IGJlY29tZXMgaGFuZGxlZC5cblx0ICpcblx0ICogVGhpcyBtZWNoYW5pc20gaXMgZXF1aXZhbGVudCB0byBOb2RlJ3MgYHJlamVjdGlvbkhhbmRsZWRgIGV2ZW50LlxuXHQgKlxuXHQgKiBUaGUgZGVmYXVsdCBoYW5kbGVyIHdpbGwgZW1pdCBOb2RlJ3MgYHJlamVjdGlvbkhhbmRsZWRgIGV2ZW50IGlmIHByZXNlbnQsIG9yIGVtaXQgYVxuXHQgKiBgcmVqZWN0aW9uaGFuZGxlZGAgKG5vdGUgc21hbGwgUikgZXZlbnQgb24gYHdpbmRvd2AgKG9yIGBzZWxmYCkgaWYgcHJlc2VudC5cblx0ICpcblx0ICogQHNlZSBvblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uXG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyIENhbGxiYWNrIGNhbGxlZCB3aXRoIGEgcmVqZWN0ZWQgcHJvbWlzZSB0aGF0IHdhcyBwcmV2aW91c2x5IHJlcG9ydGVkIGFzXG5cdCAqICAgICAgICAgICAgICAgICdwb3NzaWJseSB1bmhhbmRsZWQnLlxuXHQgKiAgICAgICAgICAgICAgICBJZiBgdHJ1ZWAgaXMgZ2l2ZW4sIHRoZSBkZWZhdWx0IGhhbmRsZXIgaXMgaW5zdGFsbGVkLlxuXHQgKiAgICAgICAgICAgICAgICBJZiBgZmFsc2VgIGlzIGdpdmVuLCBhIG5vLW9wIGhhbmRsZXIgaXMgaW5zdGFsbGVkLlxuXHQgKi9cblx0cHVibGljIHN0YXRpYyBvblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZChoYW5kbGVyOiBib29sZWFuIHwgUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlcik6IHZvaWQge1xuXHRcdGlmIChoYW5kbGVyID09PSB0cnVlKSB7XG5cdFx0XHRQcm9taXNlLl9vblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZEhhbmRsZXIgPSBkZWZhdWx0UG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkSGFuZGxlcjtcblx0XHR9IGVsc2UgaWYgKGhhbmRsZXIgPT09IGZhbHNlKSB7XG5cdFx0XHRQcm9taXNlLl9vblBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZEhhbmRsZXIgPSBub29wO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIGhhbmRsZXIgIT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcImludmFsaWQgaGFuZGxlcjogYm9vbGVhbiBvciBmdW5jdGlvbiBleHBlY3RlZFwiKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0UHJvbWlzZS5fb25Qb3NzaWJseVVuaGFuZGxlZFJlamVjdGlvbkhhbmRsZWRIYW5kbGVyID0gaGFuZGxlcjtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogRW5hYmxlIG9yIGRpc2FibGUgbG9uZyBzdGFjayB0cmFjZSB0cmFja2luZyBvbiBwcm9taXNlcy5cblx0ICpcblx0ICogVGhpcyBhbGxvd3MgdHJhY2luZyBhIHByb21pc2UgY2hhaW4gdGhyb3VnaCB0aGUgdmFyaW91cyBhc3luY2hyb25vdXNcblx0ICogYWN0aW9ucyBpbiBhIHByb2dyYW0uIEZvciBleGFtcGxlLCB3aGVuIGEgcHJvbWlzZSBpcyByZWplY3RlZCwgdGhlIGxhc3Rcblx0ICogZmV3IGxvY2F0aW9ucyBvZiBhbnkgcHJlY2VkaW5nIHByb21pc2VzIGFyZSBpbmNsdWRlZCBpbiB0aGUgZXJyb3IncyBzdGFja1xuXHQgKiB0cmFjZS5cblx0ICpcblx0ICogTm90ZTogaXQgaXMgcG9zc2libGUgdG8gZW5hYmxlL2Rpc2FibGUgbG9uZyB0cmFjaW5nIGF0IHJ1bnRpbWUuXG5cdCAqXG5cdCAqIFdoZW4gY2hhaW5pbmcgb2ZmIG9mIGEgcHJvbWlzZSB0aGF0IHdhcyBjcmVhdGVkIHdoaWxlIHRyYWNpbmcgd2FzIGVuYWJsZWRcblx0ICogKGUuZy4gdGhyb3VnaCBgLnRoZW4oKWApLCBhbGwgY2hpbGRyZW4gd2lsbCBhbHNvIGhhdmUgbG9uZyB0cmFjZXMsIGV2ZW5cblx0ICogd2hlbiB0cmFjaW5nIGlzIHR1cm5lZCBvZmYuIFRoaXMgYWxsb3dzIHRvIHRyYWNlIGp1c3Qgc29tZSBwcm9taXNlIHBhdGhzLlxuXHQgKlxuXHQgKiBUcmFjaW5nIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQgYXMgaXQgaW5jdXJzIGEgbWVtb3J5IGFuZCBwZXJmb3JtYW5jZVxuXHQgKiBvdmVyaGVhZCwgYWx0aG91Z2ggaXQncyBzdGlsbCBmYXN0ZXIgd2l0aCB0cmFjaW5nIHRoYW4gc29tZSBtYWpvclxuXHQgKiBwcm9taXNlIGxpYnJhcmllcyB3aXRob3V0IHRyYWNpbmcsIHNvIGRvbid0IHdvcnJ5IHRvbyBtdWNoIGFib3V0IGl0LlxuXHQgKlxuXHQgKiBAcGFyYW0gZW5hYmxlIFNldCB0byB0cnVlIHRvIGVuYWJsZSBsb25nIHRyYWNlcywgZmFsc2UgdG8gZGlzYWJsZVxuXHQgKi9cblx0cHVibGljIHN0YXRpYyBzZXRMb25nVHJhY2VzKGVuYWJsZTogYm9vbGVhbik6IHZvaWQge1xuXHRcdGxvbmdUcmFjZXMgPSBlbmFibGU7XG5cdH1cblxuXHQvKipcblx0ICogU2V0IHRyYWNlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGZvciBpbnRlcm5hbCBzdGF0ZSBjaGFuZ2VzIG9mIGFcblx0ICogcHJvbWlzZS5cblx0ICogQ2FsbCB3aXRoIGB1bmRlZmluZWRgIG9yIGBudWxsYCB0byBkaXNhYmxlIHN1Y2ggdHJhY2luZyAodGhpcyBpcyB0aGVcblx0ICogZGVmYXVsdCkuXG5cdCAqXG5cdCAqIEBwYXJhbSB0cmFjZXIgQ2FsbGJhY2sgY2FsbGVkIGZvciB2YXJpb3VzIHN0YWdlcyBkdXJpbmcgbGlmZXRpbWUgb2YgYSBwcm9taXNlXG5cdCAqL1xuXHQvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbnVsbC1rZXl3b3JkXG5cdHB1YmxpYyBzdGF0aWMgc2V0VHJhY2VyKHRyYWNlcjogdW5kZWZpbmVkIHwgbnVsbCB8ICgocHJvbWlzZTogUHJvbWlzZTxhbnk+LCBtc2c6IHN0cmluZykgPT4gdm9pZCkpOiB2b2lkIHtcblx0XHRpZiAodHlwZW9mIHRyYWNlciA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHR0cmFjZSA9IHRyYWNlcjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dHJhY2UgPSB1bmRlZmluZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFJlY3Vyc2l2ZWx5IGZsdXNoIHRoZSBhc3luYyBjYWxsYmFjayBxdWV1ZSB1bnRpbCBhbGwgYC50aGVuKClgIGFuZFxuXHQgKiBgLmRvbmUoKWAgY2FsbGJhY2tzIGZvciBmdWxmaWxsZWQgYW5kIHJlamVjdGVkIFByb21pc2VzIGhhdmUgYmVlbiBjYWxsZWQuXG5cdCAqIFVzZWZ1bCBpbiBlLmcuIHVuaXQgdGVzdHMgdG8gYWR2YW5jZSBwcm9ncmFtIHN0YXRlIHRvIHRoZSBuZXh0ICd0aWNrJy5cblx0ICpcblx0ICogTm90ZSB0aGF0IGlmIGUuZy4gYC5kb25lKClgIGVuY291bnRlcnMgYSByZWplY3RlZCBwcm9taXNlLCBgZmx1c2goKWAgd2lsbFxuXHQgKiBpbW1lZGlhdGVseSB0aHJvdyBhbiBlcnJvciAoZS5nLiBgVW5oYW5kbGVkUmVqZWN0aW9uRXJyb3JgKS5cblx0ICogSXQgaXMgc2FmZSB0byBjYWxsIGBmbHVzaCgpYCBhZ2FpbiBhZnRlcndhcmRzLCBidXQgaXQgd2lsbCBhbHNvIGJlIGNhbGxlZFxuXHQgKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBhc3luYyBxdWV1ZSBvbiB0aGUgbmV4dCAncmVhbCcgdGljay5cblx0ICpcblx0ICogSXQgaXMgYW4gZXJyb3IgdG8gY2FsbCBgZmx1c2goKWAgd2hpbGUgaXQgaXMgYWxyZWFkeSBydW5uaW5nIChlLmcuIGZyb21cblx0ICogYSBgLnRoZW4oKWAgY2FsbGJhY2spLlxuXHQgKi9cblx0cHVibGljIHN0YXRpYyBmbHVzaCgpOiB2b2lkIHtcblx0XHRhc3luYy5mbHVzaCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEhlbHBlciBmb3IgdW53cmFwcGluZyBwcm9taXNlIGhhbmRsZXIuXG5cdCAqIEl0J3Mgbm90IGEgY2xvc3VyZSBzbyBpdCdzIGNoZWFwIHRvIHNjaGVkdWxlLCBhbmQgYmVjYXVzZSBpdCBkaXJlY3RseVxuXHQgKiBjYWxscyB0aGUgX3Vud3JhcCgpIG1ldGhvZCBvbiBhIHByb21pc2UsIGl0J3MgKHdheSkgZmFzdGVyIHRoYW4gaGF2aW5nIHRvXG5cdCAqIHVzZSBlLmcuIC5jYWxsKCkuXG5cdCAqIEBwYXJhbSBoYW5kbGVyIFRoZSBoYW5kbGVyIGJlaW5nIHByb2Nlc3NlZFxuXHQgKi9cblx0cHJpdmF0ZSBzdGF0aWMgX3Vud3JhcHBlcihoYW5kbGVyOiBIYW5kbGVyPGFueSwgYW55Pik6IHZvaWQge1xuXHRcdGhhbmRsZXIucHJvbWlzZS5fdW53cmFwKGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEhlbHBlciBmb3IgY2hlY2tpbmcgZm9yIHBvc3NpYmx5IHVuaGFuZGxlZCByZWplY3Rpb25zLlxuXHQgKiBAcGFyYW0gcHJvbWlzZSBUaGUgUHJvbWlzZSB0byBjaGVja1xuXHQgKi9cblx0cHJpdmF0ZSBzdGF0aWMgX3VuaGFuZGxlZFJlamVjdGlvbkNoZWNrZXIocHJvbWlzZTogUHJvbWlzZTxhbnk+KTogdm9pZCB7XG5cdFx0cHJvbWlzZS5fZG9DaGVja1VuaGFuZGxlZFJlamVjdGlvbigpO1xuXHR9XG59XG5cbi8vIEluc3RhbGwgZGVmYXVsdCByZWplY3Rpb24gaGFuZGxlcnNcblByb21pc2Uub25VbmhhbmRsZWRSZWplY3Rpb24odHJ1ZSk7XG5Qcm9taXNlLm9uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb24odHJ1ZSk7XG5Qcm9taXNlLm9uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVkKHRydWUpO1xuXG5leHBvcnQgZGVmYXVsdCBQcm9taXNlO1xuIl19
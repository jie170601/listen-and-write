"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseError_1 = require("./BaseError");
var util_1 = require("./util");
var BaseUnhandledRejection = (function (_super) {
    __extends(BaseUnhandledRejection, _super);
    function BaseUnhandledRejection(name, message, reason) {
        var _this = _super.call(this, name, message + ": " + reason) || this;
        _this.reason = reason;
        var stack = _this.reason && typeof _this.reason === "object" && _this.reason.stack;
        if (typeof stack !== "string") {
            stack = String(_this.reason);
        }
        _this.stack = _this.name + ": " + stack;
        return _this;
    }
    return BaseUnhandledRejection;
}(BaseError_1.default));
exports.BaseUnhandledRejection = BaseUnhandledRejection;
var UnhandledRejection = (function (_super) {
    __extends(UnhandledRejection, _super);
    function UnhandledRejection(reason, trace) {
        var _this = _super.call(this, "UnhandledRejection", "unhandled rejection", reason) || this;
        _this.trace = trace;
        return _this;
    }
    return UnhandledRejection;
}(BaseUnhandledRejection));
exports.UnhandledRejection = UnhandledRejection;
var PossiblyUnhandledRejection = (function (_super) {
    __extends(PossiblyUnhandledRejection, _super);
    function PossiblyUnhandledRejection(promise) {
        var _this = _super.call(this, "PossiblyUnhandledRejection", "possibly unhandled rejection", promise.reason()) || this;
        _this.promise = promise;
        return _this;
    }
    return PossiblyUnhandledRejection;
}(BaseUnhandledRejection));
exports.PossiblyUnhandledRejection = PossiblyUnhandledRejection;
function emitRejectionEvent(type, reason, promise) {
    var event = new PromiseRejectionEvent(type, {
        cancelable: true,
        promise: true,
        reason: reason,
    });
    Object.defineProperty(event, "promise", {
        value: promise,
    });
    var global = util_1.getGlobal();
    if (global.dispatchEvent && !global.dispatchEvent(event)) {
        return true;
    }
    return false;
}
function defaultUnhandledRejectionHandler(reason, doneTrace) {
    var unhandledRejection = new UnhandledRejection(reason, doneTrace);
    throw unhandledRejection;
}
exports.defaultUnhandledRejectionHandler = defaultUnhandledRejectionHandler;
function defaultPossiblyUnhandledRejectionHandler(promise) {
    var log = true;
    if (typeof process !== "undefined" && typeof process.emit === "function") {
        if (process.emit("unhandledRejection", promise.reason(), promise)) {
            log = false;
        }
    }
    else if (typeof PromiseRejectionEvent === "function") {
        if (emitRejectionEvent("unhandledrejection", promise.reason(), promise)) {
            log = false;
        }
    }
    if (log) {
        var possiblyUnhandledRejection = new PossiblyUnhandledRejection(promise);
        console.warn(possiblyUnhandledRejection.stack);
    }
}
exports.defaultPossiblyUnhandledRejectionHandler = defaultPossiblyUnhandledRejectionHandler;
function defaultPossiblyUnhandledRejectionHandledHandler(promise) {
    if (typeof process !== "undefined" && typeof process.emit === "function") {
        process.emit("rejectionHandled", promise);
    }
    else if (typeof PromiseRejectionEvent === "function") {
        emitRejectionEvent("rejectionhandled", promise.reason(), promise);
    }
}
exports.defaultPossiblyUnhandledRejectionHandledHandler = defaultPossiblyUnhandledRejectionHandledHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVqZWN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJlamVjdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBT0EseUNBQW9DO0FBR3BDLCtCQUFtQztBQVNuQztJQUE0QywwQ0FBUztJQU1wRCxnQ0FBWSxJQUFZLEVBQUUsT0FBZSxFQUFFLE1BQVc7UUFBdEQsWUFDQyxrQkFBTSxJQUFJLEVBQUssT0FBTyxVQUFLLE1BQVEsQ0FBQyxTQVlwQztRQVhBLEtBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBTXJCLElBQUksS0FBSyxHQUFXLEtBQUksQ0FBQyxNQUFNLElBQUksT0FBTyxLQUFJLENBQUMsTUFBTSxLQUFLLFFBQVEsSUFBSSxLQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUN4RixJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtZQUM5QixLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM1QjtRQUNELEtBQUksQ0FBQyxLQUFLLEdBQU0sS0FBSSxDQUFDLElBQUksVUFBSyxLQUFPLENBQUM7O0lBQ3ZDLENBQUM7SUFDRiw2QkFBQztBQUFELENBQUMsQUFwQkQsQ0FBNEMsbUJBQVMsR0FvQnBEO0FBcEJZLHdEQUFzQjtBQXlCbkM7SUFBd0Msc0NBQXNCO0lBTTdELDRCQUFZLE1BQVcsRUFBRSxLQUFZO1FBQXJDLFlBQ0Msa0JBQU0sb0JBQW9CLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxDQUFDLFNBSTFEO1FBREEsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7O0lBQ3BCLENBQUM7SUFDRix5QkFBQztBQUFELENBQUMsQUFaRCxDQUF3QyxzQkFBc0IsR0FZN0Q7QUFaWSxnREFBa0I7QUFrQi9CO0lBQWdELDhDQUFzQjtJQU1yRSxvQ0FBWSxPQUFxQjtRQUFqQyxZQUNDLGtCQUNDLDRCQUE0QixFQUM1Qiw4QkFBOEIsRUFDOUIsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUNoQixTQUVEO1FBREEsS0FBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7O0lBQ3hCLENBQUM7SUFDRixpQ0FBQztBQUFELENBQUMsQUFkRCxDQUFnRCxzQkFBc0IsR0FjckU7QUFkWSxnRUFBMEI7QUE0QnZDLFNBQVMsa0JBQWtCLENBQzFCLElBQStDLEVBQy9DLE1BQVcsRUFDWCxPQUFxQjtJQVVyQixJQUFNLEtBQUssR0FBRyxJQUFJLHFCQUFxQixDQUFDLElBQUksRUFBRTtRQUM3QyxVQUFVLEVBQUUsSUFBSTtRQUNoQixPQUFPLEVBQUUsSUFBSTtRQUNiLE1BQU0sUUFBQTtLQUNOLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtRQUN2QyxLQUFLLEVBQUUsT0FBTztLQUNkLENBQUMsQ0FBQztJQUNILElBQU0sTUFBTSxHQUFHLGdCQUFTLEVBQUUsQ0FBQztJQUMzQixJQUFJLE1BQU0sQ0FBQyxhQUFhLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBRXpELE9BQU8sSUFBSSxDQUFDO0tBQ1o7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNkLENBQUM7QUFVRCxTQUFnQixnQ0FBZ0MsQ0FBQyxNQUFXLEVBQUUsU0FBZ0I7SUFDN0UsSUFBTSxrQkFBa0IsR0FBRyxJQUFJLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUVyRSxNQUFNLGtCQUFrQixDQUFDO0FBQzFCLENBQUM7QUFKRCw0RUFJQztBQVdELFNBQWdCLHdDQUF3QyxDQUFDLE9BQXFCO0lBQzdFLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQztJQUdmLElBQUksT0FBTyxPQUFPLEtBQUssV0FBVyxJQUFJLE9BQU8sT0FBTyxDQUFDLElBQUksS0FBSyxVQUFVLEVBQUU7UUFJekUsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxPQUFjLENBQUMsRUFBRTtZQUV6RSxHQUFHLEdBQUcsS0FBSyxDQUFDO1NBQ1o7S0FDRDtTQUFNLElBQUksT0FBTyxxQkFBcUIsS0FBSyxVQUFVLEVBQUU7UUFFdkQsSUFBSSxrQkFBa0IsQ0FBQyxvQkFBb0IsRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsT0FBTyxDQUFDLEVBQUU7WUFDeEUsR0FBRyxHQUFHLEtBQUssQ0FBQztTQUNaO0tBQ0Q7SUFHRCxJQUFJLEdBQUcsRUFBRTtRQUNSLElBQU0sMEJBQTBCLEdBQUcsSUFBSSwwQkFBMEIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUUzRSxPQUFPLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQy9DO0FBQ0YsQ0FBQztBQXpCRCw0RkF5QkM7QUFPRCxTQUFnQiwrQ0FBK0MsQ0FBQyxPQUFxQjtJQUVwRixJQUFJLE9BQU8sT0FBTyxLQUFLLFdBQVcsSUFBSSxPQUFPLE9BQU8sQ0FBQyxJQUFJLEtBQUssVUFBVSxFQUFFO1FBSXpFLE9BQU8sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsT0FBYyxDQUFDLENBQUM7S0FDakQ7U0FBTSxJQUFJLE9BQU8scUJBQXFCLEtBQUssVUFBVSxFQUFFO1FBRXZELGtCQUFrQixDQUFDLGtCQUFrQixFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztLQUNsRTtBQUNGLENBQUM7QUFYRCwwR0FXQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGVmaW5pdGVseS0gYW5kIHBvc3NpYmx5LXVuaGFuZGxlZCByZWplY3Rpb24gaGFuZGxpbmcuXG4gKlxuICogQ29weXJpZ2h0IChDKSAyMDE3IE1hcnRpbiBQb2Vsc3RyYVxuICogTGljZW5zZTogTUlUXG4gKi9cblxuaW1wb3J0IEJhc2VFcnJvciBmcm9tIFwiLi9CYXNlRXJyb3JcIjtcbmltcG9ydCBQcm9taXNlIGZyb20gXCIuL1Byb21pc2VcIjtcbmltcG9ydCBUcmFjZSBmcm9tIFwiLi9UcmFjZVwiO1xuaW1wb3J0IHsgZ2V0R2xvYmFsIH0gZnJvbSBcIi4vdXRpbFwiO1xuXG4vLyBXZSBkb24ndCB3YW50IHRoZSBmdWxsIERPTSB0eXBpbmdzLCBhbmQgd2lsbCBvbmx5IHVzZVxuLy8gdGhpcyBldmVudCBpZiBpdCBhY3R1YWxseSBleGlzdHMuXG5kZWNsYXJlIHZhciBQcm9taXNlUmVqZWN0aW9uRXZlbnQ6IGFueTtcblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBlcnJvcnMgdGhyb3duIHdoZW4gYSAocG9zc2libHkpIHJlamVjdGVkIHByb21pc2UgaXMgZGV0ZWN0ZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBCYXNlVW5oYW5kbGVkUmVqZWN0aW9uIGV4dGVuZHMgQmFzZUVycm9yIHtcblx0LyoqXG5cdCAqIE9yaWdpbmFsIHByb21pc2UgcmVqZWN0aW9uIHJlYXNvbi5cblx0ICovXG5cdHB1YmxpYyByZWFzb246IGFueTtcblxuXHRjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcmVhc29uOiBhbnkpIHtcblx0XHRzdXBlcihuYW1lLCBgJHttZXNzYWdlfTogJHtyZWFzb259YCkgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKFRTIGVtaXR0ZWQgY29kZSkgKi87XG5cdFx0dGhpcy5yZWFzb24gPSByZWFzb247XG5cdFx0Ly8gSW4gY2FzZSB3ZSBoYXZlIGEgcmVhc29uLCBhbmQgaXQgaGFzIGEgc3RhY2s6IHVzZSBpdCBpbnN0ZWFkIG9mIG91clxuXHRcdC8vIG93biBzdGFjaywgYXMgaXQncyBtb3JlIGhlbHBmdWwgdG8gc2VlIHdoZXJlIHRoZSBvcmlnaW5hbCBlcnJvciB3YXNcblx0XHQvLyB0aHJvd24sIHRoYW4gd2hlcmUgaXQgd2FzIHRocm93biBpbnNpZGUgdGhlIHByb21pc2UgbGliLlxuXHRcdC8vIEluIGNhc2Ugd2UgZG9uJ3QgaGF2ZSBhIHN0YWNrLCBleHBsaWNpdGx5IHN0YXRlIHNvLCB0byBub3QgbGV0IHBlb3BsZVxuXHRcdC8vIGNoYXNlIGEgcHJvYmxlbSBpbiB0aGUgcHJvbWlzZSBsaWIgdGhhdCBpc24ndCB0aGVyZS4uLlxuXHRcdGxldCBzdGFjazogc3RyaW5nID0gdGhpcy5yZWFzb24gJiYgdHlwZW9mIHRoaXMucmVhc29uID09PSBcIm9iamVjdFwiICYmIHRoaXMucmVhc29uLnN0YWNrO1xuXHRcdGlmICh0eXBlb2Ygc3RhY2sgIT09IFwic3RyaW5nXCIpIHtcblx0XHRcdHN0YWNrID0gU3RyaW5nKHRoaXMucmVhc29uKTtcblx0XHR9XG5cdFx0dGhpcy5zdGFjayA9IGAke3RoaXMubmFtZX06ICR7c3RhY2t9YDtcblx0fVxufVxuXG4vKipcbiAqIFRocm93biB3aGVuIGEgcmVqZWN0ZWQgcHJvbWlzZSBpcyBleHBsaWNpdGx5IHRlcm1pbmF0ZWQgd2l0aCBgLmRvbmUoKWAuXG4gKi9cbmV4cG9ydCBjbGFzcyBVbmhhbmRsZWRSZWplY3Rpb24gZXh0ZW5kcyBCYXNlVW5oYW5kbGVkUmVqZWN0aW9uIHtcblx0LyoqXG5cdCAqIFRyYWNlIG9mIHJlamVjdGVkIHByb21pc2Ugb3IgLmRvbmUoKSBoYW5kbGVyLlxuXHQgKi9cblx0cHVibGljIHRyYWNlOiBUcmFjZTtcblxuXHRjb25zdHJ1Y3RvcihyZWFzb246IGFueSwgdHJhY2U6IFRyYWNlKSB7XG5cdFx0c3VwZXIoXCJVbmhhbmRsZWRSZWplY3Rpb25cIiwgXCJ1bmhhbmRsZWQgcmVqZWN0aW9uXCIsIHJlYXNvbikgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKFRTIGVtaXR0ZWQgY29kZSkgKi87XG5cdFx0Ly8gVE9ETzogRmluZCBhIGJldHRlciB3YXkgdG8gbWVyZ2UgdGhlIGxvY2F0aW9uIG9mIGAuZG9uZSgpYCBpbiB0aGVcblx0XHQvLyB0cmFjZSwgYmVjYXVzZSBub2JvZHkgd2lsbCBsb29rIGZvciB0aGlzIHByb3BlcnR5Li4uXG5cdFx0dGhpcy50cmFjZSA9IHRyYWNlO1xuXHR9XG59XG5cbi8qKlxuICogRW1pdHRlZCB3aGVuIGEgcmVqZWN0ZWQgcHJvbWlzZSBpc24ndCBoYW5kbGVkLlxuICogQHNlZSBQcm9taXNlLm9uUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uIGV4dGVuZHMgQmFzZVVuaGFuZGxlZFJlamVjdGlvbiB7XG5cdC8qKlxuXHQgKiBSZWplY3RlZCBwcm9taXNlLlxuXHQgKi9cblx0cHVibGljIHByb21pc2U6IFByb21pc2U8YW55PjtcblxuXHRjb25zdHJ1Y3Rvcihwcm9taXNlOiBQcm9taXNlPGFueT4pIHtcblx0XHRzdXBlcihcblx0XHRcdFwiUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb25cIixcblx0XHRcdFwicG9zc2libHkgdW5oYW5kbGVkIHJlamVjdGlvblwiLFxuXHRcdFx0cHJvbWlzZS5yZWFzb24oKVxuXHRcdCkgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKFRTIGVtaXR0ZWQgY29kZSkgKi87XG5cdFx0dGhpcy5wcm9taXNlID0gcHJvbWlzZTtcblx0fVxufVxuXG4vKipcbiAqIEVtaXQgUHJvbWlzZVJlamVjdGlvbkV2ZW50IChpbiBicm93c2VyIGVudmlyb25tZW50KS5cbiAqIERpc3BhdGNoZXMgdGhlIGV2ZW50IHRvIGFsbCByZWdpc3RlcmVkIGhhbmRsZXJzLCBlLmcuXG4gKiAtIHdpbmRvdy5vbnVuaGFuZGxlZHJlamVjdGlvbiAvIHdpbmRvdy5vbnJlamVjdGlvbmhhbmRsZWRcbiAqIC0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJ1bmhhbmRsZWRyZWplY3Rpb25cIiwgKGV2ZW50KSA9PiB7IC4uLiB9KSwgZXRjXG4gKiBVc2VzIHNlbGYgaW4gY2FzZSBvZiBXZWJXb3JrZXIuXG4gKlxuICogQHBhcmFtIHR5cGUgRWl0aGVyIFwidW5oYW5kbGVkcmVqZWN0aW9uXCIgb3IgXCJyZWplY3Rpb25oYW5kbGVkXCJcbiAqIEBwYXJhbSByZWFzb24gVmFsdWUgdXNlZCB0byByZWplY3QgcHJvbWlzZVxuICogQHBhcmFtIHByb21pc2UgdHMtcHJvbWlzZSBpbnN0YW5jZVxuICogQHJldHVybiB0cnVlIHdoZW4gZXZlbnQgd2FzICdoYW5kbGVkJyAoaS5lLiBzb21lb25lIGNhbGxlZCBwcmV2ZW50RGVmYXVsdCgpIG9uIGl0KSwgZmFsc2Ugb3RoZXJ3aXNlXG4gKi9cbmZ1bmN0aW9uIGVtaXRSZWplY3Rpb25FdmVudChcblx0dHlwZTogXCJ1bmhhbmRsZWRyZWplY3Rpb25cIiB8IFwicmVqZWN0aW9uaGFuZGxlZFwiLFxuXHRyZWFzb246IGFueSxcblx0cHJvbWlzZTogUHJvbWlzZTxhbnk+XG4pOiBib29sZWFuIHtcblx0Ly8gQnJvd3NlcnMgZG8gYSBuYXRpdmUgUHJvbWlzZS5yZXNvbHZlKCkgb24gdGhlIHByb21pc2UgZ2l2ZW4gaW4gUHJvbWlzZVJlamVjdEV2ZW50LFxuXHQvLyB3aGljaCBjYXVzZXMgYW4gdW5oYW5kbGVkIHJlamVjdGlvbiBlcnJvciBkdWUgdG8gdGhhdCBuYXRpdmUgcHJvbWlzZSBub3QgYmVpbmcgaGFuZGxlZCxcblx0Ly8gYW5kIHByZXZlbnRzIHRoZSB1c2VyJ3MgdW5oYW5kbGVkIHJlamVjdGlvbiBoYW5kbGVyIGZyb20gYWNjZXNzaW5nIHRoZSBhY3R1YWxcblx0Ly8gdHMtcHJvbWlzZSBQcm9taXNlLiBUaGlzIHdvdWxkIG1ha2UgdGhlIGhhbmRsZWQgcmVqZWN0aW9uIGhhbmRsZXIgdXNlbGVzcywgYmVjYXVzZSB0aGF0XG5cdC8vIGdldHMgYW5vdGhlciBuYXRpdmUgcHJvbWlzZS5cblx0Ly8gU28sIHByZXZlbnQgdGhlIHVuaGFuZGxlZCByZWplY3Rpb24gd2hlbiBjb25zdHJ1Y3RpbmcgdGhlIGV2ZW50LCB0aGVuIG92ZXJyaWRlIHRoZVxuXHQvLyBwcm9wZXJ0eSB0byByZXR1cm4gdGhlICdyZWFsJyBwcm9taXNlLlxuXHQvLyBNRE4gc2F5cyBpdCBpc24ndCBjYW5jZWxhYmxlLCBidXQgYm90aCBDaHJvbWUgYW5kIEZpcmVmb3ggZG8gaGF2ZSBpdCBjYW5jZWxhYmxlLlxuXHRjb25zdCBldmVudCA9IG5ldyBQcm9taXNlUmVqZWN0aW9uRXZlbnQodHlwZSwge1xuXHRcdGNhbmNlbGFibGU6IHRydWUsIC8vIGFsbG93IGV2ZW50LnByZXZlbnREZWZhdWx0KClcblx0XHRwcm9taXNlOiB0cnVlLCAvLyBzb21ldGhpbmcgdGhhdCdzIG5vdCByZWplY3RlZFxuXHRcdHJlYXNvbixcblx0fSk7XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShldmVudCwgXCJwcm9taXNlXCIsIHtcblx0XHR2YWx1ZTogcHJvbWlzZSxcblx0fSk7XG5cdGNvbnN0IGdsb2JhbCA9IGdldEdsb2JhbCgpO1xuXHRpZiAoZ2xvYmFsLmRpc3BhdGNoRXZlbnQgJiYgIWdsb2JhbC5kaXNwYXRjaEV2ZW50KGV2ZW50KSkge1xuXHRcdC8vIFNvbWVvbmUgY2FsbGVkIHByZXZlbnREZWZhdWx0KClcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRyZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogRGVmYXVsdCBoYW5kbGVyIGZvciBhbmBVbmhhbmRsZWRSZWplY3Rpb25gIGVycm9yLCB3aGljaCBjb250YWlucyB0aGVcbiAqIG9yaWdpbmFsIHJlYXNvbiBvZiB0aGUgcmVqZWN0aW9uLlxuICogSW4gTm9kZSwgaWYgeW91IGRvbid0IGhhdmUgYW4gYHVuaGFuZGxlZEV4Y2VwdGlvbmAgZXZlbnQgaGFuZGxlciwgdGhhdCB3aWxsIGNhdXNlIHlvdXJcbiAqIHByb2dyYW0gdG8gdGVybWluYXRlIGFmdGVyIHByaW50aW5nIHRoZSBlcnJvci5cbiAqIFdoZW4gb3ZlcnJpZGluZyB0aGUgZGVmYXVsdCBoYW5kbGVyLCBpdCBpcyByZWNvbW1lbmRlZCB0byBrZWVwIGEgc2ltaWxhciBiZWhhdmlvcixcbiAqIGFzIHlvdXIgcHJvZ3JhbSBpcyBsaWtlbHkgaW4gYW4gdW5rbm93biBzdGF0ZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRVbmhhbmRsZWRSZWplY3Rpb25IYW5kbGVyKHJlYXNvbjogYW55LCBkb25lVHJhY2U6IFRyYWNlKTogdm9pZCB7XG5cdGNvbnN0IHVuaGFuZGxlZFJlamVjdGlvbiA9IG5ldyBVbmhhbmRsZWRSZWplY3Rpb24ocmVhc29uLCBkb25lVHJhY2UpO1xuXHQvLyBMZWF2ZSB0aGUgY29tbWVudCBhZnRlciB0aGUgdGhyb3c6IG1heSBzaG93IHVwIGluIHNvdXJjZSBsaW5lIGluIG5vZGVcblx0dGhyb3cgdW5oYW5kbGVkUmVqZWN0aW9uOyAvLyBVbmhhbmRsZWQgcmVqZWN0aW9uIGNhdWdodCBieSAuZG9uZSgpXG59XG5cbi8qKlxuICogRGVmYXVsdCBoYW5kbGVyIGZvciBwb3NzaWJseSB1bmhhbmRsZWQgcmVqZWN0aW9uLiBJdCB3aWxsOlxuICogLSBlbWl0IE5vZGUncyBgdW5oYW5kbGVkUmVqZWN0aW9uYCBldmVudCBpZiBwcmVzZW50LCBvclxuICogLSBlbWl0IGFuIGB1bmhhbmRsZWRyZWplY3Rpb25gIChub3RlIHNtYWxsIFIpIGBQcm9taXNlUmVqZWN0aW9uRXZlbnRgIG9uIGB3aW5kb3dgIG9yIGBzZWxmYCBpZiBwcmVzZW50LCBvclxuICogLSBsb2cgdGhlIHJlamVjdGlvbiB1c2luZyBgY29uc29sZS53YXJuKClgLlxuICpcbiAqIE5vdGU6IHdoZW4gYXR0YWNoaW5nIGFuIGB1bmhhbmRsZWRyZWplY3Rpb25gIGhhbmRsZXIgaW4gdGhlIGJyb3dzZXIsIG1ha2Ugc3VyZSB0b1xuICogY2FsbCBgZXZlbnQucHJldmVudERlZmF1bHQoKWAgdG8gcHJldmVudCB0cy1wcm9taXNlJ3MgZGVmYXVsdCBmYWxsYmFjayBsb2dnaW5nLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVmYXVsdFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlcihwcm9taXNlOiBQcm9taXNlPGFueT4pOiB2b2lkIHtcblx0bGV0IGxvZyA9IHRydWU7XG5cblx0Ly8gRmlyc3QgdHJ5IHRvIGVtaXQgTm9kZSBldmVudFxuXHRpZiAodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIHByb2Nlc3MuZW1pdCA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0Ly8gSGF2ZSB0byBjYXN0IHByb21pc2UgdG8gYW55LCBiZWNhdXNlIGN1cnJlbnQgdHlwaW5ncyBvZiBwcm9jZXNzLmVtaXQoKSBoYXZlIHNwZWNpZmljXG5cdFx0Ly8gdHlwaW5ncyBmb3IgYXJndW1lbnRzIHRvIFwidW5oYW5kbGVkUmVqZWN0aW9uXCIsIHdoaWNoIHNheSBwcm9taXNlIG11c3QgYmUgYSBQcm9taXNlLFxuXHRcdC8vIGJ1dCB0aGF0IFByb21pc2UgaXMgdGhlIGJ1aWx0LWluIHR5cGUuXG5cdFx0aWYgKHByb2Nlc3MuZW1pdChcInVuaGFuZGxlZFJlamVjdGlvblwiLCBwcm9taXNlLnJlYXNvbigpLCBwcm9taXNlIGFzIGFueSkpIHtcblx0XHRcdC8vIEEgaGFuZGxlciB3YXMgY2FsbGVkXG5cdFx0XHRsb2cgPSBmYWxzZTtcblx0XHR9XG5cdH0gZWxzZSBpZiAodHlwZW9mIFByb21pc2VSZWplY3Rpb25FdmVudCA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0Ly8gVGhlbiBmaXJlIGEgYnJvd3NlciBldmVudCBpZiBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXJcblx0XHRpZiAoZW1pdFJlamVjdGlvbkV2ZW50KFwidW5oYW5kbGVkcmVqZWN0aW9uXCIsIHByb21pc2UucmVhc29uKCksIHByb21pc2UpKSB7XG5cdFx0XHRsb2cgPSBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHQvLyBGYWxsYmFjayB0byBsb2cgdG8gY29uc29sZVxuXHRpZiAobG9nKSB7XG5cdFx0Y29uc3QgcG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb24gPSBuZXcgUG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb24ocHJvbWlzZSk7XG5cdFx0Ly8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcblx0XHRjb25zb2xlLndhcm4ocG9zc2libHlVbmhhbmRsZWRSZWplY3Rpb24uc3RhY2spO1xuXHR9XG59XG5cbi8qKlxuICogRGVmYXVsdCBoYW5kbGVyIGZvciBoYW5kbGVkIHJlamVjdGlvbnMuXG4gKiBJdCB3aWxsIGVtaXQgTm9kZSdzIGByZWplY3Rpb25IYW5kbGVkYCBldmVudCBpZiBwcmVzZW50LCBvciBlbWl0IGFcbiAqIGByZWplY3Rpb25oYW5kbGVkYCAobm90ZSBzbWFsbCBSKSBldmVudCBvbiBgd2luZG93YCAob3IgYHNlbGZgKSBpZiBwcmVzZW50LlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVmYXVsdFBvc3NpYmx5VW5oYW5kbGVkUmVqZWN0aW9uSGFuZGxlZEhhbmRsZXIocHJvbWlzZTogUHJvbWlzZTxhbnk+KTogdm9pZCB7XG5cdC8vIEZpcnN0IHRyeSB0byBlbWl0IE5vZGUgZXZlbnRcblx0aWYgKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBwcm9jZXNzLmVtaXQgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdC8vIEhhdmUgdG8gY2FzdCBwcm9taXNlIHRvIGFueSwgYmVjYXVzZSBjdXJyZW50IHR5cGluZ3Mgb2YgcHJvY2Vzcy5lbWl0KCkgaGF2ZSBzcGVjaWZpY1xuXHRcdC8vIHR5cGluZ3MgZm9yIGFyZ3VtZW50cyB0byBcInJlamVjdGlvbkhhbmRsZWRcIiwgd2hpY2ggc2F5IHByb21pc2UgbXVzdCBiZSBhIFByb21pc2UsXG5cdFx0Ly8gYnV0IHRoYXQgUHJvbWlzZSBpcyB0aGUgYnVpbHQtaW4gdHlwZS5cblx0XHRwcm9jZXNzLmVtaXQoXCJyZWplY3Rpb25IYW5kbGVkXCIsIHByb21pc2UgYXMgYW55KTtcblx0fSBlbHNlIGlmICh0eXBlb2YgUHJvbWlzZVJlamVjdGlvbkV2ZW50ID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHQvLyBUaGVuIGZpcmUgYSBicm93c2VyIGV2ZW50IGlmIHN1cHBvcnRlZCBieSB0aGUgYnJvd3NlclxuXHRcdGVtaXRSZWplY3Rpb25FdmVudChcInJlamVjdGlvbmhhbmRsZWRcIiwgcHJvbWlzZS5yZWFzb24oKSwgcHJvbWlzZSk7XG5cdH1cbn1cbiJdfQ==
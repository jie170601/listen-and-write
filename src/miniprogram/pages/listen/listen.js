"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Word2Mp3_1 = require("../../utils/Word2Mp3");
const StorageUtil_1 = require("../../utils/StorageUtil");
const WordGroup_1 = require("../../beans/WordGroup");
const AudioUtil_1 = require("../../utils/AudioUtil");
const audioUtil = new AudioUtil_1.AudioUtil();
var StateEnum;
(function (StateEnum) {
    StateEnum[StateEnum["STOP"] = 0] = "STOP";
    StateEnum[StateEnum["PLAY"] = 1] = "PLAY";
    StateEnum[StateEnum["PAUSE"] = 2] = "PAUSE";
})(StateEnum || (StateEnum = {}));
Page({
    data: {
        state: StateEnum,
        curState: StateEnum.STOP,
        downloadCount: 0,
        playCount: 0,
        wordGroup: new WordGroup_1.WordGroup(),
        wordGroupList: new Array(),
        showTopTips: false,
        errMsg: ''
    },
    onLoad(options) {
        let groupid = options.groupid;
        let wordGroup = new WordGroup_1.WordGroup();
        let wordGroupList = StorageUtil_1.StorageUtil.getWordGroup();
        if (wordGroupList.length === 0) {
            console.log("没有单词分组");
        }
        wordGroup = wordGroupList[0];
        for (let i = 0; i < wordGroupList.length; i++) {
            if (wordGroupList[i].getId() === groupid) {
                wordGroup = wordGroupList[i];
            }
        }
        this.setData({
            wordGroup: wordGroup,
            wordGroupList: wordGroupList
        });
    },
    translateState(state) {
        this.setData({
            curState: state
        });
    },
    play() {
        if (this.data.curState === StateEnum.STOP) {
            try {
                let mp3Files = new Word2Mp3_1.Word2Mp3();
                let that = this;
                let words = this.data.wordGroup.getList();
                this.translateState(StateEnum.PLAY);
                mp3Files.getFilePaths(words, (count) => {
                    let curNumber = Math.round(count / words.length * 100);
                    that.setData({
                        downloadCount: curNumber
                    });
                }).then((paths) => {
                    console.log(paths.length);
                    that.audioReady(paths);
                });
            }
            catch (e) {
                let that = this;
                that.setData({
                    showTopTips: true,
                    errMsg: e
                });
                setTimeout(() => {
                    that.setData({
                        showTopTips: false,
                        errMsg: ''
                    });
                }, 3000);
            }
        }
        if (this.data.curState === StateEnum.PAUSE) {
            this.translateState(StateEnum.PLAY);
            audioUtil.playOrPause();
        }
    },
    pause() {
        this.translateState(StateEnum.PAUSE);
        audioUtil.playOrPause();
    },
    audioReady(paths) {
        audioUtil.setPaths(paths);
        audioUtil.setProccess(this.playProccess);
        audioUtil.setEnd(this.end);
        audioUtil.ready();
        audioUtil.playOrPause();
    },
    playProccess(cur) {
        let curNumber = Math.round(cur / this.data.wordGroup.getList().length * 100);
        this.setData({
            playCount: curNumber
        });
    },
    end() {
        this.setData({
            curState: StateEnum.STOP,
            downloadCount: 0,
            playCount: 0,
            showTopTips: false,
            errMsg: ''
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdGVuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsbURBQStDO0FBRS9DLHlEQUFtRDtBQUNuRCxxREFBK0M7QUFHL0MscURBQStDO0FBSS9DLE1BQU0sU0FBUyxHQUFhLElBQUkscUJBQVMsRUFBRSxDQUFBO0FBUzNDLElBQUssU0FJSjtBQUpELFdBQUssU0FBUztJQUNaLHlDQUFJLENBQUE7SUFDSix5Q0FBSSxDQUFBO0lBQ0osMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFKSSxTQUFTLEtBQVQsU0FBUyxRQUliO0FBRUQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFDLFNBQVM7UUFDZixRQUFRLEVBQUMsU0FBUyxDQUFDLElBQUk7UUFDdkIsYUFBYSxFQUFDLENBQUM7UUFDZixTQUFTLEVBQUMsQ0FBQztRQUNYLFNBQVMsRUFBQyxJQUFJLHFCQUFTLEVBQUU7UUFDekIsYUFBYSxFQUFDLElBQUksS0FBSyxFQUFjO1FBQ3JDLFdBQVcsRUFBQyxLQUFLO1FBQ2pCLE1BQU0sRUFBQyxFQUFFO0tBQ1Y7SUFDRCxNQUFNLENBQUMsT0FBVztRQUNoQixJQUFJLE9BQU8sR0FBVSxPQUFPLENBQUMsT0FBTyxDQUFBO1FBQ3BDLElBQUksU0FBUyxHQUFjLElBQUkscUJBQVMsRUFBRSxDQUFBO1FBQzFDLElBQUksYUFBYSxHQUFxQix5QkFBVyxDQUFDLFlBQVksRUFBRSxDQUFBO1FBRWhFLElBQUksYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUN0QjtRQUVELFNBQVMsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFNUIsS0FBSSxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUM7WUFDckMs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LElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtRQUNwRixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osU0FBUyxFQUFFLFNBQVM7U0FDckIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELEdBQUc7UUFDRCxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osUUFBUSxFQUFDLFNBQVMsQ0FBQyxJQUFJO1lBQ3ZCLGFBQWEsRUFBQyxDQUFDO1lBQ2YsU0FBUyxFQUFDLENBQUM7WUFDWCxXQUFXLEVBQUUsS0FBSztZQUNsQixNQUFNLEVBQUUsRUFBRTtTQUNYLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvL2luZGV4LmpzXHJcbi8v6I635Y+W5bqU55So5a6e5L6LXHJcbi8vIGltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uL2FwcCdcclxuaW1wb3J0IHsgV29yZDJNcDMgfSBmcm9tICcuLi8uLi91dGlscy9Xb3JkMk1wMydcclxuLy8gaW1wb3J0IHsgc2hvd0Vycm9yTXNnIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCdcclxuaW1wb3J0IHtTdG9yYWdlVXRpbH0gZnJvbSAnLi4vLi4vdXRpbHMvU3RvcmFnZVV0aWwnXHJcbmltcG9ydCB7V29yZEdyb3VwfSBmcm9tICcuLi8uLi9iZWFucy9Xb3JkR3JvdXAnXHJcbmltcG9ydCB7V29yZH0gZnJvbSAnLi4vLi4vYmVhbnMvV29yZCdcclxuLy8gaW1wb3J0IHtJbmRleExpc3R9IGZyb20gJy4uLy4uL2JlYW4vSW5kZXhMaXN0J1xyXG5pbXBvcnQge0F1ZGlvVXRpbH0gZnJvbSAnLi4vLi4vdXRpbHMvQXVkaW9VdGlsJ1xyXG5cclxuLy8gY29uc3QgYXBwID0gZ2V0QXBwPElNeUFwcD4oKVxyXG5cclxuY29uc3QgYXVkaW9VdGlsOkF1ZGlvVXRpbCA9IG5ldyBBdWRpb1V0aWwoKVxyXG5cclxuLyoqXHJcbiAqIOWjsOaYjuS6huS4gOS4quaemuS4vuexu+Wei1xyXG4gKiDnlKjmnaXljLrliIbpobXpnaLnmoTkuInnp43nirbmgIHvvJpcclxuICogMS7lgZzmraLnirbmgIHvvIzlj6rmnInlgZzmraLnirbmgIHlj6/ku6XliIfmjaLljZXor43liJfooajlkozor5Xpn7NcclxuICogMi7mkq3mlL7nirbmgIHvvIzmkq3mlL7nirbmgIHlj6rog73pgInmi6nmmoLlgZzlkozlgZzmraJcclxuICogMy7mmoLlgZznirbmgIHvvIzmmoLlgZznirbmgIHlj6rog73pgInmi6nmkq3mlL7lkozlgZzmraJcclxuICovXHJcbmVudW0gU3RhdGVFbnVte1xyXG4gIFNUT1AsXHJcbiAgUExBWSxcclxuICBQQVVTRVxyXG59XHJcblxyXG5QYWdlKHtcclxuICBkYXRhOiB7XHJcbiAgICBzdGF0ZTpTdGF0ZUVudW0sXHJcbiAgICBjdXJTdGF0ZTpTdGF0ZUVudW0uU1RPUCxcclxuICAgIGRvd25sb2FkQ291bnQ6MCxcclxuICAgIHBsYXlDb3VudDowLFxyXG4gICAgd29yZEdyb3VwOm5ldyBXb3JkR3JvdXAoKSxcclxuICAgIHdvcmRHcm91cExpc3Q6bmV3IEFycmF5IDxXb3JkR3JvdXA+KCksXHJcbiAgICBzaG93VG9wVGlwczpmYWxzZSxcclxuICAgIGVyck1zZzonJ1xyXG4gIH0sXHJcbiAgb25Mb2FkKG9wdGlvbnM6YW55KSB7XHJcbiAgICBsZXQgZ3JvdXBpZDpzdHJpbmcgPSBvcHRpb25zLmdyb3VwaWRcclxuICAgIGxldCB3b3JkR3JvdXA6IFdvcmRHcm91cCA9IG5ldyBXb3JkR3JvdXAoKVxyXG4gICAgbGV0IHdvcmRHcm91cExpc3Q6IEFycmF5PFdvcmRHcm91cD4gPSBTdG9yYWdlVXRpbC5nZXRXb3JkR3JvdXAoKVxyXG4gICAgLy/msqHmnInljZXor43liIbnu4TnmoTmg4XlhrXkuIvvvIzmmL7npLrliY3lvoDljZXor43nrqHnkIbpobXpnaLnmoTmjInpkq5cclxuICAgIGlmICh3b3JkR3JvdXBMaXN0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIuayoeacieWNleivjeWIhue7hFwiKVxyXG4gICAgfVxyXG4gICAgLy/pu5jorqTmmK/nrKzkuIDkuKrljZXor43liIbnu4RcclxuICAgIHdvcmRHcm91cCA9IHdvcmRHcm91cExpc3RbMF1cclxuICAgIC8v5aaC5p6c5Y+C5pWw5Lit5Lyg5LqG5Y2V6K+N5YiG57uE55qESUTvvIzliJnpgInmi6nlj4LmlbDnmoTljZXor43liIbnu4RcclxuICAgIGZvcihsZXQgaT0wO2k8d29yZEdyb3VwTGlzdC5sZW5ndGg7aSsrKXtcclxuICAgICAgaWYod29yZEdyb3VwTGlzdFtpXS5nZXRJZCgpPT09Z3JvdXBpZCl7XHJcbiAgICAgICAgd29yZEdyb3VwID0gd29yZEdyb3VwTGlzdFtpXVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldERhdGEhKHtcclxuICAgICAgd29yZEdyb3VwOiB3b3JkR3JvdXAsXHJcbiAgICAgIHdvcmRHcm91cExpc3Q6IHdvcmRHcm91cExpc3RcclxuICAgIH0pXHJcbiAgfSxcclxuICB0cmFuc2xhdGVTdGF0ZShzdGF0ZTpTdGF0ZUVudW0pe1xyXG4gICAgdGhpcy5zZXREYXRhISh7XHJcbiAgICAgIGN1clN0YXRlOnN0YXRlXHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgcGxheSgpe1xyXG4gICAgaWYgKHRoaXMuZGF0YS5jdXJTdGF0ZSA9PT0gU3RhdGVFbnVtLlNUT1ApIHtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgIGxldCBtcDNGaWxlczogV29yZDJNcDMgPSBuZXcgV29yZDJNcDMoKVxyXG4gICAgICBsZXQgdGhhdCA9IHRoaXNcclxuICAgICAgbGV0IHdvcmRzOiBBcnJheTxXb3JkPiA9IHRoaXMuZGF0YS53b3JkR3JvdXAuZ2V0TGlzdCgpXHJcbiAgICAgIHRoaXMudHJhbnNsYXRlU3RhdGUoU3RhdGVFbnVtLlBMQVkpXHJcbiAgICAgIG1wM0ZpbGVzLmdldEZpbGVQYXRocyh3b3JkcywgKGNvdW50OiBudW1iZXIpID0+IHtcclxuICAgICAgICBsZXQgY3VyTnVtYmVyOiBudW1iZXIgPSBNYXRoLnJvdW5kKGNvdW50IC8gd29yZHMubGVuZ3RoICogMTAwKVxyXG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xyXG4gICAgICAgICAgZG93bmxvYWRDb3VudDogY3VyTnVtYmVyXHJcbiAgICAgICAgfSlcclxuICAgICAgfSkudGhlbigocGF0aHM6IHN0cmluZ1tdKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocGF0aHMubGVuZ3RoKVxyXG4gICAgICAgIHRoYXQuYXVkaW9SZWFkeShwYXRocylcclxuICAgICAgfSlcclxuICAgIH1jYXRjaChlKXtcclxuICAgICAgbGV0IHRoYXQgPSB0aGlzXHJcbiAgICAgIHRoYXQuc2V0RGF0YSEoe1xyXG4gICAgICAgIHNob3dUb3BUaXBzOnRydWUsXHJcbiAgICAgICAgZXJyTXNnOmVcclxuICAgICAgfSlcclxuICAgICAgc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xyXG4gICAgICAgICAgc2hvd1RvcFRpcHM6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyTXNnOicnXHJcbiAgICAgICAgfSlcclxuICAgICAgfSwzMDAwKVxyXG4gICAgfVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy5kYXRhLmN1clN0YXRlPT09U3RhdGVFbnVtLlBBVVNFKXtcclxuICAgICAgdGhpcy50cmFuc2xhdGVTdGF0ZShTdGF0ZUVudW0uUExBWSlcclxuICAgICAgYXVkaW9VdGlsLnBsYXlPclBhdXNlKClcclxuICAgIH1cclxuICB9LFxyXG4gIHBhdXNlKCl7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZVN0YXRlKFN0YXRlRW51bS5QQVVTRSlcclxuICAgIGF1ZGlvVXRpbC5wbGF5T3JQYXVzZSgpXHJcbiAgfSxcclxuICBhdWRpb1JlYWR5KHBhdGhzOnN0cmluZ1tdKXtcclxuICAgIGF1ZGlvVXRpbC5zZXRQYXRocyhwYXRocylcclxuICAgIGF1ZGlvVXRpbC5zZXRQcm9jY2Vzcyh0aGlzLnBsYXlQcm9jY2VzcylcclxuICAgIGF1ZGlvVXRpbC5zZXRFbmQodGhpcy5lbmQpXHJcbiAgICBhdWRpb1V0aWwucmVhZHkoKVxyXG4gICAgYXVkaW9VdGlsLnBsYXlPclBhdXNlKClcclxuICB9LFxyXG4gIHBsYXlQcm9jY2VzcyhjdXI6bnVtYmVyKXtcclxuICAgIGxldCBjdXJOdW1iZXI6IG51bWJlciA9IE1hdGgucm91bmQoY3VyIC8gdGhpcy5kYXRhLndvcmRHcm91cC5nZXRMaXN0KCkubGVuZ3RoICogMTAwKVxyXG4gICAgdGhpcy5zZXREYXRhISh7XHJcbiAgICAgIHBsYXlDb3VudDogY3VyTnVtYmVyXHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgZW5kKCl7XHJcbiAgICB0aGlzLnNldERhdGEhKHtcclxuICAgICAgY3VyU3RhdGU6U3RhdGVFbnVtLlNUT1AsXHJcbiAgICAgIGRvd25sb2FkQ291bnQ6MCxcclxuICAgICAgcGxheUNvdW50OjAsXHJcbiAgICAgIHNob3dUb3BUaXBzOiBmYWxzZSxcclxuICAgICAgZXJyTXNnOiAnJ1xyXG4gICAgfSlcclxuICB9XHJcbn0pXHJcbiJdfQ==
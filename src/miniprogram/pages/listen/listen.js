"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Word2Mp3_1 = require("../../utils/Word2Mp3");
const StorageUtil_1 = require("../../utils/StorageUtil");
const WordGroup_1 = require("../../beans/WordGroup");
const AudioUtil_1 = require("../../utils/AudioUtil");
const audioUtil = new AudioUtil_1.AudioUtil();
var StateEnum;
(function (StateEnum) {
    StateEnum[StateEnum["STOP"] = 0] = "STOP";
    StateEnum[StateEnum["PLAY"] = 1] = "PLAY";
    StateEnum[StateEnum["PAUSE"] = 2] = "PAUSE";
})(StateEnum || (StateEnum = {}));
Page({
    data: {
        state: StateEnum,
        curState: StateEnum.STOP,
        showPicker: false,
        curNumber: 0,
        pickerIndex: [0],
        wordGroup: new WordGroup_1.WordGroup(),
        wordGroupList: StorageUtil_1.StorageUtil.getWordGroup(),
        showTopTips: false,
        errMsg: ''
    },
    bindViewTap() {
        wx.navigateTo({
            url: '../logs/logs'
        });
    },
    onLoad(options) {
        let groupid = options.groupid;
        let wordGroup = new WordGroup_1.WordGroup();
        let wordGroupList = StorageUtil_1.StorageUtil.getWordGroup();
        if (wordGroupList.length === 0) {
            console.log("没有单词分组");
        }
        wordGroup = wordGroupList[0];
        for (let i = 0; i < wordGroupList.length; i++) {
            if (wordGroupList[i].getId() === groupid) {
                wordGroup = wordGroupList[i];
            }
        }
        this.setData({
            wordGroup: wordGroup,
            wordGroupList: wordGroupList
        });
    },
    selectList() {
        let showPicker = !this.data.showPicker;
        this.setData({
            showPicker: showPicker
        });
    },
    bindChange(e) {
        console.log(e);
        let wordGroup = this.data.wordGroupList[e.detail.value[0]];
        this.setData({
            pickerIndex: e.detail.value,
            wordGroup: wordGroup
        });
    },
    translateState(state) {
        this.setData({
            curState: state
        });
    },
    play() {
        if (this.data.curState === StateEnum.STOP) {
            try {
                let mp3Files = new Word2Mp3_1.Word2Mp3();
                let that = this;
                let words = this.data.wordGroup.getList();
                this.translateState(StateEnum.PLAY);
                mp3Files.getFilePaths(words, (count) => {
                    let curNumber = Math.round(count / words.length * 100);
                    that.setData({
                        curNumber: curNumber
                    });
                }).then((paths) => {
                    console.log(paths.length);
                    that.audioReady(paths);
                });
            }
            catch (e) {
                let that = this;
                that.setData({
                    showTopTips: true,
                    errMsg: e
                });
                setTimeout(() => {
                    that.setData({
                        showTopTips: false,
                        errMsg: ''
                    });
                }, 3000);
            }
        }
        if (this.data.curState === StateEnum.PAUSE) {
            this.translateState(StateEnum.PLAY);
            audioUtil.playOrPause();
        }
    },
    pause() {
        this.translateState(StateEnum.PAUSE);
        audioUtil.playOrPause();
    },
    audioReady(paths) {
        audioUtil.setPaths(paths);
        audioUtil.setProccess(this.playProccess);
        audioUtil.ready();
        audioUtil.playOrPause();
    },
    playProccess(cur) {
        let curNumber = Math.round(cur / this.data.wordGroup.getList().length * 100);
        this.setData({
            curNumber: curNumber
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdGVuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsbURBQStDO0FBRS9DLHlEQUFtRDtBQUNuRCxxREFBK0M7QUFHL0MscURBQStDO0FBSS9DLE1BQU0sU0FBUyxHQUFhLElBQUkscUJBQVMsRUFBRSxDQUFBO0FBUzNDLElBQUssU0FJSjtBQUpELFdBQUssU0FBUztJQUNaLHlDQUFJLENBQUE7SUFDSix5Q0FBSSxDQUFBO0lBQ0osMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFKSSxTQUFTLEtBQVQsU0FBUyxRQUliO0FBRUQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFDLFNBQVM7UUFDZixRQUFRLEVBQUMsU0FBUyxDQUFDLElBQUk7UUFDdkIsVUFBVSxFQUFDLEtBQUs7UUFDaEIsU0FBUyxFQUFDLENBQUM7UUFJWCxXQUFXLEVBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZixTQUFTLEVBQUMsSUFBSSxxQkFBUyxFQUFFO1FBTXpCLGFBQWEsRUFBRSx5QkFBVyxDQUFDLFlBQVksRUFBRTtRQUN6QyxXQUFXLEVBQUMsS0FBSztRQUNqQixNQUFNLEVBQUMsRUFBRTtLQUNWO0lBRUQsV0FBVztRQUNULEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsY0FBYztTQUNwQixDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsTUFBTSxDQUFDLE9BQVc7UUFDaEIsSUFBSSxPQUFPLEdBQVUsT0FBTyxDQUFDLE9BQU8sQ0FBQTtRQUNwQyxJQUFJLFNBQVMsR0FBYyxJQUFJLHFCQUFTLEVBQUUsQ0FBQTtRQUMxQyxJQUFJLGFBQWEsR0FBcUIseUJBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUVoRSxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7U0FDdEI7UUFFRCxTQUFTLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRTVCLEtBQUksSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFDLENBQUMsR0FBQyxhQUFhLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFDO1lBQ3JDLElBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFHLE9BQU8sRUFBQztnQkFDcEMsU0FBUyxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUM3QjtTQUNGO1FBQ0QsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLGFBQWEsRUFBRSxhQUFhO1NBQzdCLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFDRCxVQUFVO1FBQ1IsSUFBSSxVQUFVLEdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQTtRQUM5QyxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osVUFBVSxFQUFFLFVBQVU7U0FDdkIsQ0FBQyxDQUFBO0lBTUosQ0FBQztJQUNELFVBQVUsQ0FBQyxDQUFLO1FBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNkLElBQUksU0FBUyxHQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDckUsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFdBQVcsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUs7WUFDM0IsU0FBUyxFQUFDLFNBQVM7U0FDcEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELGNBQWMsQ0FBQyxLQUFlO1FBQzVCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixRQUFRLEVBQUMsS0FBSztTQUNmLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFDRCxJQUFJO1FBQ0YsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsSUFBSSxFQUFFO1lBRXpDLElBQUk7Z0JBQ0osSUFBSSxRQUFRLEdBQWEsSUFBSSxtQkFBUSxFQUFFLENBQUE7Z0JBQ3ZDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQTtnQkFDZixJQUFJLEtBQUssR0FBZ0IsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUE7Z0JBQ3RELElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUNuQyxRQUFRLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDLEtBQWEsRUFBRSxFQUFFO29CQUM3QyxJQUFJLFNBQVMsR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFBO29CQUM5RCxJQUFJLENBQUMsT0FBUSxDQUFDO3dCQUNaLFNBQVMsRUFBRSxTQUFTO3FCQUNyQixDQUFDLENBQUE7Z0JBQ0osQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBZSxFQUFFLEVBQUU7b0JBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBO29CQUN6QixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUN4QixDQUFDLENBQUMsQ0FBQTthQUNIO1lBQUEsT0FBTSxDQUFDLEVBQUM7Z0JBQ1AsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFBO2dCQUNmLElBQUksQ0FBQyxPQUFRLENBQUM7b0JBQ1osV0FBVyxFQUFDLElBQUk7b0JBQ2hCLE1BQU0sRUFBQyxDQUFDO2lCQUNULENBQUMsQ0FBQTtnQkFDRixVQUFVLENBQUMsR0FBRSxFQUFFO29CQUNiLElBQUksQ0FBQyxPQUFRLENBQUM7d0JBQ1osV0FBVyxFQUFFLEtBQUs7d0JBQ2xCLE1BQU0sRUFBQyxFQUFFO3FCQUNWLENBQUMsQ0FBQTtnQkFDSixDQUFDLEVBQUMsSUFBSSxDQUFDLENBQUE7YUFDUjtTQUNBO1FBQ0QsSUFBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBRyxTQUFTLENBQUMsS0FBSyxFQUFDO1lBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ25DLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtTQUN4QjtJQUNILENBQUM7SUFDRCxLQUFLO1FBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDcEMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQ3pCLENBQUM7SUFDRCxVQUFVLENBQUMsS0FBYztRQUN2QixTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3pCLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBQ3hDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtRQUNqQixTQUFTLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDekIsQ0FBQztJQUNELFlBQVksQ0FBQyxHQUFVO1FBQ3JCLElBQUksU0FBUyxHQUFXLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtRQUNwRixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osU0FBUyxFQUFFLFNBQVM7U0FDckIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vaW5kZXguanNcbi8v6I635Y+W5bqU55So5a6e5L6LXG4vLyBpbXBvcnQgeyBJTXlBcHAgfSBmcm9tICcuLi8uLi9hcHAnXG5pbXBvcnQgeyBXb3JkMk1wMyB9IGZyb20gJy4uLy4uL3V0aWxzL1dvcmQyTXAzJ1xuLy8gaW1wb3J0IHsgc2hvd0Vycm9yTXNnIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCdcbmltcG9ydCB7U3RvcmFnZVV0aWx9IGZyb20gJy4uLy4uL3V0aWxzL1N0b3JhZ2VVdGlsJ1xuaW1wb3J0IHtXb3JkR3JvdXB9IGZyb20gJy4uLy4uL2JlYW5zL1dvcmRHcm91cCdcbmltcG9ydCB7V29yZH0gZnJvbSAnLi4vLi4vYmVhbnMvV29yZCdcbi8vIGltcG9ydCB7SW5kZXhMaXN0fSBmcm9tICcuLi8uLi9iZWFuL0luZGV4TGlzdCdcbmltcG9ydCB7QXVkaW9VdGlsfSBmcm9tICcuLi8uLi91dGlscy9BdWRpb1V0aWwnXG5cbi8vIGNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KClcblxuY29uc3QgYXVkaW9VdGlsOkF1ZGlvVXRpbCA9IG5ldyBBdWRpb1V0aWwoKVxuXG4vKipcbiAqIOWjsOaYjuS6huS4gOS4quaemuS4vuexu+Wei1xuICog55So5p2l5Yy65YiG6aG16Z2i55qE5LiJ56eN54q25oCB77yaXG4gKiAxLuWBnOatoueKtuaAge+8jOWPquacieWBnOatoueKtuaAgeWPr+S7peWIh+aNouWNleivjeWIl+ihqOWSjOivlemfs1xuICogMi7mkq3mlL7nirbmgIHvvIzmkq3mlL7nirbmgIHlj6rog73pgInmi6nmmoLlgZzlkozlgZzmraJcbiAqIDMu5pqC5YGc54q25oCB77yM5pqC5YGc54q25oCB5Y+q6IO96YCJ5oup5pKt5pS+5ZKM5YGc5q2iXG4gKi9cbmVudW0gU3RhdGVFbnVte1xuICBTVE9QLFxuICBQTEFZLFxuICBQQVVTRVxufVxuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHN0YXRlOlN0YXRlRW51bSxcbiAgICBjdXJTdGF0ZTpTdGF0ZUVudW0uU1RPUCxcbiAgICBzaG93UGlja2VyOmZhbHNlLFxuICAgIGN1ck51bWJlcjowLFxuICAgIC8qKlxuICAgICAqIOm7mOiupOWNleivjeWIl+ihqOmAieaLqeWZqOmAieS4reesrOS4gOS4qumAiemhuVxuICAgICAqL1xuICAgIHBpY2tlckluZGV4OlswXSxcbiAgICB3b3JkR3JvdXA6bmV3IFdvcmRHcm91cCgpLFxuICAgIC8qKlxuICAgICAqIOi/memHjOmBh+WIsOS4gOS4quWdkVxuICAgICAqIOmAieaLqeWZqOeahOaVsOaNruW/hemhu+WcqGRhdGHph4zlsLHotYvlgLzlrozmiJBcbiAgICAgKiDljrvku6PnoIHph4zlho3otYvlgLzlm57pgKDmiJDpu5jorqTpgInmi6nlpLHmlYhcbiAgICAgKi9cbiAgICB3b3JkR3JvdXBMaXN0OiBTdG9yYWdlVXRpbC5nZXRXb3JkR3JvdXAoKSxcbiAgICBzaG93VG9wVGlwczpmYWxzZSxcbiAgICBlcnJNc2c6JydcbiAgfSxcbiAgLy/kuovku7blpITnkIblh73mlbBcbiAgYmluZFZpZXdUYXAoKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6ICcuLi9sb2dzL2xvZ3MnXG4gICAgfSlcbiAgfSxcbiAgb25Mb2FkKG9wdGlvbnM6YW55KSB7XG4gICAgbGV0IGdyb3VwaWQ6c3RyaW5nID0gb3B0aW9ucy5ncm91cGlkXG4gICAgbGV0IHdvcmRHcm91cDogV29yZEdyb3VwID0gbmV3IFdvcmRHcm91cCgpXG4gICAgbGV0IHdvcmRHcm91cExpc3Q6IEFycmF5PFdvcmRHcm91cD4gPSBTdG9yYWdlVXRpbC5nZXRXb3JkR3JvdXAoKVxuICAgIC8v5rKh5pyJ5Y2V6K+N5YiG57uE55qE5oOF5Ya15LiL77yM5pi+56S65YmN5b6A5Y2V6K+N566h55CG6aG16Z2i55qE5oyJ6ZKuXG4gICAgaWYgKHdvcmRHcm91cExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIuayoeacieWNleivjeWIhue7hFwiKVxuICAgIH1cbiAgICAvL+m7mOiupOaYr+esrOS4gOS4quWNleivjeWIhue7hFxuICAgIHdvcmRHcm91cCA9IHdvcmRHcm91cExpc3RbMF1cbiAgICAvL+WmguaenOWPguaVsOS4reS8oOS6huWNleivjeWIhue7hOeahElE77yM5YiZ6YCJ5oup5Y+C5pWw55qE5Y2V6K+N5YiG57uEXG4gICAgZm9yKGxldCBpPTA7aTx3b3JkR3JvdXBMaXN0Lmxlbmd0aDtpKyspe1xuICAgICAgaWYod29yZEdyb3VwTGlzdFtpXS5nZXRJZCgpPT09Z3JvdXBpZCl7XG4gICAgICAgIHdvcmRHcm91cCA9IHdvcmRHcm91cExpc3RbaV1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICB3b3JkR3JvdXA6IHdvcmRHcm91cCxcbiAgICAgIHdvcmRHcm91cExpc3Q6IHdvcmRHcm91cExpc3RcbiAgICB9KVxuICB9LFxuICBzZWxlY3RMaXN0KCl7XG4gICAgbGV0IHNob3dQaWNrZXI6Ym9vbGVhbiA9ICF0aGlzLmRhdGEuc2hvd1BpY2tlclxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2hvd1BpY2tlcjogc2hvd1BpY2tlclxuICAgIH0pXG4gICAgLy8gbGV0IGN1ck51bWJlcjpudW1iZXIgPSB0aGlzLmRhdGEhLmN1ck51bWJlcisxXG4gICAgLy8gdGhpcy5zZXREYXRhISh7XG4gICAgLy8gICBjdXJOdW1iZXI6Y3VyTnVtYmVyXG4gICAgLy8gfSlcbiAgICAvLyBjb25zb2xlLmxvZyhjdXJOdW1iZXIpXG4gIH0sXG4gIGJpbmRDaGFuZ2UoZTphbnkpe1xuICAgIGNvbnNvbGUubG9nKGUpXG4gICAgbGV0IHdvcmRHcm91cDogV29yZEdyb3VwID0gdGhpcy5kYXRhLndvcmRHcm91cExpc3RbZS5kZXRhaWwudmFsdWVbMF1dXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwaWNrZXJJbmRleDogZS5kZXRhaWwudmFsdWUsXG4gICAgICB3b3JkR3JvdXA6d29yZEdyb3VwXG4gICAgfSlcbiAgfSxcbiAgdHJhbnNsYXRlU3RhdGUoc3RhdGU6U3RhdGVFbnVtKXtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGN1clN0YXRlOnN0YXRlXG4gICAgfSlcbiAgfSxcbiAgcGxheSgpe1xuICAgIGlmICh0aGlzLmRhdGEuY3VyU3RhdGUgPT09IFN0YXRlRW51bS5TVE9QKSB7XG5cbiAgICAgIHRyeSB7XG4gICAgICBsZXQgbXAzRmlsZXM6IFdvcmQyTXAzID0gbmV3IFdvcmQyTXAzKClcbiAgICAgIGxldCB0aGF0ID0gdGhpc1xuICAgICAgbGV0IHdvcmRzOiBBcnJheTxXb3JkPiA9IHRoaXMuZGF0YS53b3JkR3JvdXAuZ2V0TGlzdCgpXG4gICAgICB0aGlzLnRyYW5zbGF0ZVN0YXRlKFN0YXRlRW51bS5QTEFZKVxuICAgICAgbXAzRmlsZXMuZ2V0RmlsZVBhdGhzKHdvcmRzLCAoY291bnQ6IG51bWJlcikgPT4ge1xuICAgICAgICBsZXQgY3VyTnVtYmVyOiBudW1iZXIgPSBNYXRoLnJvdW5kKGNvdW50IC8gd29yZHMubGVuZ3RoICogMTAwKVxuICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICBjdXJOdW1iZXI6IGN1ck51bWJlclxuICAgICAgICB9KVxuICAgICAgfSkudGhlbigocGF0aHM6IHN0cmluZ1tdKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHBhdGhzLmxlbmd0aClcbiAgICAgICAgdGhhdC5hdWRpb1JlYWR5KHBhdGhzKVxuICAgICAgfSlcbiAgICB9Y2F0Y2goZSl7XG4gICAgICBsZXQgdGhhdCA9IHRoaXNcbiAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICBzaG93VG9wVGlwczp0cnVlLFxuICAgICAgICBlcnJNc2c6ZVxuICAgICAgfSlcbiAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgICAgc2hvd1RvcFRpcHM6IGZhbHNlLFxuICAgICAgICAgIGVyck1zZzonJ1xuICAgICAgICB9KVxuICAgICAgfSwzMDAwKVxuICAgIH1cbiAgICB9XG4gICAgaWYodGhpcy5kYXRhLmN1clN0YXRlPT09U3RhdGVFbnVtLlBBVVNFKXtcbiAgICAgIHRoaXMudHJhbnNsYXRlU3RhdGUoU3RhdGVFbnVtLlBMQVkpXG4gICAgICBhdWRpb1V0aWwucGxheU9yUGF1c2UoKVxuICAgIH1cbiAgfSxcbiAgcGF1c2UoKXtcbiAgICB0aGlzLnRyYW5zbGF0ZVN0YXRlKFN0YXRlRW51bS5QQVVTRSlcbiAgICBhdWRpb1V0aWwucGxheU9yUGF1c2UoKVxuICB9LFxuICBhdWRpb1JlYWR5KHBhdGhzOnN0cmluZ1tdKXtcbiAgICBhdWRpb1V0aWwuc2V0UGF0aHMocGF0aHMpXG4gICAgYXVkaW9VdGlsLnNldFByb2NjZXNzKHRoaXMucGxheVByb2NjZXNzKVxuICAgIGF1ZGlvVXRpbC5yZWFkeSgpXG4gICAgYXVkaW9VdGlsLnBsYXlPclBhdXNlKClcbiAgfSxcbiAgcGxheVByb2NjZXNzKGN1cjpudW1iZXIpe1xuICAgIGxldCBjdXJOdW1iZXI6IG51bWJlciA9IE1hdGgucm91bmQoY3VyIC8gdGhpcy5kYXRhLndvcmRHcm91cC5nZXRMaXN0KCkubGVuZ3RoICogMTAwKVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgY3VyTnVtYmVyOiBjdXJOdW1iZXJcbiAgICB9KVxuICB9XG59KVxuIl19
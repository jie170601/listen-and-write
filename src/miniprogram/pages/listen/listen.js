"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Word2Mp3_1 = require("../../utils/Word2Mp3");
const StorageUtil_1 = require("../../utils/StorageUtil");
const WordGroup_1 = require("../../beans/WordGroup");
const AudioUtil_1 = require("../../utils/AudioUtil");
const audioUtil = new AudioUtil_1.AudioUtil();
var StateEnum;
(function (StateEnum) {
    StateEnum[StateEnum["STOP"] = 0] = "STOP";
    StateEnum[StateEnum["PLAY"] = 1] = "PLAY";
    StateEnum[StateEnum["PAUSE"] = 2] = "PAUSE";
})(StateEnum || (StateEnum = {}));
Page({
    data: {
        state: StateEnum,
        curState: StateEnum.STOP,
        downloadCount: 0,
        playCount: 0,
        wordGroup: new WordGroup_1.WordGroup(),
        wordGroupList: new Array(),
        showTopTips: false,
        errMsg: ''
    },
    onLoad(options) {
        let groupid = options.groupid;
        let wordGroup = new WordGroup_1.WordGroup();
        let wordGroupList = StorageUtil_1.StorageUtil.getWordGroup();
        if (wordGroupList.length === 0) {
            console.log("没有单词分组");
        }
        wordGroup = wordGroupList[0];
        for (let i = 0; i < wordGroupList.length; i++) {
            if (wordGroupList[i].getId() === groupid) {
                wordGroup = wordGroupList[i];
            }
        }
        this.setData({
            wordGroup: wordGroup,
            wordGroupList: wordGroupList
        });
    },
    translateState(state) {
        this.setData({
            curState: state
        });
    },
    play() {
        if (this.data.curState === StateEnum.STOP) {
            try {
                let mp3Files = new Word2Mp3_1.Word2Mp3();
                let that = this;
                let words = this.data.wordGroup.getList();
                this.translateState(StateEnum.PLAY);
                mp3Files.getFilePaths(words, (count) => {
                    let curNumber = Math.round(count / words.length * 100);
                    that.setData({
                        downloadCount: curNumber
                    });
                }).then((paths) => {
                    console.log(paths.length);
                    that.audioReady(paths);
                });
            }
            catch (e) {
                let that = this;
                that.setData({
                    showTopTips: true,
                    errMsg: e
                });
                setTimeout(() => {
                    that.setData({
                        showTopTips: false,
                        errMsg: ''
                    });
                }, 3000);
            }
        }
        if (this.data.curState === StateEnum.PAUSE) {
            this.translateState(StateEnum.PLAY);
            audioUtil.playOrPause();
        }
    },
    pause() {
        this.translateState(StateEnum.PAUSE);
        audioUtil.playOrPause();
    },
    audioReady(paths) {
        audioUtil.setPaths(paths);
        audioUtil.setProccess(this.playProccess);
        audioUtil.ready();
        audioUtil.playOrPause();
    },
    playProccess(cur) {
        let curNumber = Math.round(cur / this.data.wordGroup.getList().length * 100);
        this.setData({
            playCount: curNumber
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdGVuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsbURBQStDO0FBRS9DLHlEQUFtRDtBQUNuRCxxREFBK0M7QUFHL0MscURBQStDO0FBSS9DLE1BQU0sU0FBUyxHQUFhLElBQUkscUJBQVMsRUFBRSxDQUFBO0FBUzNDLElBQUssU0FJSjtBQUpELFdBQUssU0FBUztJQUNaLHlDQUFJLENBQUE7SUFDSix5Q0FBSSxDQUFBO0lBQ0osMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFKSSxTQUFTLEtBQVQsU0FBUyxRQUliO0FBRUQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFDLFNBQVM7UUFDZixRQUFRLEVBQUMsU0FBUyxDQUFDLElBQUk7UUFDdkIsYUFBYSxFQUFDLENBQUM7UUFDZixTQUFTLEVBQUMsQ0FBQztRQUNYLFNBQVMsRUFBQyxJQUFJLHFCQUFTLEVBQUU7UUFDekIsYUFBYSxFQUFDLElBQUksS0FBSyxFQUFjO1FBQ3JDLFdBQVcsRUFBQyxLQUFLO1FBQ2pCLE1BQU0sRUFBQyxFQUFFO0tBQ1Y7SUFDRCxNQUFNLENBQUMsT0FBVztRQUNoQixJQUFJLE9BQU8sR0FBVSxPQUFPLENBQUMsT0FBTyxDQUFBO1FBQ3BDLElBQUksU0FBUyxHQUFjLElBQUkscUJBQVMsRUFBRSxDQUFBO1FBQzFDLElBQUksYUFBYSxHQUFxQix5QkFBVyxDQUFDLFlBQVksRUFBRSxDQUFBO1FBRWhFLElBQUksYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUN0QjtRQUVELFNBQVMsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFNUIsS0FBSSxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUM7WUFDckMs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R0FBRyxHQUFHLENBQUMsQ0FBQTtRQUNwRixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osU0FBUyxFQUFFLFNBQVM7U0FDckIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vaW5kZXguanNcbi8v6I635Y+W5bqU55So5a6e5L6LXG4vLyBpbXBvcnQgeyBJTXlBcHAgfSBmcm9tICcuLi8uLi9hcHAnXG5pbXBvcnQgeyBXb3JkMk1wMyB9IGZyb20gJy4uLy4uL3V0aWxzL1dvcmQyTXAzJ1xuLy8gaW1wb3J0IHsgc2hvd0Vycm9yTXNnIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCdcbmltcG9ydCB7U3RvcmFnZVV0aWx9IGZyb20gJy4uLy4uL3V0aWxzL1N0b3JhZ2VVdGlsJ1xuaW1wb3J0IHtXb3JkR3JvdXB9IGZyb20gJy4uLy4uL2JlYW5zL1dvcmRHcm91cCdcbmltcG9ydCB7V29yZH0gZnJvbSAnLi4vLi4vYmVhbnMvV29yZCdcbi8vIGltcG9ydCB7SW5kZXhMaXN0fSBmcm9tICcuLi8uLi9iZWFuL0luZGV4TGlzdCdcbmltcG9ydCB7QXVkaW9VdGlsfSBmcm9tICcuLi8uLi91dGlscy9BdWRpb1V0aWwnXG5cbi8vIGNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KClcblxuY29uc3QgYXVkaW9VdGlsOkF1ZGlvVXRpbCA9IG5ldyBBdWRpb1V0aWwoKVxuXG4vKipcbiAqIOWjsOaYjuS6huS4gOS4quaemuS4vuexu+Wei1xuICog55So5p2l5Yy65YiG6aG16Z2i55qE5LiJ56eN54q25oCB77yaXG4gKiAxLuWBnOatoueKtuaAge+8jOWPquacieWBnOatoueKtuaAgeWPr+S7peWIh+aNouWNleivjeWIl+ihqOWSjOivlemfs1xuICogMi7mkq3mlL7nirbmgIHvvIzmkq3mlL7nirbmgIHlj6rog73pgInmi6nmmoLlgZzlkozlgZzmraJcbiAqIDMu5pqC5YGc54q25oCB77yM5pqC5YGc54q25oCB5Y+q6IO96YCJ5oup5pKt5pS+5ZKM5YGc5q2iXG4gKi9cbmVudW0gU3RhdGVFbnVte1xuICBTVE9QLFxuICBQTEFZLFxuICBQQVVTRVxufVxuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHN0YXRlOlN0YXRlRW51bSxcbiAgICBjdXJTdGF0ZTpTdGF0ZUVudW0uU1RPUCxcbiAgICBkb3dubG9hZENvdW50OjAsXG4gICAgcGxheUNvdW50OjAsXG4gICAgd29yZEdyb3VwOm5ldyBXb3JkR3JvdXAoKSxcbiAgICB3b3JkR3JvdXBMaXN0Om5ldyBBcnJheSA8V29yZEdyb3VwPigpLFxuICAgIHNob3dUb3BUaXBzOmZhbHNlLFxuICAgIGVyck1zZzonJ1xuICB9LFxuICBvbkxvYWQob3B0aW9uczphbnkpIHtcbiAgICBsZXQgZ3JvdXBpZDpzdHJpbmcgPSBvcHRpb25zLmdyb3VwaWRcbiAgICBsZXQgd29yZEdyb3VwOiBXb3JkR3JvdXAgPSBuZXcgV29yZEdyb3VwKClcbiAgICBsZXQgd29yZEdyb3VwTGlzdDogQXJyYXk8V29yZEdyb3VwPiA9IFN0b3JhZ2VVdGlsLmdldFdvcmRHcm91cCgpXG4gICAgLy/msqHmnInljZXor43liIbnu4TnmoTmg4XlhrXkuIvvvIzmmL7npLrliY3lvoDljZXor43nrqHnkIbpobXpnaLnmoTmjInpkq5cbiAgICBpZiAod29yZEdyb3VwTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKFwi5rKh5pyJ5Y2V6K+N5YiG57uEXCIpXG4gICAgfVxuICAgIC8v6buY6K6k5piv56ys5LiA5Liq5Y2V6K+N5YiG57uEXG4gICAgd29yZEdyb3VwID0gd29yZEdyb3VwTGlzdFswXVxuICAgIC8v5aaC5p6c5Y+C5pWw5Lit5Lyg5LqG5Y2V6K+N5YiG57uE55qESUTvvIzliJnpgInmi6nlj4LmlbDnmoTljZXor43liIbnu4RcbiAgICBmb3IobGV0IGk9MDtpPHdvcmRHcm91cExpc3QubGVuZ3RoO2krKyl7XG4gICAgICBpZih3b3JkR3JvdXBMaXN0W2ldLmdldElkKCk9PT1ncm91cGlkKXtcbiAgICAgICAgd29yZEdyb3VwID0gd29yZEdyb3VwTGlzdFtpXVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHdvcmRHcm91cDogd29yZEdyb3VwLFxuICAgICAgd29yZEdyb3VwTGlzdDogd29yZEdyb3VwTGlzdFxuICAgIH0pXG4gIH0sXG4gIHRyYW5zbGF0ZVN0YXRlKHN0YXRlOlN0YXRlRW51bSl7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBjdXJTdGF0ZTpzdGF0ZVxuICAgIH0pXG4gIH0sXG4gIHBsYXkoKXtcbiAgICBpZiAodGhpcy5kYXRhLmN1clN0YXRlID09PSBTdGF0ZUVudW0uU1RPUCkge1xuXG4gICAgICB0cnkge1xuICAgICAgbGV0IG1wM0ZpbGVzOiBXb3JkMk1wMyA9IG5ldyBXb3JkMk1wMygpXG4gICAgICBsZXQgdGhhdCA9IHRoaXNcbiAgICAgIGxldCB3b3JkczogQXJyYXk8V29yZD4gPSB0aGlzLmRhdGEud29yZEdyb3VwLmdldExpc3QoKVxuICAgICAgdGhpcy50cmFuc2xhdGVTdGF0ZShTdGF0ZUVudW0uUExBWSlcbiAgICAgIG1wM0ZpbGVzLmdldEZpbGVQYXRocyh3b3JkcywgKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICAgICAgbGV0IGN1ck51bWJlcjogbnVtYmVyID0gTWF0aC5yb3VuZChjb3VudCAvIHdvcmRzLmxlbmd0aCAqIDEwMClcbiAgICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgICAgZG93bmxvYWRDb3VudDogY3VyTnVtYmVyXG4gICAgICAgIH0pXG4gICAgICB9KS50aGVuKChwYXRoczogc3RyaW5nW10pID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocGF0aHMubGVuZ3RoKVxuICAgICAgICB0aGF0LmF1ZGlvUmVhZHkocGF0aHMpXG4gICAgICB9KVxuICAgIH1jYXRjaChlKXtcbiAgICAgIGxldCB0aGF0ID0gdGhpc1xuICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgIHNob3dUb3BUaXBzOnRydWUsXG4gICAgICAgIGVyck1zZzplXG4gICAgICB9KVxuICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICBzaG93VG9wVGlwczogZmFsc2UsXG4gICAgICAgICAgZXJyTXNnOicnXG4gICAgICAgIH0pXG4gICAgICB9LDMwMDApXG4gICAgfVxuICAgIH1cbiAgICBpZih0aGlzLmRhdGEuY3VyU3RhdGU9PT1TdGF0ZUVudW0uUEFVU0Upe1xuICAgICAgdGhpcy50cmFuc2xhdGVTdGF0ZShTdGF0ZUVudW0uUExBWSlcbiAgICAgIGF1ZGlvVXRpbC5wbGF5T3JQYXVzZSgpXG4gICAgfVxuICB9LFxuICBwYXVzZSgpe1xuICAgIHRoaXMudHJhbnNsYXRlU3RhdGUoU3RhdGVFbnVtLlBBVVNFKVxuICAgIGF1ZGlvVXRpbC5wbGF5T3JQYXVzZSgpXG4gIH0sXG4gIGF1ZGlvUmVhZHkocGF0aHM6c3RyaW5nW10pe1xuICAgIGF1ZGlvVXRpbC5zZXRQYXRocyhwYXRocylcbiAgICBhdWRpb1V0aWwuc2V0UHJvY2Nlc3ModGhpcy5wbGF5UHJvY2Nlc3MpXG4gICAgYXVkaW9VdGlsLnJlYWR5KClcbiAgICBhdWRpb1V0aWwucGxheU9yUGF1c2UoKVxuICB9LFxuICBwbGF5UHJvY2Nlc3MoY3VyOm51bWJlcil7XG4gICAgbGV0IGN1ck51bWJlcjogbnVtYmVyID0gTWF0aC5yb3VuZChjdXIgLyB0aGlzLmRhdGEud29yZEdyb3VwLmdldExpc3QoKS5sZW5ndGggKiAxMDApXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwbGF5Q291bnQ6IGN1ck51bWJlclxuICAgIH0pXG4gIH1cbn0pXG4iXX0=
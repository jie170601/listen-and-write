"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Word2Mp3_1 = require("../../utils/Word2Mp3");
const StorageUtil_1 = require("../../utils/StorageUtil");
const WordGroup_1 = require("../../beans/WordGroup");
const AudioUtil_1 = require("../../utils/AudioUtil");
const audioUtil = new AudioUtil_1.AudioUtil();
var StateEnum;
(function (StateEnum) {
    StateEnum[StateEnum["STOP"] = 0] = "STOP";
    StateEnum[StateEnum["PLAY"] = 1] = "PLAY";
    StateEnum[StateEnum["PAUSE"] = 2] = "PAUSE";
})(StateEnum || (StateEnum = {}));
Page({
    data: {
        state: StateEnum,
        curState: StateEnum.STOP,
        showPicker: false,
        downloadCount: 0,
        playCount: 0,
        pickerIndex: [0],
        wordGroup: new WordGroup_1.WordGroup(),
        wordGroupList: StorageUtil_1.StorageUtil.getWordGroup(),
        showTopTips: false,
        errMsg: ''
    },
    bindViewTap() {
        wx.navigateTo({
            url: '../logs/logs'
        });
    },
    onLoad(options) {
        let groupid = options.groupid;
        let wordGroup = new WordGroup_1.WordGroup();
        let wordGroupList = StorageUtil_1.StorageUtil.getWordGroup();
        if (wordGroupList.length === 0) {
            console.log("没有单词分组");
        }
        wordGroup = wordGroupList[0];
        for (let i = 0; i < wordGroupList.length; i++) {
            if (wordGroupList[i].getId() === groupid) {
                wordGroup = wordGroupList[i];
            }
        }
        this.setData({
            wordGroup: wordGroup,
            wordGroupList: wordGroupList
        });
    },
    selectList() {
        let showPicker = !this.data.showPicker;
        this.setData({
            showPicker: showPicker
        });
    },
    bindChange(e) {
        console.log(e);
        let wordGroup = this.data.wordGroupList[e.detail.value[0]];
        this.setData({
            pickerIndex: e.detail.value,
            wordGroup: wordGroup
        });
    },
    translateState(state) {
        this.setData({
            curState: state
        });
    },
    play() {
        if (this.data.curState === StateEnum.STOP) {
            try {
                let mp3Files = new Word2Mp3_1.Word2Mp3();
                let that = this;
                let words = this.data.wordGroup.getList();
                this.translateState(StateEnum.PLAY);
                mp3Files.getFilePaths(words, (count) => {
                    let curNumber = Math.round(count / words.length * 100);
                    that.setData({
                        downloadCount: curNumber
                    });
                }).then((paths) => {
                    console.log(paths.length);
                    that.audioReady(paths);
                });
            }
            catch (e) {
                let that = this;
                that.setData({
                    showTopTips: true,
                    errMsg: e
                });
                setTimeout(() => {
                    that.setData({
                        showTopTips: false,
                        errMsg: ''
                    });
                }, 3000);
            }
        }
        if (this.data.curState === StateEnum.PAUSE) {
            this.translateState(StateEnum.PLAY);
            audioUtil.playOrPause();
        }
    },
    pause() {
        this.translateState(StateEnum.PAUSE);
        audioUtil.playOrPause();
    },
    audioReady(paths) {
        audioUtil.setPaths(paths);
        audioUtil.setProccess(this.playProccess);
        audioUtil.ready();
        audioUtil.playOrPause();
    },
    playProccess(cur) {
        let curNumber = Math.round(cur / this.data.wordGroup.getList().length * 100);
        this.setData({
            playCount: curNumber
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdGVuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsbURBQStDO0FBRS9DLHlEQUFtRDtBQUNuRCxxREFBK0M7QUFHL0MscURBQStDO0FBSS9DLE1BQU0sU0FBUyxHQUFhLElBQUkscUJBQVMsRUFBRSxDQUFBO0FBUzNDLElBQUssU0FJSjtBQUpELFdBQUssU0FBUztJQUNaLHlDQUFJLENBQUE7SUFDSix5Q0FBSSxDQUFBO0lBQ0osMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFKSSxTQUFTLEtBQVQsU0FBUyxRQUliO0FBRUQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFDLFNBQVM7UUFDZixRQUFRLEVBQUMsU0FBUyxDQUFDLElBQUk7UUFDdkIsVUFBVSxFQUFDLEtBQUs7UUFDaEIsYUFBYSxFQUFDLENBQUM7UUFDZixTQUFTLEVBQUMsQ0FBQztRQUlYLFdBQVcsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUNmLFNBQVMsRUFBQyxJQUFJLHFCQUFTLEVBQUU7UUFNekIsYUFBYSxFQUFFLHlCQUFXLENBQUMsWUFBWSxFQUFFO1FBQ3pDLFdBQVcsRUFBQyxLQUFLO1FBQ2pCLE1BQU0sRUFBQyxFQUFFO0tBQ1Y7SUFFRCxXQUFXO1FBQ1QsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSxjQUFjO1NBQ3BCLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFDRCxNQUFNLENBQUMsT0FBVztRQUNoQixJQUFJLE9BQU8sR0FBVSxPQUFPLENBQUMsT0FBTyxDQUFBO1FBQ3BDLElBQUksU0FBUyxHQUFjLElBQUkscUJBQVMsRUFBRSxDQUFBO1FBQzFDLElBQUksYUFBYSxHQUFxQix5QkFBVyxDQUFDLFlBQVksRUFBRSxDQUFBO1FBRWhFLElBQUksYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMs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QyxJQUFJLENBQUMsUUFBUSxLQUFHLFNBQVMsQ0FBQyxLQUFLLEVBQUM7WUFDdEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDbkMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFBO1NBQ3hCO0lBQ0gsQ0FBQztJQUNELEtBQUs7UUFDSCxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNwQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDekIsQ0FBQztJQUNELFVBQVUsQ0FBQyxLQUFjO1FBQ3ZCLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekIsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDeEMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ2pCLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUN6QixDQUFDO0lBQ0QsWUFBWSxDQUFDLEdBQVU7UUFDckIsSUFBSSxTQUFTLEdBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFBO1FBQ3BGLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixTQUFTLEVBQUUsU0FBUztTQUNyQixDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy9pbmRleC5qc1xuLy/ojrflj5blupTnlKjlrp7kvotcbi8vIGltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uL2FwcCdcbmltcG9ydCB7IFdvcmQyTXAzIH0gZnJvbSAnLi4vLi4vdXRpbHMvV29yZDJNcDMnXG4vLyBpbXBvcnQgeyBzaG93RXJyb3JNc2cgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJ1xuaW1wb3J0IHtTdG9yYWdlVXRpbH0gZnJvbSAnLi4vLi4vdXRpbHMvU3RvcmFnZVV0aWwnXG5pbXBvcnQge1dvcmRHcm91cH0gZnJvbSAnLi4vLi4vYmVhbnMvV29yZEdyb3VwJ1xuaW1wb3J0IHtXb3JkfSBmcm9tICcuLi8uLi9iZWFucy9Xb3JkJ1xuLy8gaW1wb3J0IHtJbmRleExpc3R9IGZyb20gJy4uLy4uL2JlYW4vSW5kZXhMaXN0J1xuaW1wb3J0IHtBdWRpb1V0aWx9IGZyb20gJy4uLy4uL3V0aWxzL0F1ZGlvVXRpbCdcblxuLy8gY29uc3QgYXBwID0gZ2V0QXBwPElNeUFwcD4oKVxuXG5jb25zdCBhdWRpb1V0aWw6QXVkaW9VdGlsID0gbmV3IEF1ZGlvVXRpbCgpXG5cbi8qKlxuICog5aOw5piO5LqG5LiA5Liq5p6a5Li+57G75Z6LXG4gKiDnlKjmnaXljLrliIbpobXpnaLnmoTkuInnp43nirbmgIHvvJpcbiAqIDEu5YGc5q2i54q25oCB77yM5Y+q5pyJ5YGc5q2i54q25oCB5Y+v5Lul5YiH5o2i5Y2V6K+N5YiX6KGo5ZKM6K+V6Z+zXG4gKiAyLuaSreaUvueKtuaAge+8jOaSreaUvueKtuaAgeWPquiDvemAieaLqeaaguWBnOWSjOWBnOatolxuICogMy7mmoLlgZznirbmgIHvvIzmmoLlgZznirbmgIHlj6rog73pgInmi6nmkq3mlL7lkozlgZzmraJcbiAqL1xuZW51bSBTdGF0ZUVudW17XG4gIFNUT1AsXG4gIFBMQVksXG4gIFBBVVNFXG59XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgc3RhdGU6U3RhdGVFbnVtLFxuICAgIGN1clN0YXRlOlN0YXRlRW51bS5TVE9QLFxuICAgIHNob3dQaWNrZXI6ZmFsc2UsXG4gICAgZG93bmxvYWRDb3VudDowLFxuICAgIHBsYXlDb3VudDowLFxuICAgIC8qKlxuICAgICAqIOm7mOiupOWNleivjeWIl+ihqOmAieaLqeWZqOmAieS4reesrOS4gOS4qumAiemhuVxuICAgICAqL1xuICAgIHBpY2tlckluZGV4OlswXSxcbiAgICB3b3JkR3JvdXA6bmV3IFdvcmRHcm91cCgpLFxuICAgIC8qKlxuICAgICAqIOi/memHjOmBh+WIsOS4gOS4quWdkVxuICAgICAqIOmAieaLqeWZqOeahOaVsOaNruW/hemhu+WcqGRhdGHph4zlsLHotYvlgLzlrozmiJBcbiAgICAgKiDljrvku6PnoIHph4zlho3otYvlgLzlm57pgKDmiJDpu5jorqTpgInmi6nlpLHmlYhcbiAgICAgKi9cbiAgICB3b3JkR3JvdXBMaXN0OiBTdG9yYWdlVXRpbC5nZXRXb3JkR3JvdXAoKSxcbiAgICBzaG93VG9wVGlwczpmYWxzZSxcbiAgICBlcnJNc2c6JydcbiAgfSxcbiAgLy/kuovku7blpITnkIblh73mlbBcbiAgYmluZFZpZXdUYXAoKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6ICcuLi9sb2dzL2xvZ3MnXG4gICAgfSlcbiAgfSxcbiAgb25Mb2FkKG9wdGlvbnM6YW55KSB7XG4gICAgbGV0IGdyb3VwaWQ6c3RyaW5nID0gb3B0aW9ucy5ncm91cGlkXG4gICAgbGV0IHdvcmRHcm91cDogV29yZEdyb3VwID0gbmV3IFdvcmRHcm91cCgpXG4gICAgbGV0IHdvcmRHcm91cExpc3Q6IEFycmF5PFdvcmRHcm91cD4gPSBTdG9yYWdlVXRpbC5nZXRXb3JkR3JvdXAoKVxuICAgIC8v5rKh5pyJ5Y2V6K+N5YiG57uE55qE5oOF5Ya15LiL77yM5pi+56S65YmN5b6A5Y2V6K+N566h55CG6aG16Z2i55qE5oyJ6ZKuXG4gICAgaWYgKHdvcmRHcm91cExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIuayoeacieWNleivjeWIhue7hFwiKVxuICAgIH1cbiAgICAvL+m7mOiupOaYr+esrOS4gOS4quWNleivjeWIhue7hFxuICAgIHdvcmRHcm91cCA9IHdvcmRHcm91cExpc3RbMF1cbiAgICAvL+WmguaenOWPguaVsOS4reS8oOS6huWNleivjeWIhue7hOeahElE77yM5YiZ6YCJ5oup5Y+C5pWw55qE5Y2V6K+N5YiG57uEXG4gICAgZm9yKGxldCBpPTA7aTx3b3JkR3JvdXBMaXN0Lmxlbmd0aDtpKyspe1xuICAgICAgaWYod29yZEdyb3VwTGlzdFtpXS5nZXRJZCgpPT09Z3JvdXBpZCl7XG4gICAgICAgIHdvcmRHcm91cCA9IHdvcmRHcm91cExpc3RbaV1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICB3b3JkR3JvdXA6IHdvcmRHcm91cCxcbiAgICAgIHdvcmRHcm91cExpc3Q6IHdvcmRHcm91cExpc3RcbiAgICB9KVxuICB9LFxuICBzZWxlY3RMaXN0KCl7XG4gICAgbGV0IHNob3dQaWNrZXI6Ym9vbGVhbiA9ICF0aGlzLmRhdGEuc2hvd1BpY2tlclxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2hvd1BpY2tlcjogc2hvd1BpY2tlclxuICAgIH0pXG4gICAgLy8gbGV0IGN1ck51bWJlcjpudW1iZXIgPSB0aGlzLmRhdGEhLmN1ck51bWJlcisxXG4gICAgLy8gdGhpcy5zZXREYXRhISh7XG4gICAgLy8gICBjdXJOdW1iZXI6Y3VyTnVtYmVyXG4gICAgLy8gfSlcbiAgICAvLyBjb25zb2xlLmxvZyhjdXJOdW1iZXIpXG4gIH0sXG4gIGJpbmRDaGFuZ2UoZTphbnkpe1xuICAgIGNvbnNvbGUubG9nKGUpXG4gICAgbGV0IHdvcmRHcm91cDogV29yZEdyb3VwID0gdGhpcy5kYXRhLndvcmRHcm91cExpc3RbZS5kZXRhaWwudmFsdWVbMF1dXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwaWNrZXJJbmRleDogZS5kZXRhaWwudmFsdWUsXG4gICAgICB3b3JkR3JvdXA6d29yZEdyb3VwXG4gICAgfSlcbiAgfSxcbiAgdHJhbnNsYXRlU3RhdGUoc3RhdGU6U3RhdGVFbnVtKXtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGN1clN0YXRlOnN0YXRlXG4gICAgfSlcbiAgfSxcbiAgcGxheSgpe1xuICAgIGlmICh0aGlzLmRhdGEuY3VyU3RhdGUgPT09IFN0YXRlRW51bS5TVE9QKSB7XG5cbiAgICAgIHRyeSB7XG4gICAgICBsZXQgbXAzRmlsZXM6IFdvcmQyTXAzID0gbmV3IFdvcmQyTXAzKClcbiAgICAgIGxldCB0aGF0ID0gdGhpc1xuICAgICAgbGV0IHdvcmRzOiBBcnJheTxXb3JkPiA9IHRoaXMuZGF0YS53b3JkR3JvdXAuZ2V0TGlzdCgpXG4gICAgICB0aGlzLnRyYW5zbGF0ZVN0YXRlKFN0YXRlRW51bS5QTEFZKVxuICAgICAgbXAzRmlsZXMuZ2V0RmlsZVBhdGhzKHdvcmRzLCAoY291bnQ6IG51bWJlcikgPT4ge1xuICAgICAgICBsZXQgY3VyTnVtYmVyOiBudW1iZXIgPSBNYXRoLnJvdW5kKGNvdW50IC8gd29yZHMubGVuZ3RoICogMTAwKVxuICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICBkb3dubG9hZENvdW50OiBjdXJOdW1iZXJcbiAgICAgICAgfSlcbiAgICAgIH0pLnRoZW4oKHBhdGhzOiBzdHJpbmdbXSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhwYXRocy5sZW5ndGgpXG4gICAgICAgIHRoYXQuYXVkaW9SZWFkeShwYXRocylcbiAgICAgIH0pXG4gICAgfWNhdGNoKGUpe1xuICAgICAgbGV0IHRoYXQgPSB0aGlzXG4gICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgc2hvd1RvcFRpcHM6dHJ1ZSxcbiAgICAgICAgZXJyTXNnOmVcbiAgICAgIH0pXG4gICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICAgIHNob3dUb3BUaXBzOiBmYWxzZSxcbiAgICAgICAgICBlcnJNc2c6JydcbiAgICAgICAgfSlcbiAgICAgIH0sMzAwMClcbiAgICB9XG4gICAgfVxuICAgIGlmKHRoaXMuZGF0YS5jdXJTdGF0ZT09PVN0YXRlRW51bS5QQVVTRSl7XG4gICAgICB0aGlzLnRyYW5zbGF0ZVN0YXRlKFN0YXRlRW51bS5QTEFZKVxuICAgICAgYXVkaW9VdGlsLnBsYXlPclBhdXNlKClcbiAgICB9XG4gIH0sXG4gIHBhdXNlKCl7XG4gICAgdGhpcy50cmFuc2xhdGVTdGF0ZShTdGF0ZUVudW0uUEFVU0UpXG4gICAgYXVkaW9VdGlsLnBsYXlPclBhdXNlKClcbiAgfSxcbiAgYXVkaW9SZWFkeShwYXRoczpzdHJpbmdbXSl7XG4gICAgYXVkaW9VdGlsLnNldFBhdGhzKHBhdGhzKVxuICAgIGF1ZGlvVXRpbC5zZXRQcm9jY2Vzcyh0aGlzLnBsYXlQcm9jY2VzcylcbiAgICBhdWRpb1V0aWwucmVhZHkoKVxuICAgIGF1ZGlvVXRpbC5wbGF5T3JQYXVzZSgpXG4gIH0sXG4gIHBsYXlQcm9jY2VzcyhjdXI6bnVtYmVyKXtcbiAgICBsZXQgY3VyTnVtYmVyOiBudW1iZXIgPSBNYXRoLnJvdW5kKGN1ciAvIHRoaXMuZGF0YS53b3JkR3JvdXAuZ2V0TGlzdCgpLmxlbmd0aCAqIDEwMClcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHBsYXlDb3VudDogY3VyTnVtYmVyXG4gICAgfSlcbiAgfVxufSlcbiJdfQ==